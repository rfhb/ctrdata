<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Retrieve and Analyze Clinical Trials in Public Registers • ctrdata</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><!-- docsearch --><script src="docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Retrieve and Analyze Clinical Trials in Public Registers">
<meta property="og:description" content="Provides functions for querying, retrieving and analysing
        protocol- and results-related information on clinical trials from
        two public registers, the European Union Clinical Trials Register
        (EUCTR, &lt;https://www.clinicaltrialsregister.eu/&gt;) and
        ClinicalTrials.gov (CTGOV, &lt;https://clinicaltrials.gov/&gt;). The
        information is transformed and then stored in a database (nodbi).
        Functions are provided for accessing and analysing the locally
        stored information on the clinical trials, as well as for
        identifying duplicate records. The package is motivated by the need
        for aggregating and trend-analysing the design, conduct and outcomes
        across clinical trials.">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@rfhb">
<meta name="twitter:site" content="@rfhb">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">ctrdata</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.2.1.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/ctrdata_get_started.html">Getting started with R package `ctrdata` for clinical trial information</a>
    </li>
    <li>
      <a href="articles/ctrdata_usage_examples.html">Examples for using R package `ctrdata` for clinical trial information</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rfhb/ctrdata/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div id="ctrdata-for-aggregating-and-analysing-clinical-trials" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#ctrdata-for-aggregating-and-analysing-clinical-trials" class="anchor"></a>ctrdata for aggregating and analysing clinical trials</h1></div>
<p>The package <code>ctrdata</code> provides functions for retrieving (downloading) information on clinical trials from public registers, and for aggregating and analysing such information. It can be used for the European Union Clinical Trials Register (“EUCTR”, <a href="https://www.clinicaltrialsregister.eu/" class="uri">https://www.clinicaltrialsregister.eu/</a>) and for ClinicalTrials.gov (“CTGOV”, <a href="https://clinicaltrials.gov/" class="uri">https://clinicaltrials.gov/</a>). Development of <code>ctrdata</code> started in 2015 and was motivated by the wish to understand trends in designs and conduct of trials and their availability for patients. The package is to be used within the <a href="https://www.r-project.org/">R</a> system.</p>
<p>Last reviewed on 2020-07-05 for version 1.2.1.9001</p>
<p>Main features:</p>
<ul>
<li><p>Protocol-related information on clinical trials is easily retrieved (downloaded) from public online sources: Users define a query using a register’s web interfaces and then use <code>ctrdata</code> for retrieving all trials resulting from the query. Personal annotations can be added when retrieving trial information. Synonyms of an active substance can also be found.</p></li>
<li><p>Results-related information on trials can be included when information is retrieved (downloaded). All information is retrieved with multiple parallel webstreams, to speed up operations.</p></li>
<li><p>Retrieved (downloaded) trial information is transformed and stored in a document-centric database (since registers provide nested data), for fast and offline access. This can then be analysed with <code>R</code> (or others systems). Easily re-run a previous query to update a database. Uses <code>RSQLite</code>, local or remote MongoDB servers, via R package <code>nodbi</code>.</p></li>
<li><p>Unique (de-duplicated) trial records are identified, across registers and when there are several records in any register. <code>ctrdata</code> also can merge and recode information (fields) from different registers. Vignettes are provided to get started and with detailed examples, such as analyses of time trends of details of clinical trial protocols and for analysing results.</p></li>
</ul>
<p>Remember to respect the registers’ copyrights and terms and conditions (see <code><a href="reference/ctrOpenSearchPagesInBrowser.html">ctrOpenSearchPagesInBrowser(copyright = TRUE)</a></code>). Please cite this package in any publication as follows: <code>Ralf Herold (2020). ctrdata: Retrieve and Analyze Clinical Trials from Public Registers. R package version 1.2, https://github.com/rfhb/ctrdata</code></p>
<!--

```r
citation("ctrdata")
```
-->
<p>Package <code>ctrdata</code> has been used for example for:</p>
<ul>
<li><p>Blogging on <a href="https://paediatricdata.eu/2018/01/14/innovation-coming-to-paediatric-research/">Innovation coming to paediatric research</a></p></li>
<li><p>Report on <a href="https://www.cancerresearchuk.org/about-us/we-develop-policy/we-work-with-government/exiting-the-eu/uk-and-eu-research#downloads">The impact of collaboration: The value of UK medical research to EU science and health</a></p></li>
</ul>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<div id="1-install-package-in-r" class="section level2">
<h2 class="hasAnchor">
<a href="#1-install-package-in-r" class="anchor"></a>1. Install package in R</h2>
<p>Package <code>ctrdata</code> can be found <a href="https://cran.r-project.org/package=ctrdata">here on CRAN</a> and <a href="https://github.com/rfhb/ctrdata">here on github</a>. Within <a href="https://www.r-project.org/">R</a>, use the following commands to install package <code>ctrdata</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># Install CRAN version:</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"ctrdata"</span>)

<span class="co"># Alternatively, install development version: </span>
<span class="co"># - Preparation:</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="co"># - Install ctrdata:</span>
<span class="kw">devtools</span>::<span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"rfhb/ctrdata"</span>)
</pre></div>
<p>These commands also install the package dependencies, which are <code>nodbi</code>, <code>jsonlite</code>, <code>httr</code>, <code>curl</code>, <code>clipr</code>, <code>xml2</code>, <code>rvest</code>.</p>
</div>
<div id="2-command-line-tools-perl-sed-cat-and-php-52-or-higher" class="section level2">
<h2 class="hasAnchor">
<a href="#2-command-line-tools-perl-sed-cat-and-php-52-or-higher" class="anchor"></a>2. Command line tools <code>perl</code>, <code>sed</code>, <code>cat</code> and <code>php</code> (5.2 or higher)</h2>
<p>These command line tools are required for <code><a href="reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb()</a></code>, the main function of package <code>ctrdata</code>.</p>
<p>In Linux and macOS (including version 10.15 Catalina), these are usually already installed.</p>
<p>For MS Windows, install <a href="https://cygwin.org/install.html">cygwin</a>: In <code>R</code>, run <code><a href="reference/installCygwinWindowsDoInstall.html">ctrdata::installCygwinWindowsDoInstall()</a></code> for an automated minimal installation into <code>c:\cygwin</code> (installations in folders corresponding to <code>c:\cygw*</code> will also be recognised and used). Alternatively, install manually cygwin with packages <code>perl</code>, <code>php-jsonc</code> and <code>php-simplexml</code> into <code>c:\cygwin</code>. This installation will consume about 160 MB disk space; administrator credentials not needed.</p>
</div>
</div>
<div id="overview-of-functions-in-ctrdata" class="section level1">
<h1 class="hasAnchor">
<a href="#overview-of-functions-in-ctrdata" class="anchor"></a>Overview of functions in <code>ctrdata</code>
</h1>
<p>The functions are listed in the approximate order of use.</p>
<table class="table">
<colgroup>
<col width="18%">
<col width="81%">
</colgroup>
<thead><tr class="header">
<th>Function name</th>
<th>Function purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="reference/ctrOpenSearchPagesInBrowser.html">ctrOpenSearchPagesInBrowser()</a></code></td>
<td>Open search pages of registers or execute search in web browser</td>
</tr>
<tr class="even">
<td><code><a href="reference/ctrFindActiveSubstanceSynonyms.html">ctrFindActiveSubstanceSynonyms()</a></code></td>
<td>Find synonyms and alternative names for an active substance</td>
</tr>
<tr class="odd">
<td><code><a href="reference/ctrGetQueryUrlFromBrowser.html">ctrGetQueryUrlFromBrowser()</a></code></td>
<td>Import from clipboard the URL of a search in one of the registers</td>
</tr>
<tr class="even">
<td><code><a href="reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb()</a></code></td>
<td>Retrieve (download) or update, and annotate, information on clinical trials from a register and store in a database</td>
</tr>
<tr class="odd">
<td><code><a href="reference/dbQueryHistory.html">dbQueryHistory()</a></code></td>
<td>Show the history of queries that were downloaded into the database collection</td>
</tr>
<tr class="even">
<td><code><a href="reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials()</a></code></td>
<td>Produce a vector of de-duplicated identifiers of clinical trial records in the database</td>
</tr>
<tr class="odd">
<td><code><a href="reference/dbFindFields.html">dbFindFields()</a></code></td>
<td>Find names of fields in the database</td>
</tr>
<tr class="even">
<td><code><a href="reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf()</a></code></td>
<td>Create a data.frame from records in the database with the specified fields</td>
</tr>
<tr class="odd">
<td><code><a href="reference/dfMergeTwoVariablesRelevel.html">dfMergeTwoVariablesRelevel()</a></code></td>
<td>Merge two variables into a single variable, optionally map values to a new set of values</td>
</tr>
<tr class="even">
<td><code><a href="reference/dfListExtractKey.html">dfListExtractKey()</a></code></td>
<td>Extract an element based on its name (key) from a list in a complex data.frame such as obtained from <code><a href="reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf()</a></code> for deeply nested fields</td>
</tr>
<tr class="odd">
<td><code><a href="reference/installCygwinWindowsDoInstall.html">installCygwinWindowsDoInstall()</a></code></td>
<td>Convenience function to install a cygwin environment (MS Windows only)</td>
</tr>
</tbody>
</table>
</div>
<div id="example-workflow" class="section level1">
<h1 class="hasAnchor">
<a href="#example-workflow" class="anchor"></a>Example workflow</h1>
<p>The aim is to download protocol-related trial information and tabulate the trials’ status of conduct.</p>
<ul>
<li>Attach package <code>ctrdata</code>:</li>
</ul>
<!-- end list --><div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/rfhb/ctrdata">ctrdata</a></span>)
</pre></div>
<ul>
<li>Open registers’ advanced search pages in browser:</li>
</ul>
<!-- end list --><div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="reference/ctrOpenSearchPagesInBrowser.html">ctrOpenSearchPagesInBrowser</a></span>()

<span class="co"># Please review and respect register copyrights:</span>
<span class="fu"><a href="reference/ctrOpenSearchPagesInBrowser.html">ctrOpenSearchPagesInBrowser</a></span>(copyright = <span class="fl">TRUE</span>)
</pre></div>
<ul>
<li><p>Adjust search parameters and execute search in browser</p></li>
<li><p>When trials of interest are listed in browser, copy the address from the browser’s address bar to the clipboard</p></li>
<li><p>Get address from clipboard:</p></li>
</ul>
<!-- end list --><div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ctrGetQueryUrlFromBrowser.html">ctrGetQueryUrlFromBrowser</a></span>()
<span class="co"># * Found search query from EUCTR.</span>

<span class="kw">q</span>
<span class="co">#                                  query-term query-register</span>
<span class="co"># 1 query=cancer&amp;age=under-18&amp;phase=phase-one          EUCTR</span>
</pre></div>
<ul>
<li>Retrieve protocol-related information, transform and save to database:</li>
</ul>
<p>Under the hood, scripts <code>euctr2json.sh</code> and <code>xml2json.php</code> (in <code>ctrdata/exec</code>) transform EUCTR plain text files and CTGOV <code>XML</code> files to <code>ndjson</code> format, which is imported into the database. As a first step, the database is specified using <code>nodbi</code> (using RSQlite or MongoDB as backend). Second, trial information is retrieved and loaded into the database.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="co"># Connect to (or newly create) a SQLite database </span>
<span class="co"># that is stored in a file on the local system:</span>
<span class="kw">db</span> <span class="op">&lt;-</span> <span class="kw">nodbi</span>::<span class="fu"><a href="https://docs.ropensci.org/nodbi/reference/src_sqlite.html">src_sqlite</a></span>(
  dbname = <span class="st">"some_database_name.sqlite_file"</span>, 
  collection = <span class="st">"some_collection_name"</span>)

<span class="co"># Alternative, for a MongoDB database:</span>
<span class="co"># db &lt;- nodbi::src_mongo(url = "mongodb://localhost", </span>
<span class="co">#                        db = "some_database_name",</span>
<span class="co">#                        collection = "some_collection_name")</span>

<span class="co"># Retrieve trials from public register:</span>
<span class="fu"><a href="reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span>(
  queryterm = 
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"https://www.clinicaltrialsregister.eu/ctr-search/search?"</span>, 
           <span class="st">"query=cancer&amp;age=under-18&amp;phase=phase-one"</span>),
  con = <span class="kw">d</span>)
</pre></div>
<ul>
<li>Analyse</li>
</ul>
<p>Tabulate the status of those trials that are recorded to be part of an agreed paediatric development program (paediatric investigation plan, PIP):</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="co"># Get all records that have values in the fields of interest:</span>
<span class="kw">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span>(
  fields = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
    <span class="st">"a7_trial_is_part_of_a_paediatric_investigation_plan"</span>, 
    <span class="st">"p_end_of_trial_status"</span>, 
    <span class="st">"a2_eudract_number"</span>),
  con = <span class="kw">db</span>)

<span class="co"># Find unique trial identifiers for trials that have nore than one record, </span>
<span class="co"># for example for several EU Member States: </span>
<span class="kw">uniqueids</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials</a></span>(con = <span class="kw">db</span>)
<span class="co"># * Total of 454 records in collection.</span>
<span class="co"># Searching for duplicates, found </span>
<span class="co">#  - 292 EUCTR _id were not preferred EU Member State record of trial</span>
<span class="co"># No CTGOV records found.</span>
<span class="co"># = Returning keys (_id) of 162 out of total 454 records in collection "some_collection_name".</span>

<span class="co"># Keep only unique / deduplicated records:</span>
<span class="kw">result</span> <span class="op">&lt;-</span> <span class="kw">result</span>[ <span class="kw">result</span>[[<span class="st">"_id"</span>]] <span class="op">%in%</span> <span class="kw">uniqueids</span>, ]

<span class="co"># Tabulate the clinical trial information:</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="kw">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="kw">p_end_of_trial_status</span>, 
                   <span class="kw">a7_trial_is_part_of_a_paediatric_investigation_plan</span>))
<span class="co">#</span>
<span class="co">#                      a7_trial_is_part_of_a_paediatric_investigation_plan</span>
<span class="co"># p_end_of_trial_status   Information not present in EudraCT No Yes</span>
<span class="co">#    Completed                                             6 14   8</span>
<span class="co">#    Ongoing                                               3 62  22</span>
<span class="co">#    Prematurely Ended                                     1  4   2</span>
<span class="co">#    Temporarily Halted                                    0  1   1</span>
</pre></div>
<ul>
<li>Add records from another register into database</li>
</ul>
<!-- end list --><div class="sourceCode" id="cb7"><pre class="downlit">
<span class="co"># Retrieve trials from public register:</span>
<span class="fu"><a href="reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span>(
  queryterm = <span class="st">"cond=neuroblastoma&amp;rslt=With&amp;recrs=e&amp;age=0&amp;intr=Drug"</span>, 
  register = <span class="st">"CTGOV"</span>,
  con = <span class="kw">db</span>)
</pre></div>
<ul>
<li>Result-related trial information</li>
</ul>
<p>Analyse some result details; note how information fields are used with slightly different approaches:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co"># Get all records that have values in all specified fields. </span>
<span class="co"># Note the fields are specific to CTGOV, thus not in EUCTR,</span>
<span class="co"># which results in a warning that not all reacords in the </span>
<span class="co"># database have information on the specified fields:  </span>
<span class="kw">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span>(
  fields = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
    <span class="st">"clinical_results.baseline.analyzed_list.analyzed.count_list.count"</span>,
    <span class="st">"clinical_results.baseline.group_list.group"</span>,
    <span class="st">"clinical_results.baseline.analyzed_list.analyzed.units"</span>, 
    <span class="st">"study_design_info.allocation"</span>, 
    <span class="st">"location"</span>),
  con = <span class="kw">db</span>)

<span class="co"># - Count sites: location is a list of lists, </span>
<span class="co">#   hence the hierarchical extraction by</span>
<span class="co">#   facility and then name of facility</span>
<span class="kw">result</span><span class="op">$</span><span class="kw">number_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(
  <span class="kw">result</span><span class="op">$</span><span class="kw">location</span>, <span class="fu">function</span>(<span class="kw">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">x</span>[[<span class="st">"facility"</span>]][[<span class="st">"name"</span>]]))

<span class="co">#   an alternative approach uses a function provided by</span>
<span class="co">#   ctrdata to extract keys from a list in a data frame:</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(
  <span class="fu"><a href="reference/dfListExtractKey.html">dfListExtractKey</a></span>(
    df = <span class="kw">result</span>, 
    list.key = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"location"</span>, <span class="st">"facility.name"</span>))), 
  <span class="fu"><a href="https://rdrr.io/r/base/by.html">by</a></span>(<span class="kw">item</span>, <span class="kw">`_id`</span>, <span class="kw">max</span>)
)

<span class="co"># - Count total participant numbers, by summing the reporting groups</span>
<span class="co">#   for which their description does not contain the word "total" </span>
<span class="co">#   (such as in "Total participants")</span>
<span class="kw">result</span><span class="op">$</span><span class="kw">number_participants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">result</span>)), <span class="fu">function</span>(<span class="kw">i</span>) {
    
    <span class="co"># Participant counts are in a list of elements with attributes, </span>
    <span class="co"># where attribute value has a vector of numbers per reporting group</span>
    <span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="kw">result</span><span class="op">$</span><span class="kw">clinical_results.baseline.analyzed_list.analyzed.count_list.count</span>[[<span class="kw">i</span>]]
    
    <span class="co"># Information on reporting groups is in a list with a subelement description</span>
    <span class="kw">tot</span> <span class="op">&lt;-</span> <span class="kw">result</span><span class="op">$</span><span class="kw">clinical_results.baseline.group_list.group</span>[[<span class="kw">i</span>]]
    
    <span class="co"># see for example https://clinicaltrials.gov/ct2/show/results/NCT00253435#base</span>
    <span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="kw">tmp</span>[[<span class="st">"@attributes"</span>]][[<span class="st">"value"</span>]]
    <span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="kw">tmp</span>[ <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"(^| )[tT]otal( |$)"</span>, <span class="kw">tot</span>[[<span class="st">"description"</span>]])]
    
    <span class="co"># to sum up, change string into integer value.</span>
    <span class="co"># note that e.g. sum(..., na.rm = TRUE) is not used</span>
    <span class="co"># since there are no empty entries in these trials</span>
    <span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="kw">tmp</span>))
    <span class="kw">tmp</span>
    
  })

<span class="co"># Allocation is part of study design information and available</span>
<span class="co"># as a simple character string, suitable for routine manipulation</span>
<span class="kw">result</span><span class="op">$</span><span class="kw">is_controlled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(
  pattern = <span class="st">"^Random"</span>, 
  x = <span class="kw">result</span><span class="op">$</span><span class="kw">study_design_info.allocation</span>)

<span class="co"># Example plot</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">ggplot2</span>)
<span class="fu">ggplot</span>(data = <span class="kw">result</span>) <span class="op">+</span> 
  <span class="fu">labs</span>(title = <span class="st">"Neuroblastoma trials with results"</span>,
       subtitle = <span class="st">"clinicaltrials.gov"</span>) <span class="op">+</span>
  <span class="fu">geom_point</span>(mapping = <span class="fu">aes</span>(x = <span class="kw">number_sites</span>,
                           y = <span class="kw">number_participants</span>,
                           colour = <span class="kw">is_controlled</span>)) <span class="op">+</span> 
  <span class="fu">scale_x_log10</span>() <span class="op">+</span> 
  <span class="fu">scale_y_log10</span>() 
<span class="fu">ggsave</span>(filename = <span class="st">"inst/image/README-ctrdata_results_neuroblastoma.png"</span>,
       width = <span class="fl">4</span>, height = <span class="fl">3</span>, units = <span class="st">"in"</span>)
</pre></div>
<p><img src="inst/image/README-ctrdata_results_neuroblastoma.png" alt="Neuroblastoma trials"></p>
</div>
<div id="databases" class="section level1">
<h1 class="hasAnchor">
<a href="#databases" class="anchor"></a>Databases</h1>
<p>The database connection object <code>con</code> is created by calling <code>nodbi::src_*()</code>, with parameters that are specific to the database (e.g., <code>url</code>) and with a special parameter <code>collection</code> that is used by <code>ctrdata</code> to identify which table or collection in the database to use. Any such connection object can then be used by <code>ctrdata</code> and generic functions of <code>nodbi</code> in a consistent way, as shown in the table:</p>
<table class="table">
<colgroup>
<col width="16%">
<col width="34%">
<col width="48%">
</colgroup>
<thead><tr class="header">
<th>Purpose</th>
<th>SQLite</th>
<th>MongoDB</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Create database connection</td>
<td><code>dbc &lt;- nodbi::src_sqlite(dbname = ":memory:", collection = "name_of_my_collection")</code></td>
<td><code>dbc &lt;- nodbi::src_mongo(db = "name_of_my_database", collection = "name_of_my_collection", url = "mongodb://localhost")</code></td>
</tr>
<tr class="even">
<td>Use connection with any ctrdata function</td>
<td><code>ctrdata::{ctr,db}*(con = dbc)</code></td>
<td><code>ctrdata::{ctr,db}*(con = dbc)</code></td>
</tr>
<tr class="odd">
<td>Use connection with any nodbi function</td>
<td><code>nodbi::docdb_*(src = dbc, key = dbc$collection)</code></td>
<td><code>nodbi::docdb_*(src = dbc, key = dbc$collection)</code></td>
</tr>
</tbody>
</table>
</div>
<div id="features-in-the-works" class="section level1">
<h1 class="hasAnchor">
<a href="#features-in-the-works" class="anchor"></a>Features in the works</h1>
<ul>
<li><p>Explore using the Windows Subsystem for Linux (WSL) instead of <code>cygwin</code></p></li>
<li><p>Merge results-related information retrieved from different registers (e.g. corresponding endpoints) and prepare for analysis across trials.</p></li>
<li><p>Explore relevance to retrieve previous versions of protocol- and results-related information</p></li>
</ul>
</div>
<div id="acknowledgements" class="section level1">
<h1 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h1>
<ul>
<li><p>Data providers and curators of the clinical trial registers. Please review and respect their copyrights and terms and conditions (<code><a href="reference/ctrOpenSearchPagesInBrowser.html">ctrOpenSearchPagesInBrowser(copyright = TRUE)</a></code>).</p></li>
<li><p>This package <code>ctrdata</code> has been made possible building on the work done for <a href="https://www.r-project.org/">R</a>, <a href="https://cran.r-project.org/package=curl">curl</a>, <a href="https://cran.r-project.org/package=httr">httr</a>, <a href="https://cran.r-project.org/package=xml2">xml2</a>, <a href="https://cran.r-project.org/package=rvest">rvest</a>, <a href="https://cran.r-project.org/package=mongolite">mongolite</a>, <a href="https://cran.r-project.org/package=nodbi">nodbi</a>, <a href="https://CRAN.R-project.org/package=RSQLite">RSQLite</a> and <a href="https://cran.r-project.org/package=clipr">clipr</a>.</p></li>
</ul>
</div>
<div id="issues-and-notes" class="section level1">
<h1 class="hasAnchor">
<a href="#issues-and-notes" class="anchor"></a>Issues and notes</h1>
<ul>
<li><p>Please file issues and bugs <a href="https://github.com/rfhb/ctrdata/issues">here</a>.</p></li>
<li><p>Package <code>ctrdata</code> should work and is continually tested on Linux, Mac OS X and MS Windows systems. Linux and MS Windows are tested using continuous integration, see badges at the beginning of this document. Please file an issue for any problems.</p></li>
<li><p>The information in the registers may not be fully correct; see for example <a href="https://www.bmj.com/content/361/bmj.k1452">this publication on CTGOV</a>.</p></li>
<li><p>No attempts were made to harmonise field names between registers (nevertheless, <code><a href="reference/dfMergeTwoVariablesRelevel.html">dfMergeTwoVariablesRelevel()</a></code> can be used to merge and map two variables / fields into one).</p></li>
</ul>
</div>
<div id="annex-representation-of-trial-records-json-in-databases" class="section level1">
<h1 class="hasAnchor">
<a href="#annex-representation-of-trial-records-json-in-databases" class="anchor"></a>Annex: Representation of trial records’ JSON in databases</h1>
<div id="mongodb" class="section level2">
<h2 class="hasAnchor">
<a href="#mongodb" class="anchor"></a>MongoDB</h2>
<p><img src="inst/image/README-ctrdata_json_mongodb.jpg" alt="Example JSON representation in MongoDB"></p>
</div>
<div id="sqlite" class="section level2">
<h2 class="hasAnchor">
<a href="#sqlite" class="anchor"></a>SQLite</h2>
<p><img src="inst/image/README-ctrdata_json_sqlite.jpg" alt="Example JSON representation in SQLite"></p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=ctrdata">https://​cloud.r-project.org/​package=ctrdata</a>
</li>
<li>Browse source code at <br><a href="https://github.com/rfhb/ctrdata/">https://​github.com/​rfhb/​ctrdata/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/rfhb/ctrdata/issues">https://​github.com/​rfhb/​ctrdata/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Ralf Herold <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-8148-6748" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=ctrdata"><img src="https://cranlogs.r-pkg.org/badges/ctrdata"></a></li>
<li><a href="https://github.com/rfhb/ctrdata/actions"><img src="https://github.com/rfhb/ctrdata/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
<li><a href="https://codecov.io/gh/rfhb/ctrdata"><img src="https://github.com/rfhb/ctrdata/workflows/test-coverage/badge.svg" alt="test-coverage"></a></li>
<li><a href="https://codecov.io/gh/rfhb/ctrdata"><img src="https://codecov.io/gh/rfhb/ctrdata/branch/master/graph/badge.svg" alt="codecov"></a></li>
<li><a href="https://rfhb.slack.com/messages/C6N1Y75B6"><img src="https://img.shields.io/badge/Slack-Join-green.svg" alt="Slack"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Ralf Herold.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'c06ec790dbbaffba8e7b188f745a4353',
    indexName: 'ctrdata',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>

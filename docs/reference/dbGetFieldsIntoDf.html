<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create data frame of specified fields or trial concepts from database collection — dbGetFieldsIntoDf • ctrdata</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create data frame of specified fields or trial concepts from database collection — dbGetFieldsIntoDf"><meta name="description" content='Fields in the collection are retrieved from all records into a data
frame (or tibble). The function uses the field names to appropriately type
the values that it returns, harmonising original values (e.g.,
"Yes" to `TRUE`, "false" to `FALSE`, "Information not present in EudraCT" to
`NA`, date strings to dates or time differences, number strings to numbers).
Trial concepts are calculated for all records and included in the return value.'><meta property="og:description" content='Fields in the collection are retrieved from all records into a data
frame (or tibble). The function uses the field names to appropriately type
the values that it returns, harmonising original values (e.g.,
"Yes" to `TRUE`, "false" to `FALSE`, "Information not present in EudraCT" to
`NA`, date strings to dates or time differences, number strings to numbers).
Trial concepts are calculated for all records and included in the return value.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ctrdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.25.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/ctrdata_install.html">Install R package ctrdata</a></li>
    <li><a class="dropdown-item" href="../articles/ctrdata_retrieve.html">Retrieve clinical trial information</a></li>
    <li><a class="dropdown-item" href="../articles/ctrdata_summarise.html">Summarise and analyse clinical trial information</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rfhb/ctrdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create data frame of specified fields or trial concepts from database collection</h1>
      <small class="dont-index">Source: <a href="https://github.com/rfhb/ctrdata/blob/HEAD/R/dbGetFieldsIntoDf.R" class="external-link"><code>R/dbGetFieldsIntoDf.R</code></a></small>
      <div class="d-none name"><code>dbGetFieldsIntoDf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fields in the collection are retrieved from all records into a data
frame (or tibble). The function uses the field names to appropriately type
the values that it returns, harmonising original values (e.g.,
"Yes" to `TRUE`, "false" to `FALSE`, "Information not present in EudraCT" to
`NA`, date strings to dates or time differences, number strings to numbers).
Trial concepts are calculated for all records and included in the return value.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dbGetFieldsIntoDf</span><span class="op">(</span>fields <span class="op">=</span> <span class="st">""</span>, calculate <span class="op">=</span> <span class="st">""</span>, <span class="va">con</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-fields">fields<a class="anchor" aria-label="anchor" href="#arg-fields"></a></dt>
<dd><p>Vector of one or more strings, with names of sought fields.
See function <a href="dbFindFields.html">dbFindFields</a> for how to find names of fields and
<a href="ctrShowOneTrial.html">ctrShowOneTrial</a> for interactively selecting field names.
Dot path notation ("field.subfield") without indices is supported.
If compatibility with <a href="https://docs.ropensci.org/nodbi/reference/src_postgres.html" class="external-link">nodbi::src_postgres</a> is
needed, specify fewer than 50 fields, or use parent fields such as `"a.b"`
instead of `c("a.b.c.d", "a.b.c.e")` and then access sought fields with
<a href="dfTrials2Long.html">dfTrials2Long</a> followed by <a href="dfName2Value.html">dfName2Value</a> or with other R functions.</p></dd>


<dt id="arg-calculate">calculate<a class="anchor" aria-label="anchor" href="#arg-calculate"></a></dt>
<dd><p>Vector of one or more strings, which are names of functions
to calculate certain trial concepts from fields in the collection, across
different registers. See <a href="ctrdata-trial-concepts.html">ctrdata-trial-concepts</a> for available functions.</p></dd>


<dt id="arg-con">con<a class="anchor" aria-label="anchor" href="#arg-con"></a></dt>
<dd><p>A database connection object, created with
<code>nodbi</code>. See section `1 - Database connection` in
<a href="ctrdata.html">ctrdata</a>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>If <code>TRUE</code>, prints additional information
(default <code>FALSE</code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame (or tibble, if <code>tibble</code> is loaded)
with columns corresponding to the sought fields.
A column with the record `_id` will always be included.
The maximum number of rows of the returned data frame is equal to the number
of trial records in the database collection, or less if none of the fields
has a value in a record.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Within a given trial record, a field can be hierarchical and structured,
that is, nested. The function simplifies the structure of nested data and
may concatenate multiple strings in a field using " / " (see example)
and may have widened the returned data frame with additional columns that
were recursively expanded from simply nested data (e.g., "externalRefs"
to columns "externalRefs.doi", "externalRefs.eudraCTNumber" etc.).
For an alternative ways for handling complex nested data, see
<a href="dfTrials2Long.html">dfTrials2Long</a> and <a href="dfName2Value.html">dfName2Value</a> for extracting
the sought variable(s).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dbc</span> <span class="op">&lt;-</span> <span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/nodbi/reference/src_sqlite.html" class="external-link">src_sqlite</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  dbname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"demo.sqlite"</span>, package <span class="op">=</span> <span class="st">"ctrdata"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  collection <span class="op">=</span> <span class="st">"my_trials"</span>,</span></span>
<span class="r-in"><span>  flags <span class="op">=</span> <span class="fu">RSQLite</span><span class="fu">::</span><span class="va"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLITE_RO</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get fields that are nested within another field</span></span></span>
<span class="r-in"><span><span class="co"># and can have multiple values with the nested field</span></span></span>
<span class="r-in"><span><span class="fu">dbGetFieldsIntoDf</span><span class="op">(</span></span></span>
<span class="r-in"><span>  fields <span class="op">=</span> <span class="st">"b1_sponsor.b31_and_b32_status_of_the_sponsor"</span>,</span></span>
<span class="r-in"><span>  con <span class="op">=</span> <span class="va">dbc</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Querying database (1 fields)...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   `_id`             b1_sponsor.b31_and_b32_status_of_the_sponsor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 2012-003632-23-CZ Commercial                                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> 2012-003632-23-SE Commercial                                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> 2014-002606-20-PT Commercial                                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> 2014-003556-31-GB Commercial                                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> 2014-003556-31-SE Commercial                                  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fields that are lists of string values are</span></span></span>
<span class="r-in"><span><span class="co"># returned by concatenating values with " / "</span></span></span>
<span class="r-in"><span><span class="fu">dbGetFieldsIntoDf</span><span class="op">(</span></span></span>
<span class="r-in"><span>  fields <span class="op">=</span> <span class="st">"keyword"</span>,</span></span>
<span class="r-in"><span>  con <span class="op">=</span> <span class="va">dbc</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Querying database (1 fields)...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   `_id`       keyword                                                           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> NCT03280147 Neonate / Sepsis / Antibiotics / Duration                         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> NCT03325439 Electroencephalographic neonatal seizures / Brivaracetam / Epilep…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> NCT03431558 Bovine Lactoferrin, Neonatal infection, Low Birth Weight          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> NCT04001712 early caffeine preterm                                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> NCT04041765 IgM-enriched Intravenous Immunoglobulin                           </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate new field(s) from data across trials</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">dbGetFieldsIntoDf</span><span class="op">(</span></span></span>
<span class="r-in"><span>  fields <span class="op">=</span> <span class="st">"keyword"</span>,</span></span>
<span class="r-in"><span>  calculate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"f.statusRecruitment"</span>, <span class="st">"f.isUniqueTrial"</span>, <span class="st">"f.startDate"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  con <span class="op">=</span> <span class="va">dbc</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> To review trial concepts details, call 'help("ctrdata-trial-concepts")'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Querying database (25 fields)...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculating f.statusRecruitment...                            
</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculating f.isUniqueTrial...                            
</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Searching for duplicate trials... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> - Getting all trial identifiers...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> , 31 found in collection</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> - Finding duplicates among registers' and sponsor ids...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> - 2 EUCTR _id were not preferred EU Member State record for 11 trials</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> - Unique are 8 / 5 / 5 / 3 / 8 records from CTGOV / CTGOV2 / CTIS / EUCTR / ISRCTN</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> = Returning keys (_id) of 29 records in collection "my_trials"</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculating f.startDate...                            
</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">.statusRecruitment</span>, exclude <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ongoing   completed ended early       other </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           8          16           5           2 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.isUniqueTrial</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">.statusRecruitment</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.isUniqueTrial</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ecdf.html" class="external-link">stat_ecdf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="va">.startDate</span>,</span></span>
<span class="r-in"><span>    colour <span class="op">=</span> <span class="va">.statusRecruitment</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ralf Herold.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>


<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Load and store register trial information — ctrLoadQueryIntoDb • ctrdata</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Load and store register trial information — ctrLoadQueryIntoDb"><meta name="description" content="Retrieves information on clinical trials from registers
and stores it in a collection in a database. Main function
of ctrdata for accessing registers.
A collection can store trial information from different queries
or different registers. Query details are stored in the
collection and can be accessed using dbQueryHistory.
A previous query can be re-run, which replaces or adds trial
records while keeping any user annotations of trial records."><meta property="og:description" content="Retrieves information on clinical trials from registers
and stores it in a collection in a database. Main function
of ctrdata for accessing registers.
A collection can store trial information from different queries
or different registers. Query details are stored in the
collection and can be accessed using dbQueryHistory.
A previous query can be re-run, which replaces or adds trial
records while keeping any user annotations of trial records."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@rfhb"><meta name="twitter:site" content="@rfhb"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ctrdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.19.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/ctrdata_install.html">Install R package ctrdata</a></li>
    <li><a class="dropdown-item" href="../articles/ctrdata_retrieve.html">Retrieve clinical trial information</a></li>
    <li><a class="dropdown-item" href="../articles/ctrdata_summarise.html">Summarise and analyse clinical trial information</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rfhb/ctrdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Load and store register trial information</h1>
      <small class="dont-index">Source: <a href="https://github.com/rfhb/ctrdata/blob/HEAD/R/ctrLoadQueryIntoDb.R" class="external-link"><code>R/ctrLoadQueryIntoDb.R</code></a></small>
      <div class="d-none name"><code>ctrLoadQueryIntoDb.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Retrieves information on clinical trials from registers
and stores it in a collection in a database. Main function
of <a href="ctrdata.html">ctrdata</a> for accessing registers.
A collection can store trial information from different queries
or different registers. Query details are stored in the
collection and can be accessed using <a href="dbQueryHistory.html">dbQueryHistory</a>.
A previous query can be re-run, which replaces or adds trial
records while keeping any user annotations of trial records.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ctrLoadQueryIntoDb</span><span class="op">(</span></span>
<span>  queryterm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  register <span class="op">=</span> <span class="st">""</span>,</span>
<span>  querytoupdate <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  forcetoupdate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  euctrresults <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  euctrresultshistory <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ctgov2history <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  documents.path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  documents.regexp <span class="op">=</span> <span class="st">"prot|sample|statist|sap_|p1ar|p2ars|icf|ctalett|lay|^[0-9]+ "</span>,</span>
<span>  annotation.text <span class="op">=</span> <span class="st">""</span>,</span>
<span>  annotation.mode <span class="op">=</span> <span class="st">"append"</span>,</span>
<span>  only.count <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  con <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-queryterm">queryterm<a class="anchor" aria-label="anchor" href="#arg-queryterm"></a></dt>
<dd><p>Either a string with the full URL of a search
query in a register, or the data frame returned by the
<a href="ctrGetQueryUrl.html">ctrGetQueryUrl</a> or the
<a href="dbQueryHistory.html">dbQueryHistory</a> functions, or, together with parameter
<code>register</code>, a string with query elements of a search URL.
The query details are recorded in the <code>collection</code> for
later use to update records.
For "CTIS", <code>queryterm</code> can be an empty string to obtain
all trial records. For automatically copying the user's
query of a register in a web browser to the clipboard, see
<a href="https://rfhb.github.io/ctrdata/#id_2-script-to-automatically-copy-users-query-from-web-browser">here</a></p></dd>


<dt id="arg-register">register<a class="anchor" aria-label="anchor" href="#arg-register"></a></dt>
<dd><p>String with abbreviation of register to query,
either "EUCTR", "CTGOV2", "ISRCTN" or "CTIS". Not needed
if <code>queryterm</code> provides a full URL to query results.</p></dd>


<dt id="arg-querytoupdate">querytoupdate<a class="anchor" aria-label="anchor" href="#arg-querytoupdate"></a></dt>
<dd><p>Either the word "last", or the row number of
a query in the data frame returned by <a href="dbQueryHistory.html">dbQueryHistory</a> that
should be run to retrieve any new or update trial records since
this query was run the last time.
This parameter takes precedence over <code>queryterm</code>.
For "EUCTR", updates are available only for the last seven days;
the query is run again if more time has passed since it was
run last.
Does not work with "CTIS" at this time.</p></dd>


<dt id="arg-forcetoupdate">forcetoupdate<a class="anchor" aria-label="anchor" href="#arg-forcetoupdate"></a></dt>
<dd><p>If <code>TRUE</code>, run again the query
given in <code>querytoupdate</code>, irrespective of when it was
run last. Default is <code>FALSE</code>.</p></dd>


<dt id="arg-euctrresults">euctrresults<a class="anchor" aria-label="anchor" href="#arg-euctrresults"></a></dt>
<dd><p>If <code>TRUE</code>, also download available
results when retrieving and loading trials from EUCTR. This
slows down this function. (For "CTGOV2" and "CTIS",
available results are always retrieved and loaded into the
collection.)</p></dd>


<dt id="arg-euctrresultshistory">euctrresultshistory<a class="anchor" aria-label="anchor" href="#arg-euctrresultshistory"></a></dt>
<dd><p>If <code>TRUE</code>, also download
available history of results publication in "EUCTR."
This is quite time-consuming. Default is <code>FALSE</code>.</p></dd>


<dt id="arg-ctgov-history">ctgov2history<a class="anchor" aria-label="anchor" href="#arg-ctgov-history"></a></dt>
<dd><p>For trials from CTGOV2, retrieve historic
versions of the record. Default is <code>FALSE</code>, because this
is a time-consuming operation. Use
<code>n</code> for n from all versions (recommended),
<code>1</code> for the first (original) version,
<code>-1</code> for the last-but-one version,
<code>"n:m"</code> for the nth to the mth versions, or
<code>TRUE</code> for all versions
of the trial record to be retrieved. Note that for register
CTIS, historic versions were available in the `applications`
field only before the register's relaunch on 2024-06-17.</p></dd>


<dt id="arg-documents-path">documents.path<a class="anchor" aria-label="anchor" href="#arg-documents-path"></a></dt>
<dd><p>If this is a relative or absolute
path to a directory that exists or can be created,
save any documents into it that are directly available from
the register ("EUCTR", "CTGOV2", "ISRCTN", "CTIS")
such as PDFs on results, analysis plans, spreadsheets,
patient information sheets, assessments or product information.
Default is <code>NULL</code>, which disables saving documents.
For "EUCTR", sets <code>euctrresults = TRUE</code> since documents
are available only with results.</p></dd>


<dt id="arg-documents-regexp">documents.regexp<a class="anchor" aria-label="anchor" href="#arg-documents-regexp"></a></dt>
<dd><p>Regular expression, case insensitive,
to select documents by filename, if saving documents is requested
(see <code>documents.path</code>).
If set to <code>NULL</code>, empty placeholder files are saved for
every document that could be saved. Default is
<code>"prot|sample|statist|sap_|p1ar|p2ars|icf|ctalett|lay|^[0-9]+ "</code>.
Used with "CTGOV2", "ISRCTN" and "CTIS" (for "EUCTR", all documents
are downloaded since they are few and have non-canonical filenames.)</p></dd>


<dt id="arg-annotation-text">annotation.text<a class="anchor" aria-label="anchor" href="#arg-annotation-text"></a></dt>
<dd><p>Text to be including into the field
"annotation" in the records retrieved with the query
that is to be loaded into the collection.
The contents of the field "annotation" for a trial record
are preserved e.g. when running this function again and
loading a record of a with an annotation, see parameter
<code>annotation.mode</code>.</p></dd>


<dt id="arg-annotation-mode">annotation.mode<a class="anchor" aria-label="anchor" href="#arg-annotation-mode"></a></dt>
<dd><p>One of "append" (default), "prepend"
or "replace" for new annotation.text with respect to any
existing annotation for the records retrieved with the query
that is to be loaded into the collection.</p></dd>


<dt id="arg-only-count">only.count<a class="anchor" aria-label="anchor" href="#arg-only-count"></a></dt>
<dd><p>Set to <code>TRUE</code> to return only the
number of trial records found in the register for the query.
Does not load trial information into the database.
Default is <code>FALSE</code>.</p></dd>


<dt id="arg-con">con<a class="anchor" aria-label="anchor" href="#arg-con"></a></dt>
<dd><p>A connection object, see section
`Databases` in <a href="ctrdata.html">ctrdata</a>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Printing additional information if set to
<code>TRUE</code>; default is <code>FALSE</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Do not use (capture deprecated parameters).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with elements
`n` (number of trial records newly imported or updated),
`success` (a vector of _id's of successfully loaded records),
`failed` (a vector of identifiers of records that failed to load)
and `queryterm` (the query term used).
The returned list has several attributes (including database and
collection name, as well as the query history of this database
collection) to facilitate documentation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dbc</span> <span class="op">&lt;-</span> <span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/nodbi/reference/src_sqlite.html" class="external-link">src_sqlite</a></span><span class="op">(</span>collection <span class="op">=</span> <span class="st">"my_collection"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Retrieve protocol- and results-related information</span></span></span>
<span class="r-in"><span><span class="co"># on two specific trials identified by their EU number</span></span></span>
<span class="r-in"><span><span class="fu">ctrLoadQueryIntoDb</span><span class="op">(</span></span></span>
<span class="r-in"><span>  queryterm <span class="op">=</span> <span class="st">"2005-001267-63+OR+2008-003606-33"</span>,</span></span>
<span class="r-in"><span>  register <span class="op">=</span> <span class="st">"EUCTR"</span>,</span></span>
<span class="r-in"><span>  euctrresults <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  con <span class="op">=</span> <span class="va">dbc</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Count ongoing interventional cancer trials involving children</span></span></span>
<span class="r-in"><span><span class="co"># Note this query is a classical CTGOV query and is translated</span></span></span>
<span class="r-in"><span><span class="co"># to a corresponding query for the current CTGOV2 webinterface</span></span></span>
<span class="r-in"><span><span class="fu">ctrLoadQueryIntoDb</span><span class="op">(</span></span></span>
<span class="r-in"><span>  queryterm <span class="op">=</span> <span class="st">"cond=cancer&amp;recr=Open&amp;type=Intr&amp;age=0"</span>,</span></span>
<span class="r-in"><span>  register <span class="op">=</span> <span class="st">"CTGOV"</span>,</span></span>
<span class="r-in"><span>  only.count <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  con <span class="op">=</span> <span class="va">dbc</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Retrieve all information on more than 40 trials</span></span></span>
<span class="r-in"><span><span class="co"># that are labelled as phase 3 and that mention</span></span></span>
<span class="r-in"><span><span class="co"># either neuroblastoma or lymphoma from ISRCTN,</span></span></span>
<span class="r-in"><span><span class="co"># into the same collection as used before</span></span></span>
<span class="r-in"><span><span class="fu">ctrLoadQueryIntoDb</span><span class="op">(</span></span></span>
<span class="r-in"><span>  queryterm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"https://www.isrctn.com/search?"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"q=neuroblastoma+OR+lymphoma&amp;filters=phase%3APhase+III"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  con <span class="op">=</span> <span class="va">dbc</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Retrieve information trials in CTIS mentioning neonates</span></span></span>
<span class="r-in"><span><span class="fu">ctrLoadQueryIntoDb</span><span class="op">(</span></span></span>
<span class="r-in"><span>  queryterm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://euclinicaltrials.eu/ctis-public/"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"search#searchCriteria={%22containAll%22:%22%22,"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"%22containAny%22:%22neonates%22,%22containNot%22:%22%22}"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  con <span class="op">=</span> <span class="va">dbc</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ralf Herold.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>


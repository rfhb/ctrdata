<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ctrdata">
<title>Summarise and analyse clinical trial information • ctrdata</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Summarise and analyse clinical trial information">
<meta property="og:description" content="ctrdata">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@rfhb">
<meta name="twitter:site" content="@rfhb">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ctrdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.10.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ctrdata_install.html">Install R package ctrdata</a>
    <a class="dropdown-item" href="../articles/ctrdata_retrieve.html">Retrieve clinical trial information</a>
    <a class="dropdown-item" href="../articles/ctrdata_summarise.html">Summarise and analyse clinical trial information</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rfhb/ctrdata/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Summarise and analyse clinical trial information</h1>
                        <h4 data-toc-skip class="author">Ralf
Herold</h4>
            
            <h4 data-toc-skip class="date">2022-03-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rfhb/ctrdata/blob/HEAD/vignettes/ctrdata_summarise.Rmd" class="external-link"><code>vignettes/ctrdata_summarise.Rmd</code></a></small>
      <div class="d-none name"><code>ctrdata_summarise.Rmd</code></div>
    </div>

    
    
<p>General information on the <code>ctrdata</code> package is available
here: <a href="https://github.com/rfhb/ctrdata" class="external-link">https://github.com/rfhb/ctrdata</a>.</p>
<p>Remember to respect the registers’ terms and conditions (see
<code>ctrOpenSearchPagesInBrowser(copyright = TRUE)</code>). Please cite
this package in any publication as follows: Ralf Herold (2022). ctrdata:
Retrieve and Analyze Clinical Trials in Public Registers. R package
version 1.9.0. <a href="https://cran.r-project.org/package=ctrdata" class="external-link uri">https://cran.r-project.org/package=ctrdata</a></p>
<div class="section level2">
<h2 id="preparations">Preparations<a class="anchor" aria-label="anchor" href="#preparations"></a>
</h2>
<p>Here using MongoDB, which is faster than SQLite, can handle
credentials, provides access to remote servers and can directly retrieve
nested elements from paths. See <a href="../README.html">README.md</a> and
<a href="ctrdata_retrieve.Rmd">Retrieve clinical trial information</a>
for examples using SQLite. Also PostgreSQL can be used as database, see
<a href="ctrdata_install.Rmd">Install R package ctrdata</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/nodbi/reference/src_mongo.html" class="external-link">src_mongo</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="st">"mongodb://localhost"</span>,</span>
<span>  db <span class="op">=</span> <span class="st">"my_database_name"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"my_collection_name"</span><span class="op">)</span></span>
<span><span class="va">db</span></span>
<span><span class="co"># MongoDB 5.0.6 (uptime: 387411s)</span></span>
<span><span class="co"># URL: mongodb://localhost</span></span>
<span><span class="co"># Database: my_database_name</span></span>
<span><span class="co"># Collection: my_collection_name</span></span></code></pre></div>
<p>See <a href="ctrdata_retrieve.Rmd">Retrieve clinical trial
information</a> for more details.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=ctrdata" class="external-link">ctrdata</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># These two queries are similar, for completed interventional (drug)</span></span>
<span><span class="co"># trials with children with a neuroblastoma from either register</span></span>
<span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  <span class="co"># using queryterm and register ...</span></span>
<span>  queryterm <span class="op">=</span> <span class="st">"query=neuroblastoma&amp;age=under-18&amp;status=completed"</span>,</span>
<span>  register <span class="op">=</span> <span class="st">"EUCTR"</span>,</span>
<span>  euctrresults <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  <span class="co"># or using full URL of search results</span></span>
<span>  queryterm <span class="op">=</span></span>
<span>    <span class="st">"https://clinicaltrials.gov/ct2/results?cond=neuroblastoma&amp;recrs=e&amp;age=0&amp;intr=Drug"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dbQueryHistory.html">dbQueryHistory</a></span><span class="op">(</span>con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span><span class="co">#       query-timestamp query-register query-records                                        query-term</span></span>
<span><span class="co"># 1 2022-03-19 10:53:29          EUCTR           146 query=neuroblastoma&amp;age=under-18&amp;status=completed</span></span>
<span><span class="co"># 2 2022-03-19 10:53:39          CTGOV           200        cond=neuroblastoma&amp;recrs=e&amp;age=0&amp;intr=Drug</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="find-fields-variables-of-interest">Find fields / variables of interest<a class="anchor" aria-label="anchor" href="#find-fields-variables-of-interest"></a>
</h2>
<p>Specify a part of the name of a variable of interest; all variables
including deeply nested variable names are searched.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dbFindFields.html">dbFindFields</a></span><span class="op">(</span>namepart <span class="op">=</span> <span class="st">"date"</span>, con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span><span class="co"># Finding fields in database collection (may take some time)</span></span>
<span><span class="co"># Field names cached for this session.</span></span>
<span><span class="co">#                                                                    EUCTR</span></span>
<span><span class="co">#                                 "n_date_of_competent_authority_decision"</span></span>
<span><span class="co">#                                                                    EUCTR</span></span>
<span><span class="co">#                                  "p_date_of_the_global_end_of_the_trial"</span></span>
<span><span class="co">#                                                                    EUCTR</span></span>
<span><span class="co">#                                     "trialInformation.analysisStageDate"</span></span>
<span><span class="co">#                                                                    EUCTR</span></span>
<span><span class="co">#                                  "trialInformation.globalEndOfTrialDate"</span></span>
<span><span class="co">#                                                                    EUCTR</span></span>
<span><span class="co">#                                 "trialInformation.primaryCompletionDate"</span></span>
<span><span class="co">#                                                                    EUCTR</span></span>
<span><span class="co">#                                  "trialInformation.recruitmentStartDate"</span></span>
<span><span class="co">#                                                                    EUCTR</span></span>
<span><span class="co"># "x6_date_on_which_this_record_was_first_entered_in_the_eudract_database"</span></span>
<span><span class="co">#                                                                    EUCTR</span></span>
<span><span class="co">#                                     "n_date_of_ethics_committee_opinion"</span></span>
<span><span class="co">#                                                                    CTGOV</span></span>
<span><span class="co">#                                                        "completion_date"</span></span>
<span><span class="co">#                                                                    CTGOV</span></span>
<span><span class="co">#                                                     "last_update_posted"</span></span>
<span><span class="co">#                                                                    CTGOV</span></span>
<span><span class="co">#                                                  "last_update_submitted"</span></span>
<span><span class="co">#                                                                    CTGOV</span></span>
<span><span class="co">#                                               "last_update_submitted_qc"</span></span>
<span><span class="co">#                                                                    CTGOV</span></span>
<span><span class="co">#                                                "primary_completion_date"</span></span>
<span><span class="co">#                                                                    CTGOV</span></span>
<span><span class="co">#                                          "required_header.download_date"</span></span>
<span><span class="co">#                                                                    CTGOV</span></span>
<span><span class="co">#                                                             "start_date"</span></span>
<span><span class="co">#                                                                    CTGOV</span></span>
<span><span class="co">#                                                      "verification_date"</span></span>
<span><span class="co">#                                                                    CTGOV</span></span>
<span><span class="co">#              "provided_document_section.provided_document.document_date"</span></span></code></pre></div>
<p>The search for fields is cached and thus accelerated during the R
session, as long as no new <code><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb()</a></code> is
executed.</p>
</div>
<div class="section level2">
<h2 id="data-frame-from-database">Data frame from database<a class="anchor" aria-label="anchor" href="#data-frame-from-database"></a>
</h2>
<p>The fields of interest can be obtained from the database and are
represented in an R data.frame:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"f41_in_the_member_state"</span>,</span>
<span>    <span class="st">"f422_in_the_whole_clinical_trial"</span>,</span>
<span>    <span class="st">"a1_member_state_concerned"</span>,</span>
<span>    <span class="st">"p_end_of_trial_status"</span>,</span>
<span>    <span class="st">"n_date_of_competent_authority_decision"</span>,</span>
<span>    <span class="st">"a2_eudract_number"</span>,</span>
<span>    <span class="st">"overall_status"</span>,</span>
<span>    <span class="st">"start_date"</span>,</span>
<span>    <span class="st">"primary_completion_date"</span><span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="metadata-from-data-frame">Metadata from data frame<a class="anchor" aria-label="anchor" href="#metadata-from-data-frame"></a>
</h2>
<p>The objects returned by functions of this package include attributes
with metadata to indicate from which database, table / collection and
query details. Metadata can be reused in R.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># [...]</span></span>
<span><span class="co"># $`ctrdata-dbname`</span></span>
<span><span class="co"># [1] "my_database_name"</span></span>
<span></span>
<span><span class="co"># $`ctrdata-table`</span></span>
<span><span class="co"># [1] "my_collection_name"</span></span>
<span></span>
<span><span class="co"># $`ctrdata-dbqueryhistory`</span></span>
<span><span class="co">#       query-timestamp query-register query-records                                        query-term</span></span>
<span><span class="co"># 1 2022-03-19 10:53:29          EUCTR           146 query=neuroblastoma&amp;age=under-18&amp;status=completed</span></span>
<span><span class="co"># 2 2022-03-19 10:53:39          CTGOV           200        cond=neuroblastoma&amp;recrs=e&amp;age=0&amp;intr=Drug</span></span></code></pre></div>
<p>In the database, the variable “_id” is the unique index for a record.
This “_id” is the NCT number for CTGOV records (e.g., “NCT00002560”),
and it is the EudraCT number for EUCTR records including the postfix
identifying the EU Member State (e.g., “2008-001436-12-NL”).</p>
<p>It is relevant to de-duplicate records because a trial can be
registered in both CTGOV and EUCTR, and can have records by involved
country in EUCTR.</p>
<p>De-duplication is done at the analysis stage because this enables to
select if a trial record should be taken from one or the other register,
and from one or the other EU Member State.</p>
<p>The basis of de-duplication is the recording of additional trial
identifiers in supplementary fields (variables), which are checked and
reported when using function <code><a href="../reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Obtain de-duplicated trial record ids</span></span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials</a></span><span class="op">(</span></span>
<span>  preferregister <span class="op">=</span> <span class="st">"EUCTR"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Searching for duplicate trials...</span></span>
<span><span class="co">#  - Getting trial ids (may take some time), 346 found in collection</span></span>
<span><span class="co">#  - Finding duplicates among registers' and sponsor ids...</span></span>
<span><span class="co">#  - 106 EUCTR _id were not preferred EU Member State record for 42 trials</span></span>
<span><span class="co">#  - Keeping 187 / 40 records from CTGOV / EUCTR</span></span>
<span><span class="co"># = Returning keys (_id) of 227 records in collection "my_collection_name"</span></span></code></pre></div>
<p>The unique ids can be used like this to de-duplicate the data.frame
created above:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Eliminate duplicate trials records:</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span> <span class="va">result</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ids</span>, <span class="op">]</span></span>
<span><span class="co">#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># [1] 227</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simple-analysis---dates">Simple analysis - dates<a class="anchor" aria-label="anchor" href="#simple-analysis---dates"></a>
</h2>
<p>In a data.frame generated with <code><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf()</a></code>,
fields are typed as dates, logical, character or numbers.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># 'data.frame':   227 obs. of  10 variables:</span></span>
<span><span class="co"># $ _id                                   : chr  "2004-004386-15-DE" "2005-000915-80-IT" "2005-001267-63-IT" ...</span></span>
<span><span class="co"># $ f41_in_the_member_state               : int  NA NA 5 37 70 24 100 35 10 24 ...</span></span>
<span><span class="co"># $ f422_in_the_whole_clinical_trial      : int  230 NA 12 67 70 NA 100 156 2230 NA ...</span></span>
<span><span class="co"># $ a1_member_state_concerned             : chr  "Germany - BfArM" "Italy - Italian Medicines Agency" ...</span></span>
<span><span class="co"># $ p_end_of_trial_status                 : chr  "Completed" "Completed" "Completed" "Completed" ...</span></span>
<span><span class="co"># $ n_date_of_competent_authority_decision: Date, format: "2005-07-08" "2005-04-21" "2005-07-08" "2006-05-26" ...</span></span>
<span><span class="co"># $ a2_eudract_number                     : chr  "2004-004386-15" "2005-000915-80" "2005-001267-63" "2005-002089-13" ...</span></span>
<span><span class="co"># $ overall_status                        : chr  NA NA NA NA ...</span></span>
<span><span class="co"># $ start_date                            : Date, format: NA NA NA NA ...</span></span>
<span><span class="co"># $ primary_completion_date               : Date, format: NA NA NA NA ...</span></span></code></pre></div>
<p>This typing facilitates using the respective type of data for
analysis, for example of dates with base R graphics:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Open file for saving</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"vignettes/nb1.png"</span><span class="op">)</span></span>
<span><span class="co"># Visualise trial start date</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"n_date_of_competent_authority_decision"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  breaks <span class="op">=</span> <span class="st">"years"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="nb1.png" alt=""><p class="caption">Histogram1</p>
</div>
</div>
<div class="section level2">
<h2 id="merge-corresponding-fields-from-registers">Merge corresponding fields from registers<a class="anchor" aria-label="anchor" href="#merge-corresponding-fields-from-registers"></a>
</h2>
<p>The field “n_date_of_competent_authority_decision” used above exists
only in EUCTR, yet it corresponds to the field “start_date” in CTGOV.
Thus, to give the start of the trial, the two fields can be merged for
analysis, using the convenience function
<code><a href="../reference/dfMergeTwoVariablesRelevel.html">dfMergeTwoVariablesRelevel()</a></code> in <code>ctrdata</code>
package:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Merge two variables into a new variable:</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">trialstart</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfMergeTwoVariablesRelevel.html">dfMergeTwoVariablesRelevel</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span>,</span>
<span>  colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"n_date_of_competent_authority_decision"</span>,</span>
<span>    <span class="st">"start_date"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unique values returned (first three): 2005-07-08, 2005-04-21, 2006-05-26</span></span>
<span></span>
<span><span class="co"># Plot from both registers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"vignettes/nb2.png"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"trialstart"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  breaks <span class="op">=</span> <span class="st">"years"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="nb2.png" alt=""><p class="caption">Histogram2</p>
</div>
<p>In a more sophisticated use of
<code><a href="../reference/dfMergeTwoVariablesRelevel.html">dfMergeTwoVariablesRelevel()</a></code>, values of the original
variables can be mapped into new values of the merged variable, as
follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, define how values of the new, merged variable</span></span>
<span><span class="co"># (e.g., "ongoing") will result from values of the</span></span>
<span><span class="co"># original variable (e.g, "Recruiting):</span></span>
<span><span class="va">mapped_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"ongoing"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Recruiting"</span>, <span class="st">"Active"</span>, <span class="st">"Ongoing"</span>,</span>
<span>                <span class="st">"Active, not recruiting"</span>,</span>
<span>                <span class="st">"Enrolling by invitation"</span>, <span class="st">"Restarted"</span><span class="op">)</span>,</span>
<span>  <span class="st">"completed"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Completed"</span>, <span class="st">"Prematurely Ended"</span>, <span class="st">"Terminated"</span><span class="op">)</span>,</span>
<span>  <span class="st">"other"</span>     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Withdrawn"</span>, <span class="st">"Suspended"</span>, <span class="st">"No longer available"</span>,</span>
<span>                  <span class="st">"Not yet recruiting"</span>, <span class="st">"Temporarily Halted"</span>,</span>
<span>                  <span class="st">"Unknown status"</span>, <span class="st">"GB - no longer in EU/EEA"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Secondly, use the list of mapped</span></span>
<span><span class="co"># values when merging two variable:</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfMergeTwoVariablesRelevel.html">dfMergeTwoVariablesRelevel</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span>,</span>
<span>  colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"overall_status"</span>,</span>
<span>               <span class="st">"p_end_of_trial_status"</span><span class="op">)</span>,</span>
<span>  levelslist <span class="op">=</span> <span class="va">mapped_values</span><span class="op">)</span></span>
<span><span class="co"># Unique values returned: completed, ongoing, other</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="co">#   completed   ongoing     other</span></span>
<span><span class="co">#         223         3         1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="annotations-made-by-user">Annotations made by user<a class="anchor" aria-label="anchor" href="#annotations-made-by-user"></a>
</h2>
<p>When using <code><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb()</a></code>, <code>ctrdata</code>
adds to each record the fields <code>annotation</code> and
<code>record_last_import</code>. The annotation field is a single string
that the user specifies when retrieving trials (<a href="ctrdata_retrieve.Rmd">Retrieve clinical trial information</a>).
The user can specify to append, prefix or replace any existing
annotations when a trial record is loaded again, see example below. The
last date and time when the trial record was imported is updated
automatically when using <code><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb()</a></code>. These fields
can also be used for analysis. For example, string functions can be used
for annotations, e.g. to split it into components. Since no annotations
were specified when retrieving the trials in the steps above, there are
so far no annotation fields and <code>stopifnodata</code> is set to
<code>FALSE</code> to avoid the function raises an error to alert
users:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  queryterm <span class="op">=</span> <span class="st">"query=neuroblastoma&amp;resultsstatus=trials-with-results"</span>,</span>
<span>  register <span class="op">=</span> <span class="st">"EUCTR"</span>,</span>
<span>  euctrresults <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  annotation.text <span class="op">=</span> <span class="st">"test annotation"</span>,</span>
<span>  annotation.mode <span class="op">=</span> <span class="st">"append"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/dbFindFields.html">dbFindFields</a></span><span class="op">(</span><span class="st">"clinical_results.outcome_list.outcome"</span>, <span class="va">db</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"annotation"</span>,</span>
<span>    <span class="st">"record_last_import"</span><span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># 'data.frame':   373 obs. of  3 variables:</span></span>
<span><span class="co">#  $ _id               : chr  "2004-004386-15-DE" "2004-004386-15-ES" "2004-004386-15-GB" ...</span></span>
<span><span class="co">#  $ annotation        : chr  "test annotation" "test annotation" "test annotation" ...</span></span>
<span><span class="co">#  $ record_last_import: Date, format: "2022-03-20" "2022-03-20" "2022-03-20" "2022-03-20"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analysing-nested-fields-such-as-trial-results">Analysing nested fields such as trial results<a class="anchor" aria-label="anchor" href="#analysing-nested-fields-such-as-trial-results"></a>
</h2>
<p>The registers represent clinical trial information by nesting fields
(e.g., several reporting groups within several measures within one of
several endpoints). A visualisation of this hierarchical representation
for CTGOV is this:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remotes::install_github("https://github.com/hrbrmstr/jsonview")</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span><span class="st">"clinical_results.outcome_list.outcome"</span>, <span class="va">db</span><span class="op">)</span></span>
<span><span class="fu">jsonview</span><span class="fu">::</span><span class="fu">json_tree_view</span><span class="op">(</span><span class="va">result</span><span class="op">[[</span><span class="st">"clinical_results.outcome_list.outcome"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span></span>
<span> <span class="va">result</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"NCT00520936"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="ctgovnested.png" alt=""><p class="caption">CtgovNested</p>
</div>
<p>The analysis of nested information such as the highlighted duration
of response is facilitated with <code>ctrdata</code> as follows. The
main steps are:</p>
<ul>
<li><p>transform nested information to a long, name-value data frame and
then</p></li>
<li><p>identify where the measures of interest (e.g. duration of
response, blue circles above) are located in the information hierarchy
by specifying the name and value of fields (<code>wherename</code>,
<code>wherevalue</code>) and finally</p></li>
<li><p>obtain the value by specifying the name(s) of its value field(s)
(<code>valuename</code>, red circles in figure above).</p></li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Create data frame from results fields.</span></span>
<span><span class="co"># These are the key results fields from</span></span>
<span><span class="co"># CTGOV and from EUCTR:</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># CTGOV</span></span>
<span>    <span class="st">"clinical_results.baseline.analyzed_list.analyzed.count_list.count"</span>,</span>
<span>    <span class="st">"clinical_results.baseline.group_list.group"</span>,</span>
<span>    <span class="st">"clinical_results.baseline.analyzed_list.analyzed.units"</span>,</span>
<span>    <span class="st">"clinical_results.outcome_list.outcome"</span>,</span>
<span>    <span class="st">"study_design_info.allocation"</span>,</span>
<span>    <span class="co"># EUCTR</span></span>
<span>    <span class="st">"@attributes.eudractNumber"</span>,</span>
<span>    <span class="st">"trialInformation.populationAgeGroup"</span>,</span>
<span>    <span class="st">"subjectDisposition.recruitmentDetails"</span>,</span>
<span>    <span class="st">"baselineCharacteristics.baselineReportingGroups.baselineReportingGroup"</span>,</span>
<span>    <span class="st">"endPoints.endPoint"</span>,</span>
<span>    <span class="st">"trialChanges.hasGlobalInterruptions"</span>,</span>
<span>    <span class="st">"subjectAnalysisSets"</span>,</span>
<span>    <span class="st">"adverseEvents.seriousAdverseEvents.seriousAdverseEvent"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Keep only unique trial records</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span> <span class="va">result</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="../reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials</a></span><span class="op">(</span>con <span class="op">=</span> <span class="va">db</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co"># [...]</span></span>
<span><span class="co">#  - Keeping 184 / 50 records from CTGOV / EUCTR</span></span>
<span><span class="co"># = Returning keys (_id) of 234 records in collection "my_collection_name"</span></span>
<span></span>
<span><span class="co"># 2. The columns of the results data frame</span></span>
<span><span class="co"># contain nested lists of fields, example:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">result</span><span class="op">[[</span><span class="st">"endPoints.endPoint"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># All nested data are transformed to a long,</span></span>
<span><span class="co"># name-value data.frame (resulting in several</span></span>
<span><span class="co"># hundred rows per trial record):</span></span>
<span><span class="va">long_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfTrials2Long.html">dfTrials2Long</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># Total 99006 rows, 143 unique names of variables</span></span>
<span></span>
<span><span class="co"># 3. Obtain values for fields of interest where</span></span>
<span><span class="co"># they related to measures of interest. The</span></span>
<span><span class="co"># parameters can be regular expressions.</span></span>
<span><span class="va">dor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfName2Value.html">dfName2Value</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">long_result</span>,</span>
<span>  wherename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"clinical_results.outcome_list.outcome.measure.title|"</span>,</span>
<span>    <span class="st">"endPoints.endPoint.title"</span><span class="op">)</span>,</span>
<span>  wherevalue <span class="op">=</span> <span class="st">"duration of response"</span>,</span>
<span>  valuename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"clinical_results.*category_list.category.measurement_list.measurement.value|"</span>,</span>
<span>    <span class="st">"endPoints.*armReportingGroup.tendencyValues.tendencyValue.value"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Duration of response has been reported variably in</span></span>
<span><span class="co"># months and days. Here, just select trials reporting</span></span>
<span><span class="co"># duration of response in months:</span></span>
<span><span class="va">dor</span> <span class="op">&lt;-</span> <span class="va">dor</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"months"</span>,</span>
<span>        <span class="fu"><a href="../reference/dfName2Value.html">dfName2Value</a></span><span class="op">(</span></span>
<span>          df <span class="op">=</span> <span class="va">long_result</span>,</span>
<span>          wherename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>            <span class="st">"clinical_results.*outcome.measure.title|"</span>,</span>
<span>            <span class="st">"endPoints.endPoint.title"</span><span class="op">)</span>,</span>
<span>          wherevalue <span class="op">=</span> <span class="st">"duration of response"</span>,</span>
<span>          valuename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>            <span class="st">"clinical_results.*measure.units|"</span>,</span>
<span>            <span class="st">"endPoints.endPoint.unit"</span><span class="op">)</span></span>
<span>        <span class="op">)</span><span class="op">[[</span><span class="st">"value"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>        ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># the identifier is generated to identify repeated and</span></span>
<span><span class="co"># nested elements in a trial, so that it permits to</span></span>
<span><span class="co"># find the valuename that corresponds to the item</span></span>
<span><span class="co"># for which wherename has wherevalue)</span></span>
<span><span class="va">dor</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"_id"</span>, <span class="st">"identifier"</span>, <span class="st">"value"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#                 _id identifier value</span></span>
<span><span class="co"># 1 2010-019348-37-IT        8.2   7.0</span></span>
<span><span class="co"># 2 2010-019348-37-IT        8.3   8.1</span></span>
<span><span class="co"># 5 2013-003595-12-SK        6.2 999.0</span></span>
<span><span class="co"># 6 2013-003595-12-SK        6.3 999.0</span></span>
<span><span class="co"># 7 2013-003595-12-SK        6.4 999.0</span></span>
<span><span class="co"># 8 2013-003595-12-SK        6.5 999.0</span></span>
<span><span class="co"># 9 2013-003595-12-SK        6.6 999.0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analysing-primary-endpoints">Analysing primary endpoints<a class="anchor" aria-label="anchor" href="#analysing-primary-endpoints"></a>
</h2>
<p>Text analysis has to be used for many fields of trial information
from the registers. Here is an example to simply categorise the type of
primary endpoint. In addition, the number of subjects are extracted and
compared by type of primary endpoint.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Several "measure" entries are in "primary_outcome".</span></span>
<span><span class="co"># They are concatenated into a list when specifying</span></span>
<span><span class="co"># the JSON path "primary_outcome.measure"</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="co"># CTGOV</span></span>
<span>  <span class="st">"primary_outcome.measure"</span>,</span>
<span>  <span class="st">"enrollment"</span>,</span>
<span>  <span class="co"># EUCTR</span></span>
<span>  <span class="st">"e51_primary_end_points"</span>,</span>
<span>  <span class="co"># "f11_trial_has_subjects_under_18"</span></span>
<span>  <span class="st">"f11_number_of_subjects_for_this_age_range"</span><span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># De-duplicate</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span>
<span>    <span class="fu"><a href="../reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials</a></span><span class="op">(</span>con <span class="op">=</span> <span class="va">db</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Merge primary endpoint (pep)</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">pep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfMergeTwoVariablesRelevel.html">dfMergeTwoVariablesRelevel</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">result</span>,</span>
<span>  colnames <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"primary_outcome.measure"</span>,</span>
<span>      <span class="st">"e51_primary_end_points"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge number of subjects</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">nsubj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfMergeTwoVariablesRelevel.html">dfMergeTwoVariablesRelevel</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">result</span>,</span>
<span>  colnames <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"enrollment"</span>,</span>
<span>      <span class="st">"f11_number_of_subjects_for_this_age_range"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For primary endpoint of interest,</span></span>
<span><span class="co"># use regular expression on text:</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">pep_is_efs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span></span>
<span>  pattern <span class="op">=</span> <span class="st">"((progression|event|relapse|recurrence|disease)[- ]free)|pfs|dfs|efs)"</span>,</span>
<span>  x <span class="op">=</span> <span class="va">result</span><span class="op">$</span><span class="va">pep</span>,</span>
<span>  ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tabulate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">pep_is_efs</span><span class="op">)</span></span>
<span><span class="co"># FALSE  TRUE</span></span>
<span><span class="co">#   184    21</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">result</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nsubj</span>,</span>
<span>           y <span class="op">=</span> <span class="va">pep_is_efs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/boxpep.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="boxpep.png" alt=""><p class="caption">BoxPEP</p>
</div>
</div>
<div class="section level2">
<h2 id="investigational-or-authorised-medicinal-product">Investigational or authorised medicinal product?<a class="anchor" aria-label="anchor" href="#investigational-or-authorised-medicinal-product"></a>
</h2>
<p>The information about the status of authorisation (licensing) of a
medicine used in a trial is recorded in EUCTR in the field
<code>dimp.d21_imp_to_be_used_in_the_trial_has_a_marketing_authorisation</code>.
A corresponding field in CTGOV is not known. The status is in the tree
starting from the <code>dimp</code> element.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get results</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a1_member_state_concerned"</span>,</span>
<span>      <span class="st">"n_date_of_competent_authority_decision"</span>,</span>
<span>      <span class="st">"dimp.d21_imp_to_be_used_in_the_trial_has_a_marketing_authorisation"</span>,</span>
<span>      <span class="st">"x6_date_on_which_this_record_was_first_entered_in_the_eudract_database"</span>,</span>
<span>      <span class="st">"f422_in_the_whole_clinical_trial"</span>,</span>
<span>      <span class="st">"a2_eudract_number"</span><span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find first date of authorisation in EU member state</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"n_date_of_competent_authority_decision"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">result</span><span class="op">[[</span><span class="st">"a2_eudract_number"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">result</span>,</span>
<span>  y <span class="op">=</span> <span class="va">tmp</span>,</span>
<span>  by.x <span class="op">=</span> <span class="st">"a2_eudract_number"</span>,</span>
<span>  by.y <span class="op">=</span> <span class="st">"Group.1"</span>,</span>
<span>  all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">result</span><span class="op">[[</span><span class="st">"startdatefirst"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfMergeTwoVariablesRelevel.html">dfMergeTwoVariablesRelevel</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">result</span>,</span>
<span>  colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"x"</span>,</span>
<span>    <span class="st">"x6_date_on_which_this_record_was_first_entered_in_the_eudract_database"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now de-duplicate</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span>
<span>    <span class="fu"><a href="../reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials</a></span><span class="op">(</span></span>
<span>      include3rdcountrytrials <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      con <span class="op">=</span> <span class="va">db</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># How many of the investigational medicinal product(s)</span></span>
<span><span class="co"># used in the trial are authorised?</span></span>
<span><span class="va">number_authorised</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"dimp.d21_imp_to_be_used_in_the_trial_has_a_marketing_authorisation"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">i</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">number_authorised</span>, exclude <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co"># number_authorised</span></span>
<span><span class="co">#  0  1  2  3  4  6  8 15 </span></span>
<span><span class="co"># 20 15  4  3  1  1  1  1 </span></span>
<span><span class="va">result</span><span class="op">[[</span><span class="st">"any_authorised"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">number_authorised</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">result</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">startdatefirst</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">any_authorised</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/breaks_width.html" class="external-link">breaks_width</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"2 years"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/date_format.html" class="external-link">date_format</a></span><span class="op">(</span><span class="st">"%Y"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">365.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Neuroblastoma trials in EU"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year of trial authorisation (or entered in EUCTR)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of trials"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Medicine\nauthorised?"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/nbtrials.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="nbtrials.png" alt=""><p class="caption">HistogramNBtrials</p>
</div>
</div>
<div class="section level2">
<h2 id="analyses-using-aggregation-pipeline-and-mapreduce">Analyses using aggregation pipeline and mapreduce<a class="anchor" aria-label="anchor" href="#analyses-using-aggregation-pipeline-and-mapreduce"></a>
</h2>
<p>Here is an example of analysis functions that can be run directly on
a MongoDB server, which are fast and do not consume R resources.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load library for database access</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jeroen/mongolite/" class="external-link">mongolite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create R object m to access the</span></span>
<span><span class="co"># collection db created above:</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mongolite/man/mongo.html" class="external-link">mongo</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">db</span><span class="op">[[</span><span class="st">"url"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"/"</span>, <span class="va">db</span><span class="op">[[</span><span class="st">"db"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>           collection <span class="op">=</span> <span class="va">db</span><span class="op">[[</span><span class="st">"collection"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Number of records in  collection:</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># [1] 374</span></span>
<span></span>
<span><span class="co"># Number of EUCTR records, using JSON for query:</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span>query <span class="op">=</span> <span class="st">'{"_id": {"$regex": "[0-9]{4}-[0-9]{6}-[0-9]{2}",</span></span>
<span><span class="st">                 "$options": "i"}}'</span><span class="op">)</span></span>
<span><span class="co">#[1] 173</span></span>
<span></span>
<span><span class="co"># Alternative:</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span>query <span class="op">=</span> <span class="st">'{"ctrname": "EUCTR"}'</span><span class="op">)</span></span>
<span><span class="co"># [1] 173</span></span>
<span></span>
<span><span class="co"># Number of CTGOV records:</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span>query <span class="op">=</span> <span class="st">'{"_id": {"$regex": "NCT[0-9]{8}",</span></span>
<span><span class="st">                 "$options": "i"}}'</span><span class="op">)</span></span>
<span><span class="co"># [1] 200</span></span>
<span></span>
<span><span class="co"># Alternative:</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span>query <span class="op">=</span> <span class="st">'{"ctrname": "CTGOV"}'</span><span class="op">)</span></span>
<span><span class="co"># [1] 200</span></span>
<span></span>
<span><span class="co"># To best define regular expressions for analyses,</span></span>
<span><span class="co"># inspect the field (here, primary_outcome.measure):</span></span>
<span><span class="co"># Regular expressions ("$regex") are case insensitive ("i")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span></span>
<span>  <span class="va">m</span><span class="op">$</span><span class="fu">distinct</span><span class="op">(</span>key <span class="op">=</span> <span class="st">"primary_outcome.measure"</span>,</span>
<span>             query <span class="op">=</span> <span class="st">'{"_id": {"$regex": "NCT[0-9]{8}", "$options": "i"}}'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] "- To demonstrate that 123I-mIBG planar scintigraphy is sensitive and ..."</span></span>
<span><span class="co"># [2] "1-year Progression-free Survival"</span></span>
<span><span class="co"># [3] "Ability of iodine I 131 metaiodobenzylguanidine to provide palliative therapy"</span></span>
<span><span class="co"># [4] "Acute and late toxicities"</span></span>
<span><span class="co"># [5] "Adverse events as a measure of safety/tolerability"</span></span>
<span><span class="co"># [6] "Adverse events as assessed by (CTCAE) version 4.0"</span></span></code></pre></div>
<div class="section level3">
<h3 id="aggregation">Aggregation<a class="anchor" aria-label="anchor" href="#aggregation"></a>
</h3>
<p>The following example uses the aggregation pipeline in MongoDB. See
here for details on mongo’s aggregation pipleline: <a href="https://docs.mongodb.org/manual/core/aggregation-pipeline/" class="external-link uri">https://docs.mongodb.org/manual/core/aggregation-pipeline/</a></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Total count of PFS, EFS, RFS or DFS</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span></span>
<span>  <span class="co"># Count number of documents in collection that</span></span>
<span>  <span class="co"># matches in primary_outcome.measure the</span></span>
<span>  <span class="co"># regular expression,</span></span>
<span>  pipeline <span class="op">=</span></span>
<span>    <span class="st">'[{"$match": {"primary_outcome.measure":</span></span>
<span><span class="st">      {"$regex": "(progression|event|relapse|recurrence|disease)[- ]free",</span></span>
<span><span class="st">                 "$options": "i"}}},</span></span>
<span><span class="st">      {"$group": {"_id": "null", "count": {"$sum": 1}}}]'</span><span class="op">)</span></span>
<span><span class="va">out</span></span>
<span><span class="co">#    _id count</span></span>
<span><span class="co"># 1 null    16</span></span>
<span></span>
<span><span class="co"># List records of trials with overall survival </span></span>
<span><span class="co"># as primary endpoint, and list start date</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span></span>
<span>  pipeline <span class="op">=</span></span>
<span>    <span class="st">'[{"$match": {"primary_outcome.measure":</span></span>
<span><span class="st">      {"$regex": "overall survival", "$options": "i"}}},</span></span>
<span><span class="st">      {"$project": {"_id": 1, "start_date": 1}}]'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#           _id      start_date</span></span>
<span><span class="co"># 1 NCT00499616 October 8, 2007</span></span>
<span><span class="co"># 2 NCT00793845     August 2008</span></span>
<span><span class="co"># 3 NCT00923351    June 2, 2007</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mapreduce">Mapreduce<a class="anchor" aria-label="anchor" href="#mapreduce"></a>
</h3>
<p>The following examples uses the map-reduce operation in MongoDB. Note
this is deprecated starting in MongoDB 5. More information: <a href="https://docs.mongodb.com/manual/core/map-reduce/" class="external-link uri">https://docs.mongodb.com/manual/core/map-reduce/</a></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Count number of trials by number of study </span></span>
<span><span class="co"># participants in bins of hundreds of participants:</span></span>
<span><span class="va">hist</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">$</span><span class="fu">mapreduce</span><span class="op">(</span></span>
<span>  map <span class="op">=</span> <span class="st">"function() {emit(Math.floor(this.f422_in_the_whole_clinical_trial/100)*100, 1)}"</span>,</span>
<span>  reduce <span class="op">=</span> <span class="st">"function(id, counts) {return Array.sum(counts)}"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># read as: 85 trials had 0 to less than 100 participants</span></span>
<span><span class="va">hist</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">hist</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="co">#     _id value</span></span>
<span><span class="co"># 4     0    85</span></span>
<span><span class="co"># 7   100    45</span></span>
<span><span class="co"># 10  200    11</span></span>
<span><span class="co"># 6   300     4</span></span>
<span><span class="co"># 5   400     9</span></span>
<span><span class="co"># 2   600     1</span></span>
<span><span class="co"># 3  2200     4</span></span>
<span><span class="co"># 9  2700     2</span></span>
<span><span class="co"># 8  3300     4</span></span>
<span><span class="co"># 1   NaN   209</span></span></code></pre></div>
<!--
# rewriting this to use aggregate because mapreduce 
# is deprecated starting from MongoDB 5: 

m$aggregate('[
    {"$group":{"_id": {"$floor": {"$divide": [ {"$toInt": "$f422_in_the_whole_clinical_trial"}, 100 ]}}}}]')
m$aggregate(
  pipeline = '[
  {"$project": {"$emits": {"participantBin": {"$floor": "$f422_in_the_whole_clinical_trial"}}}},
  {"$group": {"numberTrials": { "$sum": "participantBin" }}}
  ]')

tmp <- jsonlite::validate('[
  {"$project": {"participantBin": { "$floor": "$f422_in_the_whole_clinical_trial"}}, "value": 1}
  ]')

cat(attr(tmp, "err"))
-->
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ralf Herold.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

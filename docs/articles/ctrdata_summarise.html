<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Summarise and analyse clinical trial information • ctrdata</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Summarise and analyse clinical trial information">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ctrdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.19.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ctrdata_install.html">Install R package ctrdata</a></li>
    <li><a class="dropdown-item" href="../articles/ctrdata_retrieve.html">Retrieve clinical trial information</a></li>
    <li><a class="dropdown-item" href="../articles/ctrdata_summarise.html">Summarise and analyse clinical trial information</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rfhb/ctrdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Summarise and analyse clinical trial information</h1>
                        <h4 data-toc-skip class="author">Ralf
Herold</h4>
            
            <h4 data-toc-skip class="date">2024-06-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rfhb/ctrdata/blob/HEAD/vignettes/ctrdata_summarise.Rmd" class="external-link"><code>vignettes/ctrdata_summarise.Rmd</code></a></small>
      <div class="d-none name"><code>ctrdata_summarise.Rmd</code></div>
    </div>

    
    
<p>General information on the <code>ctrdata</code> package is available
here: <a href="https://github.com/rfhb/ctrdata" class="external-link">https://github.com/rfhb/ctrdata</a>.</p>
<p>Remember to respect the registers’ terms and conditions (see
<code>ctrOpenSearchPagesInBrowser(copyright = TRUE)</code>). Please cite
this package in any publication as follows: Ralf Herold (2024). ctrdata:
Retrieve and Analyze Clinical Trials in Public Registers. R package
version 1.18.0. <a href="https://cran.r-project.org/package=ctrdata" class="external-link uri">https://cran.r-project.org/package=ctrdata</a></p>
<div class="section level2">
<h2 id="preparations">Preparations<a class="anchor" aria-label="anchor" href="#preparations"></a>
</h2>
<p>Here using MongoDB, which is faster than SQLite, can handle
credentials, provides access to remote servers and can directly retrieve
nested elements from paths. See <a href="../README.html">README.md</a> and
<a href="ctrdata_retrieve.Rmd">Retrieve clinical trial information</a>
for examples using SQLite. Also PostgreSQL can be used as database, see
<a href="ctrdata_install.Rmd">Install R package ctrdata</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/nodbi/reference/src_mongo.html" class="external-link">src_mongo</a></span><span class="op">(</span></span>
<span>url <span class="op">=</span> <span class="st">"mongodb://localhost"</span>,</span>
<span>db <span class="op">=</span> <span class="st">"my_database_name"</span>,</span>
<span>collection <span class="op">=</span> <span class="st">"my_collection_name"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">db</span></span>
<span><span class="co"># MongoDB 7.0.8 (uptime: 265661s)</span></span>
<span><span class="co"># URL: mongodb://localhost</span></span>
<span><span class="co"># Database: my_database_name</span></span>
<span><span class="co"># Collection: my_collection_name</span></span>
<span></span>
<span><span class="co"># empty collection if exists</span></span>
<span><span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/nodbi/reference/docdb_delete.html" class="external-link">docdb_delete</a></span><span class="op">(</span><span class="va">db</span>, <span class="va">db</span><span class="op">$</span><span class="va">collection</span><span class="op">)</span></span></code></pre></div>
<p>See <a href="ctrdata_retrieve.Rmd">Retrieve clinical trial
information</a> for more details.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=ctrdata" class="external-link">ctrdata</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># These two queries are similar, for completed interventional (drug)</span></span>
<span><span class="co"># trials with children with a neuroblastoma from either register</span></span>
<span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span><span class="co"># using queryterm and register...</span></span>
<span>queryterm <span class="op">=</span> <span class="st">"query=neuroblastoma&amp;age=under-18&amp;status=completed"</span>,</span>
<span>register <span class="op">=</span> <span class="st">"EUCTR"</span>,</span>
<span>euctrresults <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># [...]</span></span>
<span><span class="co"># $n</span></span>
<span><span class="co"># [1] 226</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span><span class="co"># ...or using full URL of search results</span></span>
<span>queryterm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span><span class="st">"https://classic.clinicaltrials.gov/ct2/results?"</span>, </span>
<span><span class="st">"cond=neuroblastoma&amp;recrs=e&amp;age=0&amp;intr=Drug"</span><span class="op">)</span>,</span>
<span>con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># * Appears specific for CTGOV Classic website</span></span>
<span><span class="co"># Since 2024-06-25, the classic CTGOV servers are no longer available. Package ctrdata has translated </span></span>
<span><span class="co"># the classic CTGOV query URL from this call of function ctrLoadQueryIntoDb(queryterm = ...) into a </span></span>
<span><span class="co"># query URL that works with the current CTGOV2. This is printed below and is also part of the return </span></span>
<span><span class="co"># value of this function, ctrLoadQueryIntoDb(...)$url. This URL can be used with ctrdata functions. </span></span>
<span><span class="co"># Note that the fields and data schema of trials differ between CTGOV and CTGOV2. </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Replace this URL:</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># https://classic.clinicaltrials.gov/ct2/results?cond=neuroblastoma&amp;recrs=e&amp;age=0&amp;intr=Drug</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># with this URL:</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># https://clinicaltrials.gov/search?cond=neuroblastoma&amp;intr=Drug&amp;aggFilters=ages:child,status:com</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># * Found search query from CTGOV2: cond=neuroblastoma&amp;intr=Drug&amp;aggFilters=ages:child,status:com</span></span>
<span><span class="co"># * Checking trials using CTGOV REST API 2.0, found 222 trials</span></span>
<span><span class="co"># (1/3) Downloading in 1 batch(es) (max. 1000 trials each; estimate: 22 Mb total)</span></span>
<span><span class="co"># Download status: 1 done; 0 in progress. Total size: 9.79 Mb (615%)... done!             </span></span>
<span><span class="co"># (2/3) Converting to NDJSON...</span></span>
<span><span class="co"># (3/3) Importing records into database...</span></span>
<span><span class="co"># JSON file #: 1 / 1                               </span></span>
<span><span class="co"># = Imported or updated 222 trial(s)</span></span>
<span><span class="co"># Updated history ("meta-info" in "my_collection_name")</span></span>
<span><span class="co"># $n</span></span>
<span><span class="co"># [1] 222</span></span>
<span></span>
<span><span class="fu"><a href="../reference/dbQueryHistory.html">dbQueryHistory</a></span><span class="op">(</span>con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span><span class="co">#       query-timestamp query-register query-records                                                    query-term</span></span>
<span><span class="co"># 1 2024-06-29 09:01:16          EUCTR           226             query=neuroblastoma&amp;age=under-18&amp;status=completed</span></span>
<span><span class="co"># 2 2024-06-29 09:02:12         CTGOV2           222 cond=neuroblastoma&amp;intr=Drug&amp;aggFilters=ages:child,status:com</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="find-fields-variables-of-interest">Find fields / variables of interest<a class="anchor" aria-label="anchor" href="#find-fields-variables-of-interest"></a>
</h2>
<p>Specify a part of the name of a variable of interest; all variables
including deeply nested variable names are searched. Set
<code>sample = TRUE</code> (default) to rapidly execute the function in
large databases.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="fu"><a href="../reference/dbFindFields.html">dbFindFields</a></span><span class="op">(</span>namepart <span class="op">=</span> <span class="st">"date"</span>, sample <span class="op">=</span> <span class="cn">FALSE</span>, con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span><span class="co"># Finding fields in database collection (may take some time)  .  .  .  .  . </span></span>
<span><span class="co"># Field names cached for this session.</span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#         "annotationSection.annotationModule.unpostedAnnotation.unpostedEvents.date" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#  "derivedSection.miscInfoModule.submissionTracking.estimatedResultsFirstSubmitDate" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#      "derivedSection.miscInfoModule.submissionTracking.firstMcpInfo.postDateStruct" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co"># "derivedSection.miscInfoModule.submissionTracking.firstMcpInfo.postDateStruct.date" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co"># "derivedSection.miscInfoModule.submissionTracking.firstMcpInfo.postDateStruct.type" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#      "derivedSection.miscInfoModule.submissionTracking.submissionInfos.releaseDate" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#        "derivedSection.miscInfoModule.submissionTracking.submissionInfos.resetDate" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                                "documentSection.largeDocumentModule.largeDocs.date" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                          "documentSection.largeDocumentModule.largeDocs.uploadDate" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                                 "protocolSection.statusModule.completionDateStruct" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                            "protocolSection.statusModule.completionDateStruct.date" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                            "protocolSection.statusModule.completionDateStruct.type" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                              "protocolSection.statusModule.dispFirstPostDateStruct" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                         "protocolSection.statusModule.dispFirstPostDateStruct.date" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                         "protocolSection.statusModule.dispFirstPostDateStruct.type" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                                  "protocolSection.statusModule.dispFirstSubmitDate" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                                "protocolSection.statusModule.dispFirstSubmitQcDate" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                             "protocolSection.statusModule.lastUpdatePostDateStruct" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                        "protocolSection.statusModule.lastUpdatePostDateStruct.date" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                        "protocolSection.statusModule.lastUpdatePostDateStruct.type" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                                 "protocolSection.statusModule.lastUpdateSubmitDate" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                          "protocolSection.statusModule.primaryCompletionDateStruct" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                     "protocolSection.statusModule.primaryCompletionDateStruct.date" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                     "protocolSection.statusModule.primaryCompletionDateStruct.type" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                           "protocolSection.statusModule.resultsFirstPostDateStruct" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                      "protocolSection.statusModule.resultsFirstPostDateStruct.date" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                      "protocolSection.statusModule.resultsFirstPostDateStruct.type" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                               "protocolSection.statusModule.resultsFirstSubmitDate" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                             "protocolSection.statusModule.resultsFirstSubmitQcDate" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                                      "protocolSection.statusModule.startDateStruct" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                                 "protocolSection.statusModule.startDateStruct.date" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                                 "protocolSection.statusModule.startDateStruct.type" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                                   "protocolSection.statusModule.statusVerifiedDate" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                             "protocolSection.statusModule.studyFirstPostDateStruct" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                        "protocolSection.statusModule.studyFirstPostDateStruct.date" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                        "protocolSection.statusModule.studyFirstPostDateStruct.type" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                                 "protocolSection.statusModule.studyFirstSubmitDate" </span></span>
<span><span class="co">#                                                                              CTGOV2 </span></span>
<span><span class="co">#                               "protocolSection.statusModule.studyFirstSubmitQcDate" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co">#    "e231_full_title_date_and_version_of_each_substudy_and_their_related_objectives" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co"># "e231_full_title_date_and_version_of_each_substudy_and_their_related_objectives_es" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co"># "e231_full_title_date_and_version_of_each_substudy_and_their_related_objectives_it" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co">#                                            "n_date_of_competent_authority_decision" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co">#                                                "n_date_of_ethics_committee_opinion" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co">#                                             "p_date_of_the_global_end_of_the_trial" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co">#                                "trialChanges.globalAmendments.globalAmendment.date" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co">#                          "trialChanges.globalInterruptions.globalInterruption.date" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co">#                   "trialChanges.globalInterruptions.globalInterruption.restartDate" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co">#                                                "trialInformation.analysisStageDate" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co">#                                             "trialInformation.globalEndOfTrialDate" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co">#                                            "trialInformation.primaryCompletionDate" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co">#                                             "trialInformation.recruitmentStartDate" </span></span>
<span><span class="co">#                                                                               EUCTR </span></span>
<span><span class="co">#            "x6_date_on_which_this_record_was_first_entered_in_the_eudract_database"</span></span></code></pre></div>
<p>The search for fields is cached and thus accelerated during the R
session; calling <code><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb()</a></code> or changing
<code>sample = ...</code> invalidates the cache.</p>
</div>
<div class="section level2">
<h2 id="data-frame-from-database">Data frame from database<a class="anchor" aria-label="anchor" href="#data-frame-from-database"></a>
</h2>
<p>The fields of interest can be obtained from the database and are
represented in an R data.frame, for example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># EUCTR protocol-related information</span></span>
<span>    <span class="st">"f41_in_the_member_state"</span>,</span>
<span>    <span class="st">"f422_in_the_whole_clinical_trial"</span>,</span>
<span>    <span class="st">"a1_member_state_concerned"</span>,</span>
<span>    <span class="st">"p_end_of_trial_status"</span>,</span>
<span>    <span class="st">"n_date_of_competent_authority_decision"</span>,</span>
<span>    <span class="st">"a2_eudract_number"</span>,</span>
<span>    <span class="co"># EUCTR results-related information</span></span>
<span>    <span class="st">"trialInformation.recruitmentStartDate"</span>, </span>
<span>    <span class="st">"trialInformation.globalEndOfTrialDate"</span>,</span>
<span>    <span class="co"># CTGOV2</span></span>
<span>    <span class="st">"protocolSection.statusModule.overallStatus"</span> ,</span>
<span>    <span class="st">"protocolSection.statusModule.startDateStruct.date"</span> ,</span>
<span>    <span class="st">"trialInformation.recruitmentStartDate"</span>,</span>
<span>    <span class="st">"protocolSection.statusModule.primaryCompletionDateStruct.date"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="metadata-from-data-frame">Metadata from data frame<a class="anchor" aria-label="anchor" href="#metadata-from-data-frame"></a>
</h2>
<p>The objects returned by functions of this package include attributes
with metadata to indicate from which database, table / collection and
query details. Metadata can be reused in R.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># [...]</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># $class</span></span>
<span><span class="co"># [1] "data.frame"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`ctrdata-dbname`</span></span>
<span><span class="co"># [1] "my_database_name"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`ctrdata-table`  &lt;-- this attribute will be retired by end 2024</span></span>
<span><span class="co"># [1] "my_collection_name"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`ctrdata-table-note`</span></span>
<span><span class="co"># [1] "^^^ attr ctrdata-table will be removed by end 2024"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`ctrdata-collection`</span></span>
<span><span class="co"># [1] "my_collection_name"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`ctrdata-dbqueryhistory`</span></span>
<span><span class="co">#       query-timestamp query-register query-records                                                    query-term</span></span>
<span><span class="co"># 1 2024-06-29 09:01:16          EUCTR           226             query=neuroblastoma&amp;age=under-18&amp;status=completed</span></span>
<span><span class="co"># 2 2024-06-29 09:02:12         CTGOV2           222 cond=neuroblastoma&amp;intr=Drug&amp;aggFilters=ages:child,status:com</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="de-duplicate-records">De-duplicate records<a class="anchor" aria-label="anchor" href="#de-duplicate-records"></a>
</h2>
<p>In the database, the variable “_id” is the unique index for a record.
This “_id” is the NCT number for CTGOV records (e.g., “NCT00002560”),
and it is the EudraCT number for EUCTR records including the postfix
identifying the EU Member State (e.g., “2008-001436-12-NL”).</p>
<p>It is relevant to de-duplicate records because a trial can be
registered in both CTGOV and EUCTR, and can have records by involved
country in EUCTR.</p>
<p>De-duplication is done at the analysis stage because this enables to
select if a trial record should be taken from one or the other register,
and from one or the other EU Member State.</p>
<p>The basis of de-duplication is the recording of additional trial
identifiers in supplementary fields (variables), which are checked and
reported when using function <code><a href="../reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Obtain de-duplicated trial record ids</span></span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials</a></span><span class="op">(</span></span>
<span>  preferregister <span class="op">=</span> <span class="st">"EUCTR"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Searching for duplicate trials... </span></span>
<span><span class="co"># - Getting all trial identifiers (may take some time), 448 found in collection</span></span>
<span><span class="co"># - Finding duplicates among registers' and sponsor ids...</span></span>
<span><span class="co"># - 173 EUCTR _id were not preferred EU Member State record for 56 trials</span></span>
<span><span class="co"># - Keeping 53 / 0 / 0 / 0 / 205 records from EUCTR / CTGOV / ISRCTN / CTIS / CTGOV2</span></span>
<span><span class="co"># = Returning keys (_id) of 258 records in collection "my_collection_name"</span></span></code></pre></div>
<p>The unique ids can be used like this to de-duplicate the data.frame
created above:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Eliminate duplicate trials records:</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span><span class="va">result</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ids</span>, <span class="op">]</span></span>
<span><span class="co">#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># [1] 258</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reviewing-a-specific-trial">Reviewing a specific trial<a class="anchor" aria-label="anchor" href="#reviewing-a-specific-trial"></a>
</h2>
<p>It will often be useful to inspect all data for a single, for example
to understand the meaning and relation of fields, and to see
neighbouring elements to fields of interest.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="co"># Adding some trials from CTIS for a search similar to above</span></span>
<span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  queryterm <span class="op">=</span> <span class="st">'searchCriteria={"containAll":"","containAny":"neuroblastoma","containNot":""}'</span>,</span>
<span>  register <span class="op">=</span> <span class="st">"CTIS"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># $n</span></span>
<span><span class="co"># [1] 12</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $success</span></span>
<span><span class="co">#  [1] "2023-509673-22-00" "2024-513141-37-00" "2024-511071-16-00" "2024-512095-35-00"</span></span>
<span><span class="co">#  [5] "2023-507178-41-00" "2023-506778-11-00" "2022-501725-21-00" "2023-504880-18-00"</span></span>
<span><span class="co">#  [9] "2023-508587-29-00" "2022-502668-20-00" "2023-504246-64-00" "2023-503684-42-00"</span></span></code></pre></div>
<p>Identify a trial of interest by its <code>_id</code>, and use this in
any standard database function. Retrieve the trial’s full
<code>JSON</code> representation that <code>ctrdata</code> had loaded
into the database and visualise its nested structure of field names and
values.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># </span></span>
<span><span class="co"># This example requires to install this package for visualisation:</span></span>
<span><span class="co"># remotes::install_github("hrbrmstr/jsonview")</span></span>
<span></span>
<span><span class="co"># Get a particular trial from any database supported </span></span>
<span><span class="co"># by ctrdata (duckdb, SQLite, PostgreSQL, MongoDB):</span></span>
<span><span class="va">oneTrial</span> <span class="op">&lt;-</span> <span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/nodbi/reference/docdb_query.html" class="external-link">docdb_query</a></span><span class="op">(</span></span>
<span>  src <span class="op">=</span> <span class="va">db</span>, </span>
<span>  key <span class="op">=</span> <span class="va">db</span><span class="op">$</span><span class="va">collection</span>, </span>
<span>  query <span class="op">=</span> <span class="st">'{"_id":"2022-501725-21-00"}'</span>,</span>
<span>  limit <span class="op">=</span> <span class="fl">1L</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create an interactive widget where nodes can be expanded:</span></span>
<span><span class="fu">jsonview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonview/man/json_tree_view.html" class="external-link">json_tree_view</a></span><span class="op">(</span><span class="va">oneTrial</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="ctisnested.png" alt="CtisNested"><div class="figcaption">CtisNested</div>
</div>
</div>
<div class="section level2">
<h2 id="simple-analysis-of-dates">Simple analysis of dates<a class="anchor" aria-label="anchor" href="#simple-analysis-of-dates"></a>
</h2>
<p>In a data.frame generated with <code><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf()</a></code>,
fields are typed as dates, logical, character or numbers.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># 'data.frame': 258 obs. of  12 variables:</span></span>
<span><span class="co">#  $ _id                                                          : chr  "2004-004386-15-DE" "2005-000915-80-IT" "2005-001267-63-IT" "2005-002089-13-GB" ...</span></span>
<span><span class="co">#  $ f41_in_the_member_state                                      : int  NA NA 5 37 70 24 100 35 10 24 ...</span></span>
<span><span class="co">#  $ f422_in_the_whole_clinical_trial                             : int  230 NA 12 67 70 NA 100 156 2230 NA ...</span></span>
<span><span class="co">#  $ a1_member_state_concerned                                    : chr  "Germany - BfArM" "...</span></span>
<span><span class="co">#  $ p_end_of_trial_status                                        : chr  "Completed" "Completed" "Completed" ...</span></span>
<span><span class="co">#  $ n_date_of_competent_authority_decision                       : Date, format: "2005-07-08" "2005-04-21" ...</span></span>
<span><span class="co">#  $ a2_eudract_number                                            : chr  "2004-004386-15" "2005-000915-80" ...</span></span>
<span><span class="co">#  $ trialInformation.recruitmentStartDate                        : Date, format: "2005-07-26" NA NA ...</span></span>
<span><span class="co">#  $ trialInformation.globalEndOfTrialDate                        : Date, format: "2006-10-27" NA NA ...</span></span>
<span><span class="co">#  $ protocolSection.statusModule.overallStatus                   : chr  NA NA NA NA ...</span></span>
<span><span class="co">#  $ protocolSection.statusModule.startDateStruct.date            : Date, format: NA NA NA ...</span></span>
<span><span class="co">#  $ protocolSection.statusModule.primaryCompletionDateStruct.date: Date, format: NA NA NA ...</span></span>
<span><span class="co">#  - attr(*, "ctrdata-dbname")= chr "my_database_name"</span></span>
<span><span class="co">#  - attr(*, "ctrdata-table")= chr "my_collection_name"</span></span>
<span><span class="co">#  - attr(*, "ctrdata-table-note")= chr "^^^ attr ctrdata-table will be removed by end 2024"</span></span>
<span><span class="co">#  - attr(*, "ctrdata-collection")= chr "my_collection_name"</span></span>
<span><span class="co">#  - attr(*, "ctrdata-dbqueryhistory")='data.frame':    2 obs. of  4 variables:</span></span>
<span><span class="co">#   ..$ query-timestamp: chr [1:2] "2024-06-29 09:01:16" "2024-06-29 09:02:12"</span></span>
<span><span class="co">#   ..$ query-register : chr [1:2] "EUCTR" "CTGOV2"</span></span>
<span><span class="co">#   ..$ query-records  : int [1:2] 226 222</span></span>
<span><span class="co">#   ..$ query-term     : chr [1:2] "query=neuroblastoma&amp;age=under-18&amp;status=completed"</span></span>
<span><span class="co">#    "cond=neuroblastoma&amp;intr=Drug&amp;aggFilters=ages:child,status:com"</span></span></code></pre></div>
<p>This typing facilitates using the respective type of data for
analysis, for example of dates with base R graphics:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Open file for saving</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"vignettes/nb1.png"</span><span class="op">)</span></span>
<span><span class="co"># Visualise trial start date</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"n_date_of_competent_authority_decision"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  breaks <span class="op">=</span> <span class="st">"years"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="nb1.png" alt="Histogram1"><div class="figcaption">Histogram1</div>
</div>
</div>
<div class="section level2">
<h2 id="merge-corresponding-fields-from-registers">Merge corresponding fields from registers<a class="anchor" aria-label="anchor" href="#merge-corresponding-fields-from-registers"></a>
</h2>
<p>The field “n_date_of_competent_authority_decision” used above exists
only in EUCTR, yet it corresponds to the field “start_date” in CTGOV.
Thus, to give the start of the trial, the two fields can be merged for
analysis, using the convenience function
<code><a href="../reference/dfMergeVariablesRelevel.html">dfMergeVariablesRelevel()</a></code> in <code>ctrdata</code>
package:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Merge two variables into a new variable:</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">trialstart</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfMergeVariablesRelevel.html">dfMergeVariablesRelevel</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span>,</span>
<span>  colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># EUCTR</span></span>
<span>    <span class="st">"n_date_of_competent_authority_decision"</span>,</span>
<span>    <span class="co"># CTGOV2</span></span>
<span>    <span class="st">"protocolSection.statusModule.startDateStruct.date"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot from both registers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"vignettes/nb2.png"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"trialstart"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  breaks <span class="op">=</span> <span class="st">"years"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="nb2.png" alt="Histogram2"><div class="figcaption">Histogram2</div>
</div>
<p>In a more sophisticated use of
<code><a href="../reference/dfMergeVariablesRelevel.html">dfMergeVariablesRelevel()</a></code>, values of the original variables
can be mapped into new values of the merged variable, as follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, define how values of the new, merged variable</span></span>
<span><span class="co"># (e.g., "ongoing") will result from values of the</span></span>
<span><span class="co"># original variable (e.g, "Recruiting):</span></span>
<span><span class="va">mapped_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"ongoing"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># EUCTR</span></span>
<span>    <span class="st">"Recruiting"</span>, <span class="st">"Active"</span>, <span class="st">"Ongoing"</span>, </span>
<span>    <span class="st">"Temporarily Halted"</span>, <span class="st">"Restarted"</span>,</span>
<span>    <span class="co"># CTGOV</span></span>
<span>    <span class="st">"Active, not recruiting"</span>, <span class="st">"Enrolling by invitation"</span>, </span>
<span>    <span class="st">"Not yet recruiting"</span>, </span>
<span>    <span class="co"># CTGOV2</span></span>
<span>    <span class="st">"ACTIVE_NOT_RECRUITING"</span>, <span class="st">"ENROLLING_BY_INVITATION"</span>,</span>
<span>    <span class="st">"RECRUITING"</span>, <span class="st">"TEMPORARILY_NOT_AVAILABLE"</span>,</span>
<span>    <span class="co"># CTIS</span></span>
<span>    <span class="st">"Ongoing, recruiting"</span>, <span class="st">"Ongoing, recruitment ended"</span>, </span>
<span>    <span class="st">"Ongoing, not yet recruiting"</span>, <span class="st">"Authorised, not started"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co">#</span></span>
<span>  <span class="st">"completed"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Completed"</span>, <span class="st">"COMPLETED"</span>, <span class="st">"Ended"</span><span class="op">)</span>,</span>
<span>  <span class="co">#</span></span>
<span>  <span class="st">"other"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"GB - no longer in EU/EEA"</span>, <span class="st">"Trial now transitioned"</span>,</span>
<span>    <span class="st">"Withdrawn"</span>, <span class="st">"Suspended"</span>, <span class="st">"No longer available"</span>, </span>
<span>    <span class="st">"SUSPENDED"</span>, <span class="st">"NO_LONGER_AVAILABLE"</span>, <span class="st">"WITHDRAWN"</span>,</span>
<span>    <span class="st">"WITHHELD"</span>, <span class="st">"UNKNOWN"</span>,</span>
<span>    <span class="st">"Terminated"</span>, <span class="st">"TERMINATED"</span>, <span class="st">"Prematurely Ended"</span>, </span>
<span>    <span class="st">"Under evaluation"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Secondly, use the list of mapped</span></span>
<span><span class="co"># values when merging two variable:</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfMergeVariablesRelevel.html">dfMergeVariablesRelevel</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span>,</span>
<span>  colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># EUCTR</span></span>
<span>    <span class="st">"p_end_of_trial_status"</span>,</span>
<span>    <span class="co"># CTGOV2</span></span>
<span>    <span class="st">"protocolSection.statusModule.overallStatus"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  levelslist <span class="op">=</span> <span class="va">mapped_values</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="co"># ongoing completed  other </span></span>
<span><span class="co">#       5       248      4 </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="user-annotations">User annotations<a class="anchor" aria-label="anchor" href="#user-annotations"></a>
</h2>
<p>When using <code><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb()</a></code>, <code>ctrdata</code>
adds to each record the fields <code>annotation</code> and
<code>record_last_import</code>. The annotation field is a single string
that the user specifies when retrieving trials (<a href="ctrdata_retrieve.Rmd">Retrieve clinical trial information</a>).
The user can specify to append, prefix or replace any existing
annotations when a trial record is loaded again, see example below. The
last date and time when the trial record was imported is updated
automatically when using <code><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb()</a></code>. These fields
can also be used for analysis. For example, string functions can be used
for annotations, e.g. to split it into components. Since no annotations
were specified when retrieving the trials in the steps above, there are
so far no annotation fields and <code>stopifnodata</code> is set to
<code>FALSE</code> to avoid the function raises an error to alert
users:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  queryterm <span class="op">=</span> <span class="st">"query=neuroblastoma&amp;resultsstatus=trials-with-results"</span>,</span>
<span>  register <span class="op">=</span> <span class="st">"EUCTR"</span>,</span>
<span>  euctrresults <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  annotation.text <span class="op">=</span> <span class="st">"test annotation"</span>,</span>
<span>  annotation.mode <span class="op">=</span> <span class="st">"append"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"annotation"</span>,</span>
<span>    <span class="st">"record_last_import"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># 'data.frame': 494 obs. of  3 variables:</span></span>
<span><span class="co">#  $ _id               : chr  "2004-004386-15-DE" "2004-004386-15-ES" ...</span></span>
<span><span class="co">#  $ record_last_import: Date, format: "2024-06-29" "2024-06-29" ...</span></span>
<span><span class="co">#  $ annotation        : chr  "test annotation" "test annotation" ...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analysing-sample-sizes-in-historic-versions-of-trial-records">Analysing sample sizes in historic versions of trial records<a class="anchor" aria-label="anchor" href="#analysing-sample-sizes-in-historic-versions-of-trial-records"></a>
</h2>
<p>Historic versions can set to be retrieved for CTGOV2 by specifying
<code>ctgov2history = &lt;...&gt;</code> when using
<code><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb()</a></code>; this functionality was added in
<code>ctrdata</code> version 1.18.0. The versions include all trial data
available at the date of the respective version.</p>
<p>For CTGOV2 records, the historic versions are added as follows into
the <code>ctrdata</code> data model of a trial record, where the
ellipsis <code>...</code> represents all trial data fields:</p>
<p><code>{"_id":"NCT01234567", "title": "Current title", ..., "history": [{"history_version": {"version_number": 1, "version_date": "2020-21-22 10:11:12"}, "title": "Original title", ...}, {"history_version": {"number": 2, "date": "2021-22-23 11:13:13"}, "title": "Later title", ...}]}</code></p>
<p>The example shows how planned or realised number of participants
(sample size) changed over time for individual trials, using available
data (that is, only from <code>CTGOV2</code>; historic versions were
available for <code>CTIS</code> only until its relaunch on
2024-06-17).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="co"># load some trials from CTGOV2 specifying that </span></span>
<span><span class="co"># for each trial, 5 versions should be retrieved</span></span>
<span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  queryterm <span class="op">=</span> <span class="st">"cond=neuroblastoma&amp;aggFilters=phase:3,status:com"</span>, </span>
<span>  register <span class="op">=</span> <span class="st">"CTGOV2"</span>, </span>
<span>  con <span class="op">=</span> <span class="va">db</span>, </span>
<span>  ctgov2history <span class="op">=</span> <span class="fl">5L</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># * Appears specific for CTGOV REST API 2.0</span></span>
<span><span class="co"># * Found search query from CTGOV2: cond=neuroblastoma&amp;aggFilters=phase:3,status:com</span></span>
<span><span class="co"># * Checking trials using CTGOV REST API 2.0, found 24 trials</span></span>
<span><span class="co"># (1/3) Downloading in 1 batch(es) (max. 1000 trials each; estimate: 2.4 Mb total)</span></span>
<span><span class="co"># Download status: 1 done; 0 in progress. Total size: 1.11 Mb (482%)... done!             </span></span>
<span><span class="co"># (2/3) Converting to NDJSON...</span></span>
<span><span class="co"># (3/3) Importing records into database...</span></span>
<span><span class="co"># JSON file #: 1 / 1                               </span></span>
<span><span class="co"># * Checking and processing historic versions... </span></span>
<span><span class="co"># Download status: 24 done; 0 in progress. Total size: 1.35 Mb (515%)... done!             </span></span>
<span><span class="co"># - Downloading 117 historic versions (estimate: 4.4 MB total)...</span></span>
<span><span class="co"># Download status: 117 done; 0 in progress. Total size: 4.14 Mb (532%)... done!             </span></span>
<span><span class="co"># - Merging trial versions . . . . . . . . . . . . . . . . . . . . . . . . </span></span>
<span><span class="co"># - Updating trial records . . . . . . . . . . . . . . . . . . . . . . . . </span></span>
<span><span class="co"># Updated 24 trial(s) with historic versions</span></span>
<span><span class="co"># = Imported or updated 24 trial(s)</span></span>
<span><span class="co"># Updated history ("meta-info" in "my_collection_name")</span></span>
<span></span>
<span><span class="co"># get relevant fields</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># CTGOV2</span></span>
<span>    <span class="st">"history.protocolSection.designModule.enrollmentInfo.count"</span>,</span>
<span>    <span class="st">"history.history_version.version_date"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># helpers</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># mangle and plot</span></span>
<span><span class="va">result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"history."</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">`_id`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">history.history_version.version_date</span>,</span>
<span>      y <span class="op">=</span> <span class="va">history.protocolSection.designModule.enrollmentInfo.count</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">`_id`</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Sample sizes in trials including patients with a neuroblastoma"</span>, </span>
<span>    subtitle <span class="op">=</span> <span class="st">"Source: CTGOV2 records labelled as phase 3 and completed"</span>, </span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/samplesizechanges.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="samplesizechanges.png" alt="Sample size changes"><div class="figcaption">Sample size changes</div>
</div>
</div>
<div class="section level2">
<h2 id="analysing-nested-fields-such-as-trial-results">Analysing nested fields such as trial results<a class="anchor" aria-label="anchor" href="#analysing-nested-fields-such-as-trial-results"></a>
</h2>
<p>The registers represent clinical trial information by nesting fields
(e.g., several reporting groups within several measures within one of
several endpoints). A visualisation of this hierarchical representation
for CTGOV2 follows. Compare this with the outcome measures presented
here: <a href="https://clinicaltrials.gov/study/NCT02139397?tab=results#outcome-measures" class="external-link uri">https://clinicaltrials.gov/study/NCT02139397?tab=results#outcome-measures</a>,
specifically “3. Determine the Progression Free Survival (PFS)…”</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare</span></span>
<span><span class="co"># remotes::install_github("https://github.com/hrbrmstr/jsonview")</span></span>
<span></span>
<span><span class="co"># Find top level nodes within resultsSection</span></span>
<span><span class="fu"><a href="../reference/dbFindFields.html">dbFindFields</a></span><span class="op">(</span><span class="st">"^resultsSection[.][^.]+$"</span>, <span class="va">db</span>, sample <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Using cache of fields. </span></span>
<span><span class="co">#                                         CTGOV2 </span></span>
<span><span class="co">#           "resultsSection.adverseEventsModule" </span></span>
<span><span class="co">#                                         CTGOV2 </span></span>
<span><span class="co"># "resultsSection.baselineCharacteristicsModule" </span></span>
<span><span class="co">#                                         CTGOV2 </span></span>
<span><span class="co">#                "resultsSection.moreInfoModule" </span></span>
<span><span class="co">#                                         CTGOV2 </span></span>
<span><span class="co">#         "resultsSection.outcomeMeasuresModule" </span></span>
<span><span class="co">#                                         CTGOV2 </span></span>
<span><span class="co">#         "resultsSection.participantFlowModule" </span></span>
<span></span>
<span><span class="co"># Get relevant data</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span><span class="st">"resultsSection.outcomeMeasuresModule"</span>, <span class="va">db</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create interactive widget</span></span>
<span><span class="fu">jsonview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonview/man/json_tree_view.html" class="external-link">json_tree_view</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span><span class="va">result</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"NCT02139397"</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="ctgov2nestedresults.png" alt="Ctgov2NestedResults"><div class="figcaption">Ctgov2NestedResults</div>
</div>
<p>The analysis of nested information such as the highlighted duration
of response is facilitated with <code>ctrdata</code> as follows. The
main steps are:</p>
<ol style="list-style-type: decimal">
<li><p>Create a data from fields identified as shown in previous
sections (using <code><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf()</a></code>)</p></li>
<li><p>Transform nested information to a long, name-value data frame
(using <code><a href="../reference/dfTrials2Long.html">dfTrials2Long()</a></code>)</p></li>
<li><p>Identify the measures of interest (e.g. PFS, blue circle above)
by specifying the name and value of these fields
(<code>wherename</code>, <code>wherevalue</code> in function
<code><a href="../reference/dfName2Value.html">dfName2Value()</a></code>) and</p></li>
<li><p>Obtain values by specifying the name(s) of its value field(s)
(red and green circles in figure above; <code>valuename</code> in
function <code><a href="../reference/dfName2Value.html">dfName2Value()</a></code>).</p></li>
</ol>
<p>This is put together in the following example. Note that
<code>CTGOV</code> fields are no longer downloadable (see NEWS.md) but
may exist in previously created databases.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="co">#### 1. Create data frame from results fields</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># These are key results fields from</span></span>
<span><span class="co"># CTGOV2, CTGOV and from EUCTR:</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># EUCTR</span></span>
<span>    <span class="st">"trialInformation.populationAgeGroup"</span>,</span>
<span>    <span class="st">"subjectDisposition.recruitmentDetails"</span>,</span>
<span>    <span class="st">"baselineCharacteristics.baselineReportingGroups.baselineReportingGroup"</span>,</span>
<span>    <span class="st">"endPoints.endPoint"</span>,</span>
<span>    <span class="st">"subjectAnalysisSets"</span>,</span>
<span>    <span class="st">"adverseEvents.seriousAdverseEvents.seriousAdverseEvent"</span>, </span>
<span>    <span class="co"># CTGOV2</span></span>
<span>    <span class="st">"resultsSection.outcomeMeasuresModule"</span>,</span>
<span>    <span class="st">"protocolSection.designModule.designInfo.allocation"</span>, </span>
<span>    <span class="st">"resultsSection.participantFlowModule"</span>,</span>
<span>    <span class="co"># CTGOV</span></span>
<span>    <span class="st">"clinical_results.baseline.analyzed_list.analyzed.count_list.count"</span>,</span>
<span>    <span class="st">"clinical_results.baseline.group_list.group"</span>,</span>
<span>    <span class="st">"clinical_results.baseline.analyzed_list.analyzed.units"</span>,</span>
<span>    <span class="st">"clinical_results.outcome_list.outcome"</span>,</span>
<span>    <span class="st">"study_design_info.allocation"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Keep only unique trial records</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span><span class="va">result</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="../reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials</a></span><span class="op">(</span>con <span class="op">=</span> <span class="va">db</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co">#### 2. All nested data are transformed to a long,</span></span>
<span><span class="co"># name-value data.frame (resulting in several</span></span>
<span><span class="co"># hundred rows per trial record):</span></span>
<span><span class="co"># </span></span>
<span><span class="va">long_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfTrials2Long.html">dfTrials2Long</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># Total 166677 rows, 157 unique names of variables</span></span>
<span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span><span class="st">"endPoints"</span>, <span class="va">db</span><span class="op">)</span></span>
<span><span class="fu">jsonview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonview/man/json_tree_view.html" class="external-link">json_tree_view</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span><span class="va">result</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"2010-019348-37-IT"</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#### 3. Obtain values for measures of interest </span></span>
<span><span class="co">#</span></span>
<span><span class="co"># The parameters can be regular expressions.</span></span>
<span><span class="va">clinicalDuration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfName2Value.html">dfName2Value</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">long_result</span>,</span>
<span>  wherename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"endPoints.endPoint.title|"</span>,</span>
<span>    <span class="st">"resultsSection.outcomeMeasuresModule.outcomeMeasures.title"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  wherevalue <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"duration of response|DOR|"</span>,</span>
<span>    <span class="st">"free survival|DFS|PFS|EFS"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  valuename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"resultsSection.*outcomeMeasures.classes.categories.measurements.value|"</span>,</span>
<span>    <span class="st">"endPoints.*armReportingGroup.tendencyValues.tendencyValue.value|"</span>,</span>
<span>    <span class="st">"resultsSection.outcomeMeasuresModule.outcomeMeasures.unitOfMeasure|"</span>,</span>
<span>    <span class="st">"endPoints.endPoint.unit|"</span>,</span>
<span>    <span class="st">"resultsSection.outcomeMeasuresModule.outcomeMeasures.groups.title|"</span>,</span>
<span>    <span class="st">"endPoints.*armReportingGroup.armId"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Returning values for 45 out of 131 trials</span></span>
<span></span>
<span><span class="co"># Duration has been reported with various units: </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">clinicalDuration</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"unit"</span>, <span class="va">clinicalDuration</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>, <span class="st">"value"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For convenience, `dplyr` and related functions can be used, as follows: </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">clinicalDuration</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    group_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">`_id`</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"([0-9]+)[.]?.*"</span>, <span class="st">"\\1"</span>, <span class="va">identifier</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    name_short <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">".*[.](.+)"</span>, <span class="st">"\\1"</span>, <span class="va">name</span><span class="op">)</span>,</span>
<span>    name_short <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">name_short</span> <span class="op">==</span> <span class="st">"unitOfMeasure"</span>, <span class="st">"unit"</span>, <span class="va">name_short</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">group_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    is_duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"day|month|week|year"</span>, <span class="va">value</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">is_duration</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name_short</span>, <span class="va">value</span>, <span class="va">where</span>, <span class="va">group_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">group_id</span>, <span class="va">where</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="va">name_short</span>, values_fn <span class="op">=</span> <span class="va">list</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">unit</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"999[9]*"</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>    arm_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">armId</span>, <span class="va">title</span>, collapse <span class="op">=</span> <span class="st">" / "</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    days <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"[wW]eek"</span>, <span class="va">unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">value</span> <span class="op">*</span> <span class="fl">7</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"[mM]onth"</span>, <span class="va">unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">value</span> <span class="op">*</span> <span class="fl">30</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"[yY]ear"</span>, <span class="va">unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">value</span> <span class="op">*</span> <span class="fl">30</span>,</span>
<span>      .default <span class="op">=</span> <span class="va">value</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">unit</span>, <span class="va">armId</span>, <span class="va">title</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">clinicalDuration</span></span>
<span><span class="co"># # A tibble: 163 x 4</span></span>
<span><span class="co">#    group_id            where                                                arm_names  days</span></span>
<span><span class="co">#    &lt;chr&gt;               &lt;chr&gt;                                                &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#  1 2010-019348-37-IT_8 Duration of response by treatment                    "Arm-235   211.</span></span>
<span><span class="co">#  2 2010-019348-37-IT_8 Duration of response by treatment                    "Arm-235   242.</span></span>
<span><span class="co">#  3 2010-019348-37-IT_8 Duration of response by treatment                    "Arm-235   146.</span></span>
<span><span class="co">#  4 2010-022951-49-LV_2 Progression-free Survival                            "Arm-648   108 </span></span>
<span><span class="co">#  5 2010-022951-49-LV_2 Progression-free Survival                            "Arm-648    51 </span></span>
<span><span class="co">#  6 2010-022951-49-LV_4 Progression Free Survival (PFS) in Participants wit  "Arm-648   156 </span></span>
<span><span class="co">#  7 2010-022951-49-LV_4 Progression Free Survival (PFS) in Participants wit  "Arm-648    51 </span></span>
<span><span class="co">#  8 2011-004168-30-DE_2 Progression-free survival PP population              "Arm-937   159 </span></span>
<span><span class="co">#  9 2011-004168-30-DE_2 Progression-free survival PP population              "Arm-937   132 </span></span>
<span><span class="co"># 10 2012-000510-10-GB_2 Progression Free Survival                            "Arm-782    NA </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analysing-primary-endpoints">Analysing primary endpoints<a class="anchor" aria-label="anchor" href="#analysing-primary-endpoints"></a>
</h2>
<p>Text analysis has to be used for many fields of trial information
from the registers. Here is an example to simply categorise the type of
primary endpoint. In addition, the number of subjects are extracted and
compared by type of primary endpoint.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># CTGOV</span></span>
<span>    <span class="st">"resultsSection.outcomeMeasuresModule.outcomeMeasures.title"</span>,</span>
<span>    <span class="st">"protocolSection.designModule.enrollmentInfo.count"</span>,</span>
<span>    <span class="co"># EUCTR</span></span>
<span>    <span class="st">"e51_primary_end_points"</span>,</span>
<span>    <span class="st">"f11_number_of_subjects_for_this_age_range"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># De-duplicate</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span>
<span>    <span class="fu"><a href="../reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials</a></span><span class="op">(</span>con <span class="op">=</span> <span class="va">db</span><span class="op">)</span>,</span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Merge primary endpoint (pep)</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">pep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfMergeVariablesRelevel.html">dfMergeVariablesRelevel</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">result</span>,</span>
<span>  colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"resultsSection.outcomeMeasuresModule.outcomeMeasures.title"</span>,</span>
<span>    <span class="st">"e51_primary_end_points"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge number of subjects</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">nsubj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfMergeVariablesRelevel.html">dfMergeVariablesRelevel</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">result</span>,</span>
<span>  colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"protocolSection.designModule.enrollmentInfo.count"</span>,</span>
<span>    <span class="st">"f11_number_of_subjects_for_this_age_range"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For primary endpoint of interest,</span></span>
<span><span class="co"># use regular expression on text:</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">pep_is_efs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span></span>
<span>  pattern <span class="op">=</span> <span class="st">"((progression|event|relapse|recurrence|disease)[- ]free)|pfs|dfs|efs)"</span>,</span>
<span>  x <span class="op">=</span> <span class="va">result</span><span class="op">$</span><span class="va">pep</span>,</span>
<span>  ignore.case <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tabulate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">pep_is_efs</span><span class="op">)</span></span>
<span><span class="co"># FALSE  TRUE</span></span>
<span><span class="co">#   211    33</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">result</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">nsubj</span>,</span>
<span>    y <span class="op">=</span> <span class="va">pep_is_efs</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Warning message:</span></span>
<span><span class="co"># Removed 24 rows containing non-finite values (`stat_boxplot()`). </span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/boxpep.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="boxpep.png" alt="BoxPEP"><div class="figcaption">BoxPEP</div>
</div>
</div>
<div class="section level2">
<h2 id="analysis-methods-and-p-values">Analysis methods and p values<a class="anchor" aria-label="anchor" href="#analysis-methods-and-p-values"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># helper </span></span>
<span><span class="va">normalise_string</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">","</span>, <span class="st">""</span>,  <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">" "</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/toTitleCase.html" class="external-link">toTitleCase</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[ ]+"</span>, <span class="st">" "</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># get trials into database</span></span>
<span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  queryterm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"https://clinicaltrials.gov/search?start=2010-01-01_2012-12-31"</span>, <span class="st">"</span></span>
<span><span class="st">    &amp;intr=Drug&amp;aggFilters=ages:child,phase:2 3,results:with"</span><span class="op">)</span>, </span>
<span>  con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># see definitions linked in help("ctrdate-registers") or directly go to</span></span>
<span><span class="co"># https://clinicaltrials.gov/data-api/about-api/study-data-structure</span></span>
<span></span>
<span><span class="co"># get result set</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"protocolSection.armsInterventionsModule.armGroups.type"</span>,</span>
<span>  <span class="st">"protocolSection.designModule.designInfo.allocation"</span>,</span>
<span>  <span class="st">"protocolSection.designModule.designInfo.interventionModel"</span>,</span>
<span>  <span class="st">"protocolSection.designModule.designInfo.maskingInfo.masking"</span>,</span>
<span>  <span class="st">"protocolSection.designModule.enrollmentInfo.count"</span>,</span>
<span>  <span class="st">"protocolSection.statusModule.startDateStruct.date"</span>,</span>
<span>  <span class="st">"protocolSection.outcomesModule.primaryOutcomes.measure"</span>,</span>
<span>  <span class="st">"resultsSection.outcomeMeasuresModule.outcomeMeasures.analyses.statisticalMethod"</span>,</span>
<span>  <span class="st">"resultsSection.outcomeMeasuresModule.outcomeMeasures.analyses.pValue"</span></span>
<span><span class="op">)</span>, </span>
<span>con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># # number of participants (last number is typically all groups summed up)</span></span>
<span><span class="co"># # also see README.Rmd for alternative way, summing up non-total groups</span></span>
<span><span class="co"># # result$totalparticipants &lt;- vapply(</span></span>
<span><span class="co"># # result[["clinical_results.baseline.analyzed_list.analyzed.count_list.count.value"]],</span></span>
<span><span class="co"># # FUN = function(x) rev(x)[1], numeric(1L))</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># View(result)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># result$totalparticipants &lt;- result$protocolSection.designModule.enrollmentInfo.count</span></span>
<span></span>
<span><span class="co"># first reported p value for primary endpoint analysis</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">pvalueprimaryanalysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"resultsSection.outcomeMeasuresModule.outcomeMeasures.analyses.pValue"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[&lt;&gt;=]"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">" / "</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># statistical method used for primary endpoint analysis</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">methodprimaryanalysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"resultsSection.outcomeMeasuresModule.outcomeMeasures.analyses.statisticalMethod"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">normalise_string</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">" / "</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># keep randomised, parallel-group, placebo-controlled, blinded clinical trials</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">prct</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"PLACEBO|NO_INT"</span>, <span class="va">result</span><span class="op">$</span><span class="va">protocolSection.armsInterventionsModule.armGroups.type</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^RANDOM"</span>, <span class="va">result</span><span class="op">$</span><span class="va">protocolSection.designModule.designInfo.allocation</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^PARALLEL"</span>, <span class="va">result</span><span class="op">$</span><span class="va">protocolSection.designModule.designInfo.interventionModel</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"NONE"</span>, <span class="va">result</span><span class="op">$</span><span class="va">protocolSection.designModule.designInfo.maskingInfo.masking</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">prct</span><span class="op">)</span></span>
<span><span class="co"># FALSE  TRUE </span></span>
<span><span class="co">#   923   281</span></span>
<span><span class="co">#</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">result</span>, <span class="va">prct</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># helper</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># http://varianceexplained.org/statistics/interpreting-pvalue-histogram/</span></span>
<span><span class="co"># http://www.pnas.org/content/100/16/9440.full</span></span>
<span><span class="co"># plot p values</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span>, </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">pvalueprimaryanalysis</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ecdf.html" class="external-link">stat_ecdf</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"step"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"Paediatric phase 2 or 3 parallel-group interventional trials\n"</span>, </span>
<span>      <span class="st">"with randomisation to placebo or to no intervention"</span><span class="op">)</span>, </span>
<span>    x <span class="op">=</span> <span class="st">"Range of p values"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Empirical cumulative density of p values\nof primary endpoint results"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>    linetype <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/phase23_paed_p_values.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot sample size v p value</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span>, </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">protocolSection.designModule.enrollmentInfo.count</span>, </span>
<span>    y <span class="op">=</span> <span class="va">pvalueprimaryanalysis</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.05</span>, linetype <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/phase23_paed_p_values_participants.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># statistical method used for primary endpoint analysis</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">methodprimaryanalysis</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Var1</th>
<th align="right">Freq</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Ancova</td>
<td align="right">49</td>
</tr>
<tr class="even">
<td align="left">Cochran Mantel Haenszel</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">Mixed Models Analysis</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">Anova</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Chi Squared</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">Fisher Exact</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">t Test 2 Sided</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Wilcoxon (Mann Whitney)</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">Mixed Model Repeated Measures (Mmrm)</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Mixed Model for Repeated Measures (Mmrm)</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<div class="float">
<img src="phase23_paed_p_values.png" alt="phase23_paed_p_values"><div class="figcaption">phase23_paed_p_values</div>
</div>
<div class="float">
<img src="phase23_paed_p_values_participants.png" alt="phase23_paed_p_values"><div class="figcaption">phase23_paed_p_values</div>
</div>
</div>
<div class="section level2">
<h2 id="investigational-or-authorised-medicinal-product">Investigational or authorised medicinal product?<a class="anchor" aria-label="anchor" href="#investigational-or-authorised-medicinal-product"></a>
</h2>
<p>The information about the status of authorisation (licensing) of a
medicine used in a trial is recorded in EUCTR in the field
<code>dimp.d21_imp_to_be_used_in_the_trial_has_a_marketing_authorisation</code>.
A corresponding field in CTGOV is not known. The status is in the tree
starting from the <code>dimp</code> element.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get results</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"a1_member_state_concerned"</span>,</span>
<span>    <span class="st">"n_date_of_competent_authority_decision"</span>,</span>
<span>    <span class="st">"dimp.d21_imp_to_be_used_in_the_trial_has_a_marketing_authorisation"</span>,</span>
<span>    <span class="st">"x6_date_on_which_this_record_was_first_entered_in_the_eudract_database"</span>,</span>
<span>    <span class="st">"f422_in_the_whole_clinical_trial"</span>,</span>
<span>    <span class="st">"a2_eudract_number"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find first date of authorisation in EU member state</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"n_date_of_competent_authority_decision"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">result</span><span class="op">[[</span><span class="st">"a2_eudract_number"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">result</span>,</span>
<span>  y <span class="op">=</span> <span class="va">tmp</span>,</span>
<span>  by.x <span class="op">=</span> <span class="st">"a2_eudract_number"</span>,</span>
<span>  by.y <span class="op">=</span> <span class="st">"Group.1"</span>,</span>
<span>  all.x <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>startdatefirst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>, <span class="va">x6_date_on_which_this_record_was_first_entered_in_the_eudract_database</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now de-duplicate</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span>
<span>    <span class="fu"><a href="../reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials</a></span><span class="op">(</span></span>
<span>      include3rdcountrytrials <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      con <span class="op">=</span> <span class="va">db</span><span class="op">)</span>,</span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="co"># How many of the investigational medicinal product(s)</span></span>
<span><span class="co"># used in the trial are authorised?</span></span>
<span><span class="va">number_authorised</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"dimp.d21_imp_to_be_used_in_the_trial_has_a_marketing_authorisation"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">i</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">number_authorised</span>, exclude <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co"># number_authorised</span></span>
<span><span class="co">#  0  1  2  3  4  6  7  8  9 15 </span></span>
<span><span class="co"># 26 18  7  5  3  2  1  1  1  1  </span></span>
<span></span>
<span><span class="va">result</span><span class="op">[[</span><span class="st">"any_authorised"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">number_authorised</span> <span class="op">&gt;</span> <span class="fl">0L</span></span>
<span></span>
<span><span class="co"># Helper</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">result</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">startdatefirst</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">any_authorised</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/breaks_width.html" class="external-link">breaks_width</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"2 years"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/date_format.html" class="external-link">date_format</a></span><span class="op">(</span><span class="st">"%Y"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">365.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Neuroblastoma trials in EU"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year of trial authorisation (or entered in EUCTR)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of trials"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Medicine\nauthorised?"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/nbtrials.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="nbtrials.png" alt="HistogramNBtrials"><div class="figcaption">HistogramNBtrials</div>
</div>
</div>
<div class="section level2">
<h2 id="analyses-using-aggregation-pipeline-and-mapreduce">Analyses using aggregation pipeline and mapreduce<a class="anchor" aria-label="anchor" href="#analyses-using-aggregation-pipeline-and-mapreduce"></a>
</h2>
<p>Here is an example of analysis functions that can be run directly on
a MongoDB server, which are fast and do not consume R resources.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load library for database access</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/mongolite" class="external-link">mongolite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create R object m to access the</span></span>
<span><span class="co"># collection db created above:</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mongolite/man/mongo.html" class="external-link">mongo</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">db</span><span class="op">[[</span><span class="st">"url"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"/"</span>, <span class="va">db</span><span class="op">[[</span><span class="st">"db"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  collection <span class="op">=</span> <span class="va">db</span><span class="op">[[</span><span class="st">"collection"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Number of records in  collection:</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># [1] 2627</span></span>
<span></span>
<span><span class="co"># Number of EUCTR records, using JSON for query:</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span>query <span class="op">=</span> <span class="st">'{"_id": {"$regex": "[0-9]{4}-[0-9]{6}-[0-9]{2}", "$options": "i"}}'</span><span class="op">)</span></span>
<span><span class="co"># [1] 1422</span></span>
<span></span>
<span><span class="co"># Alternative:</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span>query <span class="op">=</span> <span class="st">'{"ctrname": "EUCTR"}'</span><span class="op">)</span></span>
<span><span class="co"># [1] 272</span></span>
<span></span>
<span><span class="co"># Number of CTGOV records:</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span>query <span class="op">=</span> <span class="st">'{"_id": {"$regex": "NCT[0-9]{8}", "$options": "i"}}'</span><span class="op">)</span></span>
<span><span class="co"># [1] 1204</span></span>
<span></span>
<span><span class="co"># Alternative:</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span>query <span class="op">=</span> <span class="st">'{"ctrname": "CTGOV2"}'</span><span class="op">)</span></span>
<span><span class="co"># [1] 1204</span></span>
<span></span>
<span><span class="co"># To best define regular expressions for analyses, inspect the field:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span></span>
<span>  <span class="va">m</span><span class="op">$</span><span class="fu">distinct</span><span class="op">(</span></span>
<span>    <span class="co"># key = "resultsSection.outcomeMeasuresModule.outcomeMeasures.title",</span></span>
<span>    key <span class="op">=</span> <span class="st">"protocolSection.outcomesModule.primaryOutcomes.measure"</span>,</span>
<span>    query <span class="op">=</span> <span class="st">'{"ctrname": "CTGOV2"}'</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># [1] "% Calories Taken Orally"</span></span>
<span><span class="co"># [2] "- To demonstrate that 123I-mIBG planar scintigraphy is sensitive ..."</span></span>
<span><span class="co"># [3] "1-year Progression-free Survival"</span></span>
<span><span class="co"># [4] "10-year Hematologic Cancer Rate"</span></span>
<span><span class="co"># [5] "10-year Mortality Rate in Marrow Donors"</span></span>
<span><span class="co"># [6] "10-year Overall Cancer Incidence"</span></span></code></pre></div>
<div class="section level3">
<h3 id="aggregation">Aggregation<a class="anchor" aria-label="anchor" href="#aggregation"></a>
</h3>
<p>The following example uses the aggregation pipeline in MongoDB. See
here for details on mongo’s aggregation pipleline: <a href="https://docs.mongodb.org/manual/core/aggregation-pipeline/" class="external-link uri">https://docs.mongodb.org/manual/core/aggregation-pipeline/</a></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="co"># Total count of PFS, EFS, RFS or DFS</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span></span>
<span>  <span class="co"># Count number of documents in collection that</span></span>
<span>  <span class="co"># matches in primary_outcome.measure the</span></span>
<span>  <span class="co"># regular expression,</span></span>
<span>  pipeline <span class="op">=</span></span>
<span>    <span class="st">'[{"$match": {"protocolSection.outcomesModule.primaryOutcomes.measure":</span></span>
<span><span class="st">      {"$regex": "(progression|event|relapse|recurrence|disease)[- ]free",</span></span>
<span><span class="st">                 "$options": "i"}}},</span></span>
<span><span class="st">      {"$group": {"_id": "null", "count": {"$sum": 1}}}]'</span></span>
<span><span class="op">)</span></span>
<span><span class="va">out</span></span>
<span><span class="co">#    _id count</span></span>
<span><span class="co"># 1 null    56</span></span>
<span></span>
<span><span class="co"># List records of trials with overall survival</span></span>
<span><span class="co"># as primary endpoint, and list start date</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span></span>
<span>  pipeline <span class="op">=</span></span>
<span>    <span class="st">'[{"$match": {"protocolSection.outcomesModule.primaryOutcomes.measure":</span></span>
<span><span class="st">      {"$regex": "overall survival", "$options": "i"}}},</span></span>
<span><span class="st">      {"$project": {"_id": 1, "protocolSection.statusModule.startDateStruct.date": 1}}]'</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#           _id       date</span></span>
<span><span class="co"># 1 NCT00445965    2006-01</span></span>
<span><span class="co"># 2 NCT00923351 2007-06-02</span></span>
<span><span class="co"># 3 NCT00793845    2008-08</span></span>
<span><span class="co"># 4 NCT00499616 2007-10-08</span></span>
<span><span class="co"># 5 NCT01190930 2010-08-09</span></span>
<span><span class="co"># 6 NCT01514201 2012-02-01</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mapreduce">Mapreduce<a class="anchor" aria-label="anchor" href="#mapreduce"></a>
</h3>
<p>Since Mapreduce is deprecated starting in MongoDB 5 (<a href="https://docs.mongodb.com/manual/core/map-reduce/" class="external-link uri">https://docs.mongodb.com/manual/core/map-reduce/</a>), use
an aggregation pipeline:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Count number of trials by number of study</span></span>
<span><span class="co"># participants in bins of hundreds of participants:</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span>pipeline <span class="op">=</span> <span class="st">'</span></span>
<span><span class="st">[</span></span>
<span><span class="st">  {</span></span>
<span><span class="st">    "$project": {</span></span>
<span><span class="st">      "flooredNumber": {</span></span>
<span><span class="st">        "$multiply": [</span></span>
<span><span class="st">          {</span></span>
<span><span class="st">            "$floor": {</span></span>
<span><span class="st">              "$divide": [</span></span>
<span><span class="st">                {</span></span>
<span><span class="st">                  "$toInt": "$protocolSection.designModule.enrollmentInfo.count"</span></span>
<span><span class="st">                },</span></span>
<span><span class="st">                100</span></span>
<span><span class="st">              ]</span></span>
<span><span class="st">            }</span></span>
<span><span class="st">          },</span></span>
<span><span class="st">          100</span></span>
<span><span class="st">        ]</span></span>
<span><span class="st">      }</span></span>
<span><span class="st">    }</span></span>
<span><span class="st">  },</span></span>
<span><span class="st">  {</span></span>
<span><span class="st">    "$group": {</span></span>
<span><span class="st">      "_id": "$flooredNumber",</span></span>
<span><span class="st">      "count": {</span></span>
<span><span class="st">        "$count": {}</span></span>
<span><span class="st">      }</span></span>
<span><span class="st">    }</span></span>
<span><span class="st">  },</span></span>
<span><span class="st">  {</span></span>
<span><span class="st">    "$sort": {</span></span>
<span><span class="st">      "_id": 1</span></span>
<span><span class="st">    }</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">]</span></span>
<span><span class="st">'</span><span class="op">)</span></span>
<span><span class="co">#      _id count</span></span>
<span><span class="co"># 1     NA  1450</span></span>
<span><span class="co"># 2      0   700</span></span>
<span><span class="co"># 3    100   165</span></span>
<span><span class="co"># 4    200    78</span></span>
<span><span class="co"># 5    300    59</span></span>
<span><span class="co"># 6    400    30</span></span>
<span><span class="co"># 7    500    32</span></span>
<span><span class="co"># 8    600    19</span></span>
<span><span class="co"># 9    700    21</span></span>
<span><span class="co"># 10   800    13</span></span>
<span><span class="co"># 11   900    10</span></span>
<span><span class="co"># 12  1000     5</span></span>
<span><span class="co"># [...]</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ralf Herold.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>

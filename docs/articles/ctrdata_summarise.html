<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Summarise and analyse clinical trial information • ctrdata</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Summarise and analyse clinical trial information">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ctrdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.22.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ctrdata_install.html">Install R package ctrdata</a></li>
    <li><a class="dropdown-item" href="../articles/ctrdata_retrieve.html">Retrieve clinical trial information</a></li>
    <li><a class="dropdown-item" href="../articles/ctrdata_summarise.html">Summarise and analyse clinical trial information</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rfhb/ctrdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Summarise and analyse clinical trial information</h1>
                        <h4 data-toc-skip class="author">Ralf
Herold</h4>
            
            <h4 data-toc-skip class="date">2025-05-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rfhb/ctrdata/blob/HEAD/vignettes/ctrdata_summarise.Rmd" class="external-link"><code>vignettes/ctrdata_summarise.Rmd</code></a></small>
      <div class="d-none name"><code>ctrdata_summarise.Rmd</code></div>
    </div>

    
    
<p>General information on the <code>ctrdata</code> package is available
here: <a href="https://github.com/rfhb/ctrdata" class="external-link">https://github.com/rfhb/ctrdata</a>.</p>
<p>Remember to respect the registers’ terms and conditions (see
<code>ctrOpenSearchPagesInBrowser(copyright = TRUE)</code>). Please cite
this package in any publication as follows: Ralf Herold (2025). ctrdata:
Retrieve and Analyze Clinical Trials in Public Registers. R package
version 1.22.1. <a href="https://cran.r-project.org/package=ctrdata" class="external-link uri">https://cran.r-project.org/package=ctrdata</a></p>
<div class="section level2">
<h2 id="preparations">Preparations<a class="anchor" aria-label="anchor" href="#preparations"></a>
</h2>
<p>Here using MongoDB, which may be faster than SQLite, can handle
credentials, provides access to remote servers and can directly retrieve
nested elements from paths. See <a href="../README.html">README.md</a> and
<a href="ctrdata_retrieve.Rmd">Retrieve clinical trial information</a>
for examples using SQLite. Also PostgreSQL can be used as database, see
<a href="ctrdata_install.Rmd">Install R package ctrdata</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/nodbi/reference/src_mongo.html" class="external-link">src_mongo</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="st">"mongodb://localhost"</span>,</span>
<span>  db <span class="op">=</span> <span class="st">"my_database_name"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"my_collection_name"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">db</span></span>
<span><span class="co"># MongoDB  8.0.4 (uptime: 298113s) </span></span>
<span><span class="co"># URL: mongodb://localhost</span></span>
<span><span class="co"># Database: my_database_name</span></span>
<span><span class="co"># Collection: my_collection_name</span></span>
<span></span>
<span><span class="co"># empty collection if exists</span></span>
<span><span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/nodbi/reference/docdb_delete.html" class="external-link">docdb_delete</a></span><span class="op">(</span><span class="va">db</span>, <span class="va">db</span><span class="op">$</span><span class="va">collection</span><span class="op">)</span></span></code></pre></div>
<p>See <a href="ctrdata_retrieve.Rmd">Retrieve clinical trial
information</a> for more details.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=ctrdata" class="external-link">ctrdata</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model queries</span></span>
<span><span class="va">queries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctrGenerateQueries.html">ctrGenerateQueries</a></span><span class="op">(</span></span>
<span>  condition <span class="op">=</span> <span class="st">"neuroblastoma"</span>,</span>
<span>  population <span class="op">=</span> <span class="st">"P"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load trials from all queries into collection</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">queries</span>, <span class="va">ctrLoadQueryIntoDb</span>, euctrresults <span class="op">=</span> <span class="cn">TRUE</span>, con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show results of loading</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"[["</span>, <span class="st">"n"</span><span class="op">)</span></span>
<span><span class="co"># EUCTR       ISRCTN       CTGOV2 CTGOV2expert         CTIS </span></span>
<span><span class="co">#   390            1          530          530           21 </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="find-fields-variables-of-interest">Find fields / variables of interest<a class="anchor" aria-label="anchor" href="#find-fields-variables-of-interest"></a>
</h2>
<p>Specify a part of the name of a variable of interest; all variables
including deeply nested variable names are searched. Set
<code>sample = TRUE</code> (default) to rapidly execute the function in
large database collections. The search for fields is cached and thus
accelerated during the R session; calling
<code><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb()</a></code> or changing <code>sample = ...</code>
invalidates the cache.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="fu"><a href="../reference/dbFindFields.html">dbFindFields</a></span><span class="op">(</span>namepart <span class="op">=</span> <span class="st">"date"</span>, sample <span class="op">=</span> <span class="cn">FALSE</span>, con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span><span class="co"># Finding fields in database collection (may take some time) . . . . . </span></span>
<span><span class="co"># Field names cached for this session.</span></span>
<span><span class="co"># [...]</span></span>
<span><span class="co">#                                                                            EUCTR </span></span>
<span><span class="co"># "e231_full_title_date_and_version_of_each_substudy_and_their_related_objectives" </span></span>
<span><span class="co"># [...]</span></span>
<span><span class="co">#                                                                           CTGOV2 </span></span>
<span><span class="co">#      "annotationSection.annotationModule.unpostedAnnotation.unpostedEvents.date" </span></span>
<span><span class="co">#                                                                           CTGOV2 </span></span>
<span><span class="co">#                            "protocolSection.statusModule.studyFirstSubmitQcDate" </span></span>
<span><span class="co"># [...]</span></span>
<span><span class="co">#                                                                             CTIS </span></span>
<span><span class="co">#                                                                    "publishDate" </span></span>
<span><span class="co">#                                                                             CTIS </span></span>
<span><span class="co">#                                                                    "startDateEU" </span></span>
<span><span class="co"># [...]</span></span>
<span><span class="co">#                                                                           ISRCTN </span></span>
<span><span class="co">#                                                     "trialDesign.overallEndDate" </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-frame-from-database">Data frame from database<a class="anchor" aria-label="anchor" href="#data-frame-from-database"></a>
</h2>
<p>The fields of interest can be obtained from the database and are
represented in an R data frame, for example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define vector of fields</span></span>
<span><span class="va">fieldsOfInterest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># EUCTR protocol-related information</span></span>
<span>  <span class="st">"f41_in_the_member_state"</span>,</span>
<span>  <span class="st">"f422_in_the_whole_clinical_trial"</span>,</span>
<span>  <span class="st">"a1_member_state_concerned"</span>,</span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># EUCTR results-related information</span></span>
<span>  <span class="st">"trialInformation.recruitmentStartDate"</span>, </span>
<span>  <span class="st">"trialInformation.globalEndOfTrialDate"</span>,</span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># CTGOV2</span></span>
<span>  <span class="st">"protocolSection.statusModule.startDateStruct.date"</span>,</span>
<span>  <span class="st">"trialInformation.recruitmentStartDate"</span>,</span>
<span>  <span class="st">"protocolSection.statusModule.primaryCompletionDateStruct.date"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create data frame with records of trials </span></span>
<span><span class="co"># which for at least one field have a value</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="va">fieldsOfInterest</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Querying database (7 fields)...</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># [1] 913   8</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="metadata-from-data-frame">Metadata from data frame<a class="anchor" aria-label="anchor" href="#metadata-from-data-frame"></a>
</h2>
<p>The objects returned by functions of this package include attributes
with metadata to indicate from which database, table / collection and
query details. Metadata can be reused in R.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># [...]</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># $class</span></span>
<span><span class="co"># [1] "data.frame"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`ctrdata-dbname`</span></span>
<span><span class="co"># [1] "my_database_name"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`ctrdata-table`  &lt;-- this attribute will be retired by end 2024</span></span>
<span><span class="co"># [1] "my_collection_name"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`ctrdata-table-note`</span></span>
<span><span class="co"># [1] "^^^ attr ctrdata-table will be removed by end 2024"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`ctrdata-collection`</span></span>
<span><span class="co"># [1] "my_collection_name"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`ctrdata-dbqueryhistory`</span></span>
<span><span class="co">#       query-timestamp query-register query-records</span></span>
<span><span class="co"># 1 2025-03-02 15:26:22          EUCTR           390</span></span>
<span><span class="co"># 2 2025-03-02 15:26:25         CTGOV2           530</span></span>
<span><span class="co"># 3 2025-03-02 15:26:26         ISRCTN             1</span></span>
<span><span class="co"># 4 2025-03-02 15:26:28           CTIS            21</span></span>
<span><span class="co">#                                                               query-term</span></span>
<span><span class="co"># 1                                       query=neuroblastoma&amp;age=under-18</span></span>
<span><span class="co"># 2                               cond=neuroblastoma&amp;aggFilters=ages:child</span></span>
<span><span class="co"># 3                     &amp;filters=condition:neuroblastoma,ageRange:Child&amp;q=</span></span>
<span><span class="co"># 4 searchCriteria={"medicalCondition":"neuroblastoma","ageGroupCode":[2]}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="de-duplicate-records">De-duplicate records<a class="anchor" aria-label="anchor" href="#de-duplicate-records"></a>
</h2>
<p>In the database, the variable “_id” is the unique index for a record.
This “_id” is the NCT number for CTGOV records (e.g., “NCT00002560”),
and it is the EudraCT number for EUCTR records including the postfix
identifying the EU Member State (e.g., “2008-001436-12-NL”). It is
relevant to de-duplicate records because a trial can be registered in
both CTGOV2 and EUCTR, and can have records by involved country in
EUCTR.</p>
<p>De-duplication is done at the analysis stage because this enables to
select if a trial record should be taken from one or the other register,
and from one or the other EU Member State. The basis of de-duplication
is the recording of additional trial identifiers in supplementary fields
(variables), which are checked and reported when using function
<code><a href="../reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Obtain de-duplicated trial record ids</span></span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbFindIdsUniqueTrials.html">dbFindIdsUniqueTrials</a></span><span class="op">(</span></span>
<span>  preferregister <span class="op">=</span> <span class="st">"EUCTR"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Searching for duplicate trials... </span></span>
<span><span class="co"># - Getting all trial identifiers (may take some time), 1025 found in collection</span></span>
<span><span class="co"># - Finding duplicates among registers' and sponsor ids...</span></span>
<span><span class="co"># - 284 EUCTR _id were not preferred EU Member State record for 109 trials</span></span>
<span><span class="co"># - Keeping 106 / 0 / 366 / 0 / 8 records from EUCTR / CTGOV / CTGOV2 / ISRCTN / CTIS</span></span>
<span><span class="co"># = Returning keys (_id) of 480 records in collection "my_collection_name"</span></span>
<span></span>
<span><span class="co"># Eliminate duplicate trials records:</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span><span class="va">result</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ids</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># [1] 465</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Note that "ids" are the identifiers of unique trials in the whole collection,</span></span>
<span><span class="co"># whereas the data frame "result" only includes those trials in which any of </span></span>
<span><span class="co"># the fields of interest had a value, thus explaining why "result" has fewer</span></span>
<span><span class="co"># rows than "ids" has identifiers. </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="use-trial-concepts-to-simplify-analyses">Use trial concepts to simplify analyses<a class="anchor" aria-label="anchor" href="#use-trial-concepts-to-simplify-analyses"></a>
</h2>
<p>An alternative is to calculate a column <code>isUniqueTrial</code>
already at the time that a data frame is created. This uses one of the
trial concepts that provide a canonical field, calculated from trial
information of any register, see
<code>help(ctrdata-trial-concepts)</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Obtain data of interest</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="va">fieldsOfInterest</span>, </span>
<span>  calculate <span class="op">=</span> <span class="st">"f.isUniqueTrial"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Querying database (8 fields)...</span></span>
<span><span class="co"># - Finding duplicates among registers' and sponsor ids... </span></span>
<span><span class="co"># - 132 EUCTR _id were not preferred EU Member State record for 87 trials</span></span>
<span><span class="co"># - Keeping 530 / 50 / 0 / 0 / 11 records from CTGOV2 / EUCTR / CTGOV / ISRCTN / CTIS</span></span>
<span><span class="co"># = Returning keys (_id) of 591 records in collection "my_collection_name"</span></span>
<span></span>
<span><span class="co"># Eliminate duplicate trials records:</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span><span class="va">result</span><span class="op">[[</span><span class="st">".isUniqueTrial"</span><span class="op">]</span><span class="op">]</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># [1] 591</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Note this has used a different register as priority.</span></span>
<span><span class="co"># Also, the data frame result includes all trials which</span></span>
<span><span class="co"># had a value in at least one of the fields of interest</span></span>
<span><span class="co"># or the fields needed to calculate the trial concept. </span></span>
<span></span>
<span><span class="co"># See description of concept .isUniqueTrial: </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="st">"f.isUniqueTrial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># See how concept .isUniqueTrial is implemented</span></span>
<span><span class="va">f.isUniqueTrial</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reviewing-a-specific-trial">Reviewing a specific trial<a class="anchor" aria-label="anchor" href="#reviewing-a-specific-trial"></a>
</h2>
<p>It will often be useful to inspect all data for a single trial,
e.g. to understand the meaning and relation of fields, to see where
certain information is stored, and to identify fields of interest.</p>
<p>For a given trial, function <a href="https://rfhb.github.io/ctrdata/reference/ctrShowOneTrial.html">ctrShowOneTrial()</a>
enables the user to visualise the hiearchy of fields and contents in the
user’s local web browser, to search for field names and field values,
and to select and copy selected fields’ names for use with function <a href="https://rfhb.github.io/ctrdata/reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf()</a>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Opens a web browser for user interaction.</span></span>
<span><span class="co"># If the trial is not found in the database,</span></span>
<span><span class="co"># it will be loaded from the register. </span></span>
<span><span class="co">#</span></span>
<span><span class="co"># The search is for both, field names and values</span></span>
<span><span class="fu"><a href="../reference/ctrShowOneTrial.html">ctrShowOneTrial</a></span><span class="op">(</span><span class="st">"2022-501725-21-00"</span>, con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span></code></pre></div>
<p><img src="ctisnested2.png" alt="CtisNested"> Alternatively, use any
standard database function to retrieve the trial’s <code>JSON</code>
representation that <code>ctrdata</code> had stored in the collection
and visualise its nested structure of field names and values.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Requires additional package for visualisation</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"hrbrmstr/jsonview"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Works with DuckDb, SQLite, PostgreSQL, MongoDB</span></span>
<span><span class="va">oneTrial</span> <span class="op">&lt;-</span> <span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/nodbi/reference/docdb_query.html" class="external-link">docdb_query</a></span><span class="op">(</span></span>
<span>  src <span class="op">=</span> <span class="va">db</span>, </span>
<span>  key <span class="op">=</span> <span class="va">db</span><span class="op">$</span><span class="va">collection</span>, </span>
<span>  query <span class="op">=</span> <span class="st">'{"_id":"2022-501725-21-00"}'</span>,</span>
<span>  limit <span class="op">=</span> <span class="fl">1L</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Interactive widget where nodes can be expanded,</span></span>
<span><span class="co"># note that fields and values cannot be searched</span></span>
<span><span class="fu">jsonview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonview/man/json_tree_view.html" class="external-link">json_tree_view</a></span><span class="op">(</span><span class="va">oneTrial</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simple-analysis-of-dates">Simple analysis of dates<a class="anchor" aria-label="anchor" href="#simple-analysis-of-dates"></a>
</h2>
<p>In a data frame generated with <code><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf()</a></code>,
fields are typed as dates, logical, character or numbers. This typing
facilitates using the data for analysis, for example of dates with base
R graphics:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get data of interest</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="st">"ctrname"</span>,</span>
<span>  calculate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"f.isUniqueTrial"</span>, <span class="st">"f.startDate"</span><span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Querying database (11 fields)...</span></span>
<span><span class="co"># - Finding duplicates among registers' and sponsor ids... </span></span>
<span><span class="co"># - 132 EUCTR _id were not preferred EU Member State record for 83 trials</span></span>
<span><span class="co"># - Keeping 530 / 50 / 0 / 1 / 11 records from CTGOV2 / EUCTR / CTGOV / ISRCTN / CTIS</span></span>
<span><span class="co"># = Returning keys (_id) of 591 records in collection "my_collection_name"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># 'data.frame': 942 obs. of  4 variables:</span></span>
<span><span class="co">#  $ _id           : chr  "2004-004386-15-DE" "2004-004386-15-ES" "2004-004386-15-GB" "2004-004386-15-IT" ...</span></span>
<span><span class="co">#  $ ctrname       : chr  "EUCTR" "EUCTR" "EUCTR" "EUCTR" ...</span></span>
<span><span class="co">#  $ .isUniqueTrial: logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#  $ .startDate    : Date, format: "2005-07-26" "2005-11-15" "2005-07-26" ...</span></span>
<span></span>
<span><span class="co"># Open file for saving</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"vignettes/nb1.png"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># De-duplicate and visualise start date</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">[</span><span class="va">result</span><span class="op">$</span><span class="va">.isUniqueTrial</span>, <span class="st">".startDate"</span><span class="op">]</span>,</span>
<span>  breaks <span class="op">=</span> <span class="st">"years"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="nb1.png" alt="Histogram1"><div class="figcaption">Histogram1</div>
</div>
</div>
<div class="section level2">
<h2 id="cross-register-clinical-trial-concepts">Cross-register clinical trial concepts<a class="anchor" aria-label="anchor" href="#cross-register-clinical-trial-concepts"></a>
</h2>
<p>A number of calculations across fields from different registers are
available in <code>ctrdata</code>. This offers much convenience for
users, because it provides a canonical understanding and implementation
of the mapping of corresponding fields and value lists across different
registers. Available calculations can be listed, and a specific
documentation shown.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Introduction and overview of available trial concepts</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="st">"ctrdata-trial-concepts"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show documentation of a specific trial concept </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="st">"f.isMedIntervTrial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># List concepts available at this time</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/ls_str.html" class="external-link">ls.str</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ns-reflect.html" class="external-link">getNamespace</a></span><span class="op">(</span><span class="st">"ctrdata"</span><span class="op">)</span>,</span>
<span>  all.names <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pattern <span class="op">=</span> <span class="st">"^f[.][a-z]"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#  [1] "f.controlType"                "f.isMedIntervTrial"           "f.isUniqueTrial"             </span></span>
<span><span class="co">#  [4] "f.likelyPlatformTrial"        "f.numSites"                   "f.numTestArmsSubstances"     </span></span>
<span><span class="co">#  [7] "f.primaryEndpointDescription" "f.primaryEndpointResults"     "f.resultsDate"               </span></span>
<span><span class="co"># [10] "f.sampleSize"                 "f.sponsorType"                "f.startDate"                 </span></span>
<span><span class="co"># [13] "f.statusRecruitment"          "f.trialObjectives"            "f.trialPhase"                </span></span>
<span><span class="co"># [16] "f.trialPopulation"            "f.trialTitle"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="merging-fields-for-analysis">Merging fields for analysis<a class="anchor" aria-label="anchor" href="#merging-fields-for-analysis"></a>
</h2>
<p>With the function <code><a href="../reference/dfMergeVariablesRelevel.html">dfMergeVariablesRelevel()</a></code>, users have
control how to merge values of a set of original variables to a new
variable, optionally with a new set of values. For more, see
<code><a href="../reference/dfMergeVariablesRelevel.html">help(dfMergeVariablesRelevel)</a></code>. This can be used for
concepts that are very specific to the use case and / or not implemented
so far, see <code>help(ctrdata-trial-concepts)</code>.</p>
</div>
<div class="section level2">
<h2 id="historic-versions-of-trial-records-and-changes-in-sample-sizes">Historic versions of trial records and changes in sample sizes<a class="anchor" aria-label="anchor" href="#historic-versions-of-trial-records-and-changes-in-sample-sizes"></a>
</h2>
<p>Historic versions can set to be retrieved for CTGOV2 by specifying
<code>ctgov2history = &lt;...&gt;</code> when using
<code><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb()</a></code>; this functionality was added in
<code>ctrdata</code> version 1.18.0. The versions include all trial data
available at the date of the respective version. Only CTGOV2 provides
historic versions at this time (CTIS only until its relaunch on
2024-06-17) as part of their respective APIs. Nevertheless, historic
versions can be created for CTIS by specifying
<code>querytoupdate = &lt;...&gt;, ctishistory = TRUE</code> when using
<code><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb()</a></code>; this functionality thus is not
provided by the register but triggered by the user, it was added in
<code>ctrdata</code> version 1.21.1.9000.</p>
<p>The following schema represents two clinical trial records (one each
from CTGOV2 and CTIS) with the array of <code>history: [...]</code>
versions as part of a trial’s record (the ellipsis <code>...</code>
represents all other data fields):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="st">'</span></span>
<span><span class="st">[</span></span>
<span><span class="st">  {</span></span>
<span><span class="st">   "_id":"NCT01234567", </span></span>
<span><span class="st">   "title": "Current title", </span></span>
<span><span class="st">   "clinical_results": ..., </span></span>
<span><span class="st">   ..., </span></span>
<span><span class="st">   "history": [</span></span>
<span><span class="st">     {</span></span>
<span><span class="st">      "history_version": {</span></span>
<span><span class="st">        "version_number": 1, </span></span>
<span><span class="st">        "version_date": "2020-21-22 10:11:12"}, </span></span>
<span><span class="st">      "title": "Original title", </span></span>
<span><span class="st">      "clinical_results": ..., </span></span>
<span><span class="st">      ...</span></span>
<span><span class="st">     }, </span></span>
<span><span class="st">     {</span></span>
<span><span class="st">      "history_version": {</span></span>
<span><span class="st">        "version_number": 2, </span></span>
<span><span class="st">        "version_date": "2021-22-23 11:13:13"}, </span></span>
<span><span class="st">      "title": "Later title", </span></span>
<span><span class="st">      "clinical_results": ..., </span></span>
<span><span class="st">      ...</span></span>
<span><span class="st">     }</span></span>
<span><span class="st">   ]</span></span>
<span><span class="st">  },</span></span>
<span><span class="st">  {</span></span>
<span><span class="st">   "_id":"2022-502051-56-00", </span></span>
<span><span class="st">   "title": "Current title", </span></span>
<span><span class="st">   "ctrname": "CTIS", </span></span>
<span><span class="st">   "lastUpdated": "2025-04-07"</span></span>
<span><span class="st">   "authorizedPartsII": ...,</span></span>
<span><span class="st">   ..., </span></span>
<span><span class="st">   "history": [</span></span>
<span><span class="st">     {</span></span>
<span><span class="st">      "history_version": {</span></span>
<span><span class="st">        "version_number": 0, </span></span>
<span><span class="st">        "version_date": "2025-04-06"}, </span></span>
<span><span class="st">      "title": "Intermediate title", </span></span>
<span><span class="st">      "ctrname": "CTIS", </span></span>
<span><span class="st">      "lastUpdated": "2025-04-06"</span></span>
<span><span class="st">      "authorizedPartsII": ...,</span></span>
<span><span class="st">      ...</span></span>
<span><span class="st">     }, </span></span>
<span><span class="st">     {</span></span>
<span><span class="st">      "history_version": {</span></span>
<span><span class="st">        "version_number": 0, </span></span>
<span><span class="st">        "version_date": "2025-04-05"}, </span></span>
<span><span class="st">      "title": "Original title", </span></span>
<span><span class="st">      "ctrname": "CTIS", </span></span>
<span><span class="st">      "lastUpdated": "2025-04-05"</span></span>
<span><span class="st">      "authorizedPartsII": ...,</span></span>
<span><span class="st">      ...</span></span>
<span><span class="st">     }</span></span>
<span><span class="st">   ]</span></span>
<span><span class="st">  },</span></span>
<span><span class="st">  ...</span></span>
<span><span class="st">]</span></span>
<span><span class="st">'</span></span></code></pre></div>
<p>The example shows how planned or realised number of participants
(sample size) changed over time for individual trials, using available
data</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load previous query (above), specifying that </span></span>
<span><span class="co"># for each trial, 5 versions should be retrieved</span></span>
<span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  queryterm <span class="op">=</span> <span class="va">queries</span><span class="op">[</span><span class="st">"CTGOV2"</span><span class="op">]</span>, </span>
<span>  con <span class="op">=</span> <span class="va">db</span>, </span>
<span>  ctgov2history <span class="op">=</span> <span class="fl">5L</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get relevant fields</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># only CTGOV2 has structured historic information</span></span>
<span>    <span class="st">"history.history_version.version_date"</span>,</span>
<span>    <span class="st">"history.protocolSection.designModule.enrollmentInfo.count"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  calculate <span class="op">=</span> <span class="st">"f.statusRecruitment"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Helper packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mangle and plot</span></span>
<span><span class="va">result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"history."</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.statusRecruitment</span> <span class="op">==</span> <span class="st">"completed"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">history.protocolSection.designModule.enrollmentInfo.count</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">history.protocolSection.designModule.enrollmentInfo.count</span> <span class="op">&gt;</span> <span class="fl">0L</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">`_id`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">history.history_version.version_date</span>,</span>
<span>      y <span class="op">=</span> <span class="va">history.protocolSection.designModule.enrollmentInfo.count</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">`_id`</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Sample sizes in trials including patients with a neuroblastoma"</span>, </span>
<span>    subtitle <span class="op">=</span> <span class="st">"Source: CTGOV2 records labelled as phase 3 and completed"</span>, </span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/samplesizechanges.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="samplesizechanges.png" alt="Sample size changes"><div class="figcaption">Sample size changes</div>
</div>
</div>
<div class="section level2">
<h2 id="analysing-nested-fields-such-as-trial-results">Analysing nested fields such as trial results<a class="anchor" aria-label="anchor" href="#analysing-nested-fields-such-as-trial-results"></a>
</h2>
<p>The registers represent clinical trial information by nesting fields
(e.g., several reporting groups within several measures within one of
several endpoints). A visualisation of this hierarchical representation
for CTGOV2 follows. Compare this with the outcome measures presented
here: <a href="https://clinicaltrials.gov/study/NCT02139397?tab=results#outcome-measures" class="external-link uri">https://clinicaltrials.gov/study/NCT02139397?tab=results#outcome-measures</a>,
specifically “3. Determine the Progression Free Survival (PFS)…”</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Since version 1.20.0, an interactive widget is built into ctrdata</span></span>
<span><span class="co"># and can be used to search in all field names and all values </span></span>
<span><span class="fu"><a href="../reference/ctrShowOneTrial.html">ctrShowOneTrial</a></span><span class="op">(</span><span class="st">"NCT02139397"</span>, con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span></code></pre></div>
<p>See example for <code><a href="../reference/ctrShowOneTrial.html">ctrShowOneTrial()</a></code> in section <a href="#reviewing-a-specific-trial">Reviewing a specific trial</a>. An
alternative is:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Helper package</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"https://github.com/hrbrmstr/jsonview"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get relevant data</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span><span class="st">"resultsSection.outcomeMeasuresModule"</span>, con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create interactive widget</span></span>
<span><span class="fu">jsonview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonview/man/json_tree_view.html" class="external-link">json_tree_view</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span><span class="va">result</span><span class="op">[[</span><span class="st">"_id"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"NCT02139397"</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="ctgov2nestedresults2.png" alt="Ctgov2NestedResults"><div class="figcaption">Ctgov2NestedResults</div>
</div>
<p>The analysis of nested information such as the highlighted duration
of response is facilitated with <code>ctrdata</code> as follows. The
main steps are:</p>
<ol style="list-style-type: decimal">
<li><p>Create a data from fields identified as shown in previous
sections (using <code><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf()</a></code>)</p></li>
<li><p>Transform nested information to a long, name-value data frame
(using <code><a href="../reference/dfTrials2Long.html">dfTrials2Long()</a></code>)</p></li>
<li><p>Identify the measures of interest (e.g. PFS, blue circle above)
by specifying the name and value of these fields
(<code>wherename</code>, <code>wherevalue</code> in function
<code><a href="../reference/dfName2Value.html">dfName2Value()</a></code>)</p></li>
<li><p>Obtain values by specifying the name(s) of its value field(s)
(red and green circles in figure above; <code>valuename</code> in
function <code><a href="../reference/dfName2Value.html">dfName2Value()</a></code>)</p></li>
<li><p>Tabulate the results of interest</p></li>
</ol>
<p>This is put together in the following example. Note that
<code>CTGOV</code> fields are no longer downloadable (see NEWS.md) but
may exist in previously created databases.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### 1. Create data frame from results fields</span></span>
<span><span class="co"># These are key results fields from</span></span>
<span><span class="co"># CTGOV2, CTGOV and from EUCTR:</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># EUCTR - note this requires to set parameter</span></span>
<span>    <span class="co"># euctrresults = TRUE in ctrLoadQueryIntoDb()</span></span>
<span>    <span class="co"># as shown above in section "User annotations"</span></span>
<span>    <span class="st">"trialInformation.populationAgeGroup"</span>,</span>
<span>    <span class="st">"subjectDisposition.recruitmentDetails"</span>,</span>
<span>    <span class="st">"baselineCharacteristics.baselineReportingGroups.baselineReportingGroup"</span>,</span>
<span>    <span class="st">"endPoints.endPoint"</span>,</span>
<span>    <span class="st">"subjectAnalysisSets"</span>,</span>
<span>    <span class="st">"adverseEvents.seriousAdverseEvents.seriousAdverseEvent"</span>, </span>
<span>    <span class="co"># CTGOV2</span></span>
<span>    <span class="st">"resultsSection.outcomeMeasuresModule"</span>,</span>
<span>    <span class="st">"protocolSection.designModule.designInfo.allocation"</span>, </span>
<span>    <span class="st">"resultsSection.participantFlowModule"</span>,</span>
<span>    <span class="co"># CTGOV</span></span>
<span>    <span class="st">"clinical_results.baseline.analyzed_list.analyzed.count_list.count"</span>,</span>
<span>    <span class="st">"clinical_results.baseline.group_list.group"</span>,</span>
<span>    <span class="st">"clinical_results.baseline.analyzed_list.analyzed.units"</span>,</span>
<span>    <span class="st">"clinical_results.outcome_list.outcome"</span>,</span>
<span>    <span class="st">"study_design_info.allocation"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  calculate <span class="op">=</span> <span class="st">"f.isUniqueTrial"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Keep only unique trial records</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span><span class="va">result</span><span class="op">[[</span><span class="st">".isUniqueTrial"</span><span class="op">]</span><span class="op">]</span>, <span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co">#### 2. All nested data are transformed to a long,</span></span>
<span><span class="co"># Name value data frame (which has several hundred</span></span>
<span><span class="co"># rows for each trial, with one row per field):</span></span>
<span><span class="co"># </span></span>
<span><span class="va">long_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfTrials2Long.html">dfTrials2Long</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">result</span><span class="op">)</span></span>
<span><span class="co"># Total 89038 rows, 159 unique names of variables</span></span>
<span><span class="va">long_result</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">10000</span>, <span class="fl">80000</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co"># # A tibble: 3 × 4</span></span>
<span><span class="co">#   `_id`             identifier name                                                        value</span></span>
<span><span class="co">#   &lt;chr&gt;             &lt;chr&gt;      &lt;chr&gt;                                                       &lt;chr&gt;</span></span>
<span><span class="co"># 1 2007-000371-42-PL 36         adverseEvents.seriousAdverseEvents.seriousAdverseEvent.dic… false</span></span>
<span><span class="co"># 2 2013-003595-12-CZ 13.3       adverseEvents.seriousAdverseEvents.seriousAdverseEvent.val… 0    </span></span>
<span><span class="co"># 3 NCT02124772       25.3       resultsSection.outcomeMeasuresModule.outcomeMeasures.denom… OG002</span></span>
<span></span>
<span></span>
<span><span class="co">#### 3. and 4. Obtain values for measures of interest </span></span>
<span><span class="co">#</span></span>
<span><span class="co"># The parameters can be regular expressions</span></span>
<span><span class="va">clinicalDuration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dfName2Value.html">dfName2Value</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">long_result</span>,</span>
<span>  <span class="co"># 3. Identify measures of interest</span></span>
<span>  wherename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"endPoints.endPoint.title|"</span>,</span>
<span>    <span class="st">"resultsSection.outcomeMeasuresModule.outcomeMeasures.title"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  wherevalue <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"duration of response|DOR|"</span>,</span>
<span>    <span class="st">"free survival|DFS|PFS|EFS"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># 4. Obtain result values for measure</span></span>
<span>  valuename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"resultsSection.*outcomeMeasures.classes.categories.measurements.value|"</span>,</span>
<span>    <span class="st">"endPoints.*armReportingGroup.tendencyValues.tendencyValue.value|"</span>,</span>
<span>    <span class="st">"resultsSection.outcomeMeasuresModule.outcomeMeasures.unitOfMeasure|"</span>,</span>
<span>    <span class="st">"endPoints.endPoint.unit|"</span>,</span>
<span>    <span class="st">"resultsSection.outcomeMeasuresModule.outcomeMeasures.groups.title|"</span>,</span>
<span>    <span class="st">"endPoints.*armReportingGroup.armId"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Returning values for 53 out of 683 trials</span></span>
<span></span>
<span></span>
<span><span class="co">#### 5. Tabulate the results</span></span>
<span></span>
<span><span class="co"># PFS / EFS duration has been reported with various units:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">clinicalDuration</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"unit"</span>, <span class="va">clinicalDuration</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>, <span class="st">"value"</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># [1] "3 year EFS"                               "Days"                                    </span></span>
<span><span class="co"># [3] "Estimated probability"                    "L/hr"                                    </span></span>
<span><span class="co"># [5] "months"                                   "Months"                                  </span></span>
<span><span class="co"># [7] "number of participants with No VOD/Death" "Participants"                            </span></span>
<span><span class="co"># [9] "percent of probability"                   "percent probability" </span></span>
<span></span>
<span><span class="co"># Helper packages for convenience</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mangle data for tabulation</span></span>
<span><span class="va">clinicalDuration</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    group_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">`_id`</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"([0-9]+)[.]?.*"</span>, <span class="st">"\\1"</span>, <span class="va">identifier</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    name_short <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">".*[.](.+)"</span>, <span class="st">"\\1"</span>, <span class="va">name</span><span class="op">)</span>,</span>
<span>    name_short <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">name_short</span> <span class="op">==</span> <span class="st">"unitOfMeasure"</span>, <span class="st">"unit"</span>, <span class="va">name_short</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">group_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    is_duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"day|month|week|year"</span>, <span class="va">value</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">is_duration</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name_short</span>, <span class="va">value</span>, <span class="va">where</span>, <span class="va">group_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">group_id</span>, <span class="va">where</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="va">name_short</span>, values_fn <span class="op">=</span> <span class="va">list</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">unit</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"999[9]*"</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>    arm_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">armId</span>, <span class="va">title</span>, collapse <span class="op">=</span> <span class="st">" / "</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    days <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"[wW]eek"</span>, <span class="va">unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">value</span> <span class="op">*</span> <span class="fl">7</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"[mM]onth"</span>, <span class="va">unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">value</span> <span class="op">*</span> <span class="fl">30</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"[yY]ear"</span>, <span class="va">unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">value</span> <span class="op">*</span> <span class="fl">30</span>,</span>
<span>      .default <span class="op">=</span> <span class="va">value</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">unit</span>, <span class="va">armId</span>, <span class="va">title</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">clinicalDuration</span></span>
<span></span>
<span><span class="va">clinicalDuration</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">clinicalDuration</span><span class="op">)</span><span class="op">)</span>, <span class="fl">10L</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co"># # A tibble: 10 × 4</span></span>
<span><span class="co">#    group_id             where                                                    arm_names  days</span></span>
<span><span class="co">#    &lt;chr&gt;                &lt;chr&gt;                                                    &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#  1 NCT01962103_22       Phase 2: Progression-Free Survival (PFS)                 " Phase …  91  </span></span>
<span><span class="co">#  2 NCT02162732_4        Progression Free Survival (PFS) Interval Will be Measur… " Neurob… 283  </span></span>
<span><span class="co">#  3 2014-004685-25-DE_11 PFS as Determined by the Investigator using RANO criter… ""         NA  </span></span>
<span><span class="co">#  4 NCT01355679_4        Activity of Treatments Chosen Based on Progression Free… " Guided…  59  </span></span>
<span><span class="co">#  5 2014-004697-41-IT_16 Duration of Response (DOR) as Determined by the Investi… "Arm-104… 396  </span></span>
<span><span class="co">#  6 NCT02162732_4        Progression Free Survival (PFS) Interval Will be Measur… " Neurob… 163  </span></span>
<span><span class="co">#  7 NCT01483820_3        Number of Days Participants Experienced Progression Fre… " TPI 28…  46  </span></span>
<span><span class="co">#  8 NCT01505608_5        Progression Free Survival (PFS) of Participants Using D… " Arm A-… 125  </span></span>
<span><span class="co">#  9 NCT02139397_3        Determine the Progression Free Survival (PFS) of Partic… " Phase …  51.2</span></span>
<span><span class="co"># 10 NCT04029688_14       Part 1b: PFS in Participants With Neuroblastoma From SE… " Part 1…  54  </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analysing-primary-endpoints">Analysing primary endpoints<a class="anchor" aria-label="anchor" href="#analysing-primary-endpoints"></a>
</h2>
<p>Text analysis has to be used for many fields of trial information
from the registers. Here is an example to simply categorise the type of
primary endpoint. In addition, the number of subjects are compared by
type of primary endpoint. The example uses trial concepts introduced in
earlier sections, see <code>help(ctrdata-trial-concepts)</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get relevant data</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  calculate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"f.isUniqueTrial"</span>,</span>
<span>    <span class="st">"f.sampleSize"</span>,</span>
<span>    <span class="st">"f.trialPopulation"</span>,</span>
<span>    <span class="st">"f.primaryEndpointDescription"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Querying database (56 fields)...</span></span>
<span><span class="co"># - Finding duplicates among registers' and sponsor ids... </span></span>
<span><span class="co"># - 132 EUCTR _id were not preferred EU Member State record for 83 trials</span></span>
<span><span class="co"># - Keeping 613 / 50 / 0 / 1 / 19 records from CTGOV2 / EUCTR / CTGOV / ISRCTN / CTIS</span></span>
<span><span class="co"># Calculating .primaryEndpointDescription... </span></span>
<span></span>
<span><span class="co"># De-duplicate</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span><span class="va">result</span><span class="op">[[</span><span class="st">".isUniqueTrial"</span><span class="op">]</span><span class="op">]</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># For primary endpoint of interest, use regular expression on text to</span></span>
<span><span class="co"># identify time to the respective event (mostly includes death events)</span></span>
<span><span class="va">regex</span> <span class="op">&lt;-</span> <span class="st">"((progression|event|relapse|recurrence|disease)[- ]free)|pfs|dfs|efs)"</span></span>
<span></span>
<span><span class="co"># .primaryEndpointDescription is in each cell a list of one or more </span></span>
<span><span class="co"># items with an endpoint description; grepl works on each such item</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">pep_is_efs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span></span>
<span>  pattern <span class="op">=</span> <span class="va">regex</span>,</span>
<span>  x <span class="op">=</span> <span class="va">result</span><span class="op">$</span><span class="va">.primaryEndpointDescription</span>,</span>
<span>  ignore.case <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tabulate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">pep_is_efs</span><span class="op">)</span></span>
<span><span class="co"># FALSE  TRUE</span></span>
<span><span class="co">#   522    69</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">result</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">.sampleSize</span>,</span>
<span>    y <span class="op">=</span> <span class="va">pep_is_efs</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Warning message:</span></span>
<span><span class="co"># Removed 90 rows containing non-finite values (`stat_boxplot()`). </span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/boxpep.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="boxpep.png" alt="BoxPEP"><div class="figcaption">BoxPEP</div>
</div>
</div>
<div class="section level2">
<h2 id="analysis-methods-and-p-values">Analysis methods and p values<a class="anchor" aria-label="anchor" href="#analysis-methods-and-p-values"></a>
</h2>
<p>It may be interesting to review results of the primary endpoint in a
set of trials, for a therapeutic area or a types of endpoints or
designs. The results of null-hypothesis significance testing (NHST) may
show an interesting distribution of p values (see also Robinson-D 2014,
<a href="http://varianceexplained.org/statistics/interpreting-pvalue-histogram/" class="external-link uri">http://varianceexplained.org/statistics/interpreting-pvalue-histogram/</a>,
which refers to cases with many p values, possibly from a single
experiment). When analysed robustly in a well-defined set of trials,
such distributions may allow assumptions about equipoise, forking path
or reporting preferences.</p>
<p>The example merely shows the technical approach, without asserting
relevance. For a robust analysis, consider further trial concepts (in
particular, “f.trialObjectives”, “f.controlType”, “f.isMedIntervTrial”,
“f.trialPhase”), see <code>help(ctrdata-trial-concepts)</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get result set</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  calculate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"f.isUniqueTrial"</span>,</span>
<span>    <span class="st">"f.sampleSize"</span>,</span>
<span>    <span class="st">"f.primaryEndpointResults"</span></span>
<span>  <span class="op">)</span>, </span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Querying database (31 fields)...</span></span>
<span></span>
<span><span class="co"># De-duplicate</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span><span class="va">result</span><span class="op">[[</span><span class="st">".isUniqueTrial"</span><span class="op">]</span><span class="op">]</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Helper package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot p values ECDF</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">result</span>, </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.primaryEndpointFirstPvalue</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ecdf.html" class="external-link">stat_ecdf</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"step"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Trials with children with a neuroblastoma"</span>, </span>
<span>    x <span class="op">=</span> <span class="st">"Range of p values"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Empirical cumulative density of p values\nfrom primary endpoint primary analysis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>    linetype <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/phase23_paed_p_values.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot sample size vs. p value</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">result</span>, </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">.sampleSize</span>, </span>
<span>    y <span class="op">=</span> <span class="va">.primaryEndpointFirstPvalue</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.05</span>, linetype <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/phase23_paed_p_values_participants.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Statistical method used for primary endpoint analysis</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">.primaryEndpointFirstPmethod</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Var1</th>
<th align="right">Freq</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">logrank</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">fisherexact</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">wilcoxon</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">regressioncox</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">mcnemar</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">exactonesidedbinomialtest</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">cochranarmitagetrendtest</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">chisquared</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="float">
<img src="phase23_paed_p_values.png" alt="phase23_paed_p_values"><div class="figcaption">phase23_paed_p_values</div>
</div>
<div class="float">
<img src="phase23_paed_p_values_participants.png" alt="phase23_paed_p_values"><div class="figcaption">phase23_paed_p_values</div>
</div>
</div>
<div class="section level2">
<h2 id="investigational-or-authorised-medicinal-product">Investigational or authorised medicinal product?<a class="anchor" aria-label="anchor" href="#investigational-or-authorised-medicinal-product"></a>
</h2>
<p>The information about the status of authorisation (licensing) of a
medicine used in a trial is recorded in EUCTR in the field
<code>dimp.d21_imp_to_be_used_in_the_trial_has_a_marketing_authorisation</code>.
A corresponding field in CTGOV, CTGOV2 and ISRCTN is not known. The
status is in the tree starting from the <code>dimp</code> element.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Helper package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get results</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"a1_member_state_concerned"</span>,</span>
<span>    <span class="st">"n_date_of_competent_authority_decision"</span>,</span>
<span>    <span class="st">"dimp.d21_imp_to_be_used_in_the_trial_has_a_marketing_authorisation"</span>,</span>
<span>    <span class="st">"x6_date_on_which_this_record_was_first_entered_in_the_eudract_database"</span>,</span>
<span>    <span class="st">"f422_in_the_whole_clinical_trial"</span>,</span>
<span>    <span class="st">"a2_eudract_number"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  calculate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"f.isUniqueTrial"</span>,</span>
<span>    <span class="st">"f.startDate"</span></span>
<span>    <span class="op">)</span>, </span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># De-duplicate</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span><span class="va">result</span><span class="op">[[</span><span class="st">".isUniqueTrial"</span><span class="op">]</span><span class="op">]</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># How many of the investigational medicinal product(s)</span></span>
<span><span class="co"># that are being used in the trial are authorised?</span></span>
<span><span class="va">number_authorised</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"dimp.d21_imp_to_be_used_in_the_trial_has_a_marketing_authorisation"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="cn">NA</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">i</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">number_authorised</span>, exclude <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co"># number_authorised</span></span>
<span><span class="co">#    0    1    2    3    4    5    6    7   13 &lt;NA&gt; </span></span>
<span><span class="co">#   19   13    5    1    3    3    1    1    1  544</span></span>
<span></span>
<span><span class="va">result</span><span class="op">[[</span><span class="st">"any_authorised"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">number_authorised</span> <span class="op">&gt;</span> <span class="fl">0L</span></span>
<span></span>
<span><span class="co"># Helper packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">any_authorised</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">.startDate</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">any_authorised</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/breaks_width.html" class="external-link">breaks_width</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"2 years"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/date_format.html" class="external-link">date_format</a></span><span class="op">(</span><span class="st">"%Y"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">365.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Selected clinical trials in EU"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year of trial start"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of trials"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Medicine\nauthorised?"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/nbtrials.png"</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="nbtrials.png" alt="HistogramNBtrials"><div class="figcaption">HistogramNBtrials</div>
</div>
</div>
<div class="section level2">
<h2 id="analyses-using-mongodb-pipeline">Analyses using MongoDB pipeline<a class="anchor" aria-label="anchor" href="#analyses-using-mongodb-pipeline"></a>
</h2>
<p>Here is an example of analysis functions that can be run directly on
a MongoDB server, which are fast and do not consume R resources.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load package for database access</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/mongolite" class="external-link">mongolite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create R object m to access the</span></span>
<span><span class="co"># collection db created above</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/mongolite/reference/mongo.html" class="external-link">mongo</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">db</span><span class="op">[[</span><span class="st">"url"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"/"</span>, <span class="va">db</span><span class="op">[[</span><span class="st">"db"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  collection <span class="op">=</span> <span class="va">db</span><span class="op">[[</span><span class="st">"collection"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Number of records in  collection</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># [1] 943</span></span>
<span></span>
<span><span class="co"># Number of EUCTR records, using JSON for query</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span>query <span class="op">=</span> <span class="st">'{"_id": {"$regex": "[0-9]{4}-[0-9]{6}-[0-9]{2}-[3A-Z]{2,3}", "$options": "i"}}'</span><span class="op">)</span></span>
<span><span class="co"># [1] 390</span></span>
<span></span>
<span><span class="co"># Alternative</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span>query <span class="op">=</span> <span class="st">'{"ctrname": "EUCTR"}'</span><span class="op">)</span></span>
<span><span class="co"># [1] 390</span></span>
<span></span>
<span><span class="co"># Number of CTGOV records</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span>query <span class="op">=</span> <span class="st">'{"_id": {"$regex": "NCT[0-9]{8}", "$options": "i"}}'</span><span class="op">)</span></span>
<span><span class="co"># [1] 530</span></span>
<span></span>
<span><span class="co"># Alternative</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span>query <span class="op">=</span> <span class="st">'{"ctrname": "CTGOV2"}'</span><span class="op">)</span></span>
<span><span class="co"># [1] 530</span></span>
<span></span>
<span><span class="co"># To best define regular expressions for analyses, inspect the field:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span></span>
<span>  <span class="va">m</span><span class="op">$</span><span class="fu">distinct</span><span class="op">(</span></span>
<span>    key <span class="op">=</span> <span class="st">"protocolSection.outcomesModule.primaryOutcomes.measure"</span>,</span>
<span>    query <span class="op">=</span> <span class="st">'{"ctrname": "CTGOV2"}'</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># [1] "- To demonstrate that 123I-mIBG planar scintigraphy is sensitive and ...</span></span>
<span><span class="co"># [2] "1-year Progression-free Survival"</span></span>
<span><span class="co"># [3] "18F-mFBG PET Scan identification of Neuroblastoma on the LAFOV PET/CT"</span></span>
<span><span class="co"># [4] "1p36 deletion status and its association with UBE4B"</span></span>
<span><span class="co"># [5] "2-year progression free survival"</span></span>
<span><span class="co"># [6] "2-year progression free survival (PFS)" </span></span></code></pre></div>
<div class="section level3">
<h3 id="aggregation">Aggregation<a class="anchor" aria-label="anchor" href="#aggregation"></a>
</h3>
<p>The following example uses the aggregation pipeline in MongoDB. See
here for details on mongo’s aggregation pipleline: <a href="https://www.mongodb.com/docs/manual/core/aggregation-pipeline/" class="external-link uri">https://www.mongodb.com/docs/manual/core/aggregation-pipeline/</a></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="co"># Total count of PFS, EFS, RFS or DFS</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span></span>
<span>  <span class="co"># Count number of documents in collection that</span></span>
<span>  <span class="co"># matches in primary_outcome.measure the</span></span>
<span>  <span class="co"># regular expression,</span></span>
<span>  pipeline <span class="op">=</span></span>
<span>    <span class="st">'[{"$match": {"protocolSection.outcomesModule.primaryOutcomes.measure":</span></span>
<span><span class="st">      {"$regex": "(progression|event|relapse|recurrence|disease)[- ]free",</span></span>
<span><span class="st">                 "$options": "i"}}},</span></span>
<span><span class="st">      {"$group": {"_id": "null", "count": {"$sum": 1}}}]'</span></span>
<span><span class="op">)</span></span>
<span><span class="va">out</span></span>
<span><span class="co">#    _id count</span></span>
<span><span class="co"># 1 null    59</span></span>
<span></span>
<span><span class="co"># List records of trials with overall survival</span></span>
<span><span class="co"># as primary endpoint, and list start date</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span></span>
<span>  pipeline <span class="op">=</span></span>
<span>    <span class="st">'[{"$match": {"protocolSection.outcomesModule.primaryOutcomes.measure":</span></span>
<span><span class="st">      {"$regex": "overall survival", "$options": "i"}}},</span></span>
<span><span class="st">      {"$project": {"_id": 1, "protocolSection.statusModule.startDateStruct.date": 1}}]'</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#          _id       date</span></span>
<span><span class="co"># 1 NCT00445965    2006-01</span></span>
<span><span class="co"># 2 NCT00801931 2007-09-06</span></span>
<span><span class="co"># 3 NCT05303727    2022-08</span></span>
<span><span class="co"># 4 NCT02176967 2014-08-08</span></span>
<span><span class="co"># 5 NCT02558244    2016-01</span></span>
<span><span class="co"># 6 NCT04897880 2019-01-09</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mapreduce">Mapreduce<a class="anchor" aria-label="anchor" href="#mapreduce"></a>
</h3>
<p>Since Mapreduce is deprecated starting in MongoDB 5 (<a href="https://www.mongodb.com/docs/manual/core/map-reduce/" class="external-link uri">https://www.mongodb.com/docs/manual/core/map-reduce/</a>),
use an aggregation pipeline:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Count number of trials by number of study</span></span>
<span><span class="co"># participants in bins of hundreds of participants:</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span>pipeline <span class="op">=</span> <span class="st">'</span></span>
<span><span class="st">[</span></span>
<span><span class="st">  {</span></span>
<span><span class="st">    "$project": {</span></span>
<span><span class="st">      "flooredNumber": {</span></span>
<span><span class="st">        "$multiply": [</span></span>
<span><span class="st">          {</span></span>
<span><span class="st">            "$floor": {</span></span>
<span><span class="st">              "$divide": [</span></span>
<span><span class="st">                {</span></span>
<span><span class="st">                  "$toInt": "$protocolSection.designModule.enrollmentInfo.count"</span></span>
<span><span class="st">                },</span></span>
<span><span class="st">                100</span></span>
<span><span class="st">              ]</span></span>
<span><span class="st">            }</span></span>
<span><span class="st">          },</span></span>
<span><span class="st">          100</span></span>
<span><span class="st">        ]</span></span>
<span><span class="st">      }</span></span>
<span><span class="st">    }</span></span>
<span><span class="st">  },</span></span>
<span><span class="st">  {</span></span>
<span><span class="st">    "$group": {</span></span>
<span><span class="st">      "_id": "$flooredNumber",</span></span>
<span><span class="st">      "count": {</span></span>
<span><span class="st">        "$count": {}</span></span>
<span><span class="st">      }</span></span>
<span><span class="st">    }</span></span>
<span><span class="st">  },</span></span>
<span><span class="st">  {</span></span>
<span><span class="st">    "$sort": {</span></span>
<span><span class="st">      "_id": 1</span></span>
<span><span class="st">    }</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">]</span></span>
<span><span class="st">'</span><span class="op">)</span></span>
<span><span class="co">#     _id count</span></span>
<span><span class="co"># 1    NA   448</span></span>
<span><span class="co"># 2     0   392</span></span>
<span><span class="co"># 3   100    58</span></span>
<span><span class="co"># 4   200    15</span></span>
<span><span class="co"># 5   300     5</span></span>
<span><span class="co"># 6   400     6</span></span>
<span><span class="co"># 7   500     6</span></span>
<span><span class="co"># 8   600     6</span></span>
<span><span class="co"># 9   700     1</span></span>
<span><span class="co"># 10  800     2</span></span>
<span><span class="co"># 11  900     1</span></span>
<span><span class="co"># 12 1300     1</span></span>
<span><span class="co"># 13 1400     1</span></span>
<span><span class="co"># 14 3300     1</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ralf Herold.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>

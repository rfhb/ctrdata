<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Retrieve clinical trial information • ctrdata</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Retrieve clinical trial information">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ctrdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.20.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ctrdata_install.html">Install R package ctrdata</a></li>
    <li><a class="dropdown-item" href="../articles/ctrdata_retrieve.html">Retrieve clinical trial information</a></li>
    <li><a class="dropdown-item" href="../articles/ctrdata_summarise.html">Summarise and analyse clinical trial information</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rfhb/ctrdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Retrieve clinical trial information</h1>
                        <h4 data-toc-skip class="author">Ralf
Herold</h4>
            
            <h4 data-toc-skip class="date">2024-05-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rfhb/ctrdata/blob/HEAD/vignettes/ctrdata_retrieve.Rmd" class="external-link"><code>vignettes/ctrdata_retrieve.Rmd</code></a></small>
      <div class="d-none name"><code>ctrdata_retrieve.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="get-started">Get started<a class="anchor" aria-label="anchor" href="#get-started"></a>
</h2>
<div class="section level3">
<h3 id="attach-package-ctrdata">Attach package <code>ctrdata</code><a class="anchor" aria-label="anchor" href="#attach-package-ctrdata"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=ctrdata" class="external-link">ctrdata</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"ctrdata"</span><span class="op">)</span></span></code></pre></div>
<p>Remember to respect the registers’ terms and conditions (see
<code>ctrOpenSearchPagesInBrowser(copyright = TRUE)</code>). Please cite
this package in any publication as follows: Ralf Herold (2024). ctrdata:
Retrieve and Analyze Clinical Trials in Public Registers. R package
version 1.18.0. <a href="https://cran.r-project.org/package=ctrdata" class="external-link uri">https://cran.r-project.org/package=ctrdata</a></p>
</div>
<div class="section level3">
<h3 id="open-registers-advanced-search-page-in-browser">Open register’s advanced search page in browser<a class="anchor" aria-label="anchor" href="#open-registers-advanced-search-page-in-browser"></a>
</h3>
<p>These functions open the browser, where the user can start searching
for trials of interest.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Please review and respect register copyrights:</span></span>
<span><span class="fu"><a href="../reference/ctrOpenSearchPagesInBrowser.html">ctrOpenSearchPagesInBrowser</a></span><span class="op">(</span></span>
<span>  copyright <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Open browser with example search:</span></span>
<span><span class="fu"><a href="../reference/ctrOpenSearchPagesInBrowser.html">ctrOpenSearchPagesInBrowser</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="st">"cancer&amp;age=under-18"</span>,</span>
<span>  register <span class="op">=</span> <span class="st">"EUCTR"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adjust-search-parameters-and-execute-search-in-browser">Adjust search parameters and execute search in browser<a class="anchor" aria-label="anchor" href="#adjust-search-parameters-and-execute-search-in-browser"></a>
</h3>
<p>Refine the search until the trials of interest are listed in the
browser. The total number of trials that can be retrieved with package
<code>ctrdata</code> is intentionally limited to queries with at most
10,000 result records.</p>
</div>
<div class="section level3">
<h3 id="copy-address-from-browser-address-bar-to-clipboard">Copy address from browser address bar to clipboard<a class="anchor" aria-label="anchor" href="#copy-address-from-browser-address-bar-to-clipboard"></a>
</h3>
<p>Use functions or keyboard shortcuts according to the operating
system. See <a href="https://rfhb.github.io/ctrdata/#id_2-script-to-automatically-copy-users-query-from-web-browser">here</a>
for our automation to copy the URLs of a user’s queries in any of the
supported clinical trial registers.</p>
</div>
<div class="section level3">
<h3 id="get-address-from-clipboard">Get address from clipboard<a class="anchor" aria-label="anchor" href="#get-address-from-clipboard"></a>
</h3>
<p>The next steps are executed in the R environment:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctrGetQueryUrl.html">ctrGetQueryUrl</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># * Using clipboard content as register query URL: https://www.clinicaltrialsregister.eu/ctr-search/search?query=cancer&amp;age=under-18&amp;status=completed&amp;phase=phase-one</span></span>
<span><span class="co"># * Found search query from EUCTR: query=cancer&amp;age=under-18&amp;status=completed&amp;phase=phase-one</span></span>
<span></span>
<span><span class="va">q</span></span>
<span><span class="co">#                                                   query-term  query-register</span></span>
<span><span class="co"># 1 query=cancer&amp;age=under-18&amp;status=completed&amp;phase=phase-one           EUCTR</span></span>
<span></span>
<span><span class="co"># To check, this opens a browser with the query</span></span>
<span><span class="fu"><a href="../reference/ctrOpenSearchPagesInBrowser.html">ctrOpenSearchPagesInBrowser</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">q</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="retrieve-protocol-related-information-transform-save-to-database-check">Retrieve protocol-related information, transform, save to database,
check<a class="anchor" aria-label="anchor" href="#retrieve-protocol-related-information-transform-save-to-database-check"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Count number of trial records</span></span>
<span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  queryterm <span class="op">=</span> <span class="va">q</span>,</span>
<span>  only.count <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">n</span></span>
<span><span class="co"># * Found search query from EUCTR: query=cancer&amp;age=under-18&amp;status=completed&amp;phase=phase-one</span></span>
<span><span class="co"># * Checking trials in EUCTR...</span></span>
<span><span class="co"># Retrieved overview, multiple records of 103 trial(s) from 6 page(s) to be downloaded (estimate: 10 MB)</span></span>
<span><span class="co"># [1] 103</span></span>
<span></span>
<span><span class="co"># Connect to a database and chose a collection (table)</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/nodbi/reference/src_sqlite.html" class="external-link">src_sqlite</a></span><span class="op">(</span></span>
<span>  dbname <span class="op">=</span> <span class="st">"sqlite_file.sql"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"test"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve records, download into database</span></span>
<span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  queryterm <span class="op">=</span> <span class="va">q</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># * Checking trials in EUCTR...</span></span>
<span><span class="co"># Retrieved overview, multiple records of 103 trial(s) from 6 page(s) to be downloaded (estimate: 10 MB)</span></span>
<span><span class="co"># (1/3) Downloading trials...</span></span>
<span><span class="co"># Note: register server cannot compress data, transfer takes longer (estimate: 100 s)</span></span>
<span><span class="co"># Download status: 6 done; 0 in progress. Total size: 8.73 Mb (100%)... done!             </span></span>
<span><span class="co"># (2/3) Converting to NDJSON (estimate: 2 s)...</span></span>
<span><span class="co"># (3/3) Importing records into database...</span></span>
<span><span class="co"># = Imported or updated 414 records on 103 trial(s)</span></span>
<span><span class="co"># No history found in expected format.</span></span>
<span><span class="co"># Updated history ("meta-info" in "test")</span></span>
<span><span class="co"># $n</span></span>
<span><span class="co"># [1] 414</span></span>
<span></span>
<span><span class="co"># Show which queries have been downloaded into database</span></span>
<span><span class="fu"><a href="../reference/dbQueryHistory.html">dbQueryHistory</a></span><span class="op">(</span>con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span><span class="co">#       query-timestamp query-register query-records                                                 query-term</span></span>
<span><span class="co"># 1 2024-05-12 17:56:11          EUCTR           414 query=cancer&amp;age=under-18&amp;status=completed&amp;phase=phase-one</span></span></code></pre></div>
<p>With a file-base SQLite database, this takes about 20 seconds for
about 300 records, with most of the time needed for internet-retrieval
with is slow from this register. Speed is higher with other registers,
with using MongoDB and with memory-based SQLite.</p>
</div>
</div>
<div class="section level2">
<h2 id="repeat-and-update-a-previous-query">Repeat and update a previous query<a class="anchor" aria-label="anchor" href="#repeat-and-update-a-previous-query"></a>
</h2>
<p>Instead of “last”, an integer number can be specified for
<code>querytoupdate</code> that corresponds to the number when using
<code><a href="../reference/dbQueryHistory.html">dbQueryHistory()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  querytoupdate <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Depending on the register, an update (differential update) is
possible or the original query is executed fully again.</p>
</div>
<div class="section level2">
<h2 id="retrieve-results">Retrieve results<a class="anchor" aria-label="anchor" href="#retrieve-results"></a>
</h2>
<p>For EUCTR, result-related trial information has to be requested to be
retrieved, because it will take longer to download and store. For CTGOV,
any results are always included in the retrieval. Note that trial
documents, including any results reports, can be downloaded by
specifying parameter <code>documents.path</code>, see
<code><a href="../reference/ctrLoadQueryIntoDb.html">help(ctrLoadQueryIntoDb)</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  queryterm <span class="op">=</span> <span class="va">q</span>,</span>
<span>  euctrresults <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># * Checking trials in EUCTR...</span></span>
<span><span class="co"># Retrieved overview, multiple records of 103 trial(s) from 6 page(s) to be downloaded (estimate: 10 MB)</span></span>
<span><span class="co"># (1/3) Downloading trials...</span></span>
<span><span class="co"># Note: register server cannot compress data, transfer takes longer (estimate: 100 s)</span></span>
<span><span class="co"># (2/3) Converting to NDJSON (estimate: 2 s)...</span></span>
<span><span class="co"># (3/3) Importing records into database...</span></span>
<span><span class="co"># = Imported or updated 414 records on 103 trial(s)</span></span>
<span><span class="co"># * Checking results if available from EUCTR for 103 trials: </span></span>
<span><span class="co"># (1/4) Downloading results...</span></span>
<span><span class="co"># Download status: 103 done; 0 in progress. Total size: 59.71 Mb (100%)... done!             </span></span>
<span><span class="co"># Download status: 27 done; 0 in progress. Total size: 108.69 Kb (100%)... done!             </span></span>
<span><span class="co"># - extracting results (. = data, F = file[s] and data, x = none):</span></span>
<span><span class="co"># . . . . . . F . . . . F . . . . . . . F . . . . . . . . . . . . . . . . . . . . . </span></span>
<span><span class="co"># . . . F . F F . F . . F . . . F F . . . . . F . . . . . . F . . . F . </span></span>
<span><span class="co"># (2/4) Converting to NDJSON (estimate: 8 s)...</span></span>
<span><span class="co"># (3/4) Importing results into database (may take some time)...</span></span>
<span><span class="co"># (4/4) Results history: not retrieved (euctrresultshistory = FALSE)</span></span>
<span><span class="co"># = Imported or updated results for 76 trials</span></span>
<span><span class="co"># Updated history ("meta-info" in "test")</span></span>
<span><span class="co"># $n</span></span>
<span><span class="co"># [1] 414</span></span></code></pre></div>
<p>With a file-base SQLite database, this takes about 4 minutes for
about 300 records, with most of the time needed for merging result- and
protocol-related information in SQLite; this is much faster with MongoDB
and PostgreSQL.</p>
<p>The download or presence of results is not recorded in
<code><a href="../reference/dbQueryHistory.html">dbQueryHistory()</a></code> because the availability of results
increases over time.</p>
</div>
<div class="section level2">
<h2 id="add-information-from-another-register">Add information from another register<a class="anchor" aria-label="anchor" href="#add-information-from-another-register"></a>
</h2>
<p>The same collection can be used to store (and analyse) trial
information from different registers. Example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  queryterm <span class="op">=</span> <span class="st">"https://classic.clinicaltrials.gov/ct2/results?cond=neuroblastoma&amp;recrs=e&amp;age=0&amp;intr=Drug"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># * Appears specific for CTGOV Classic website</span></span>
<span><span class="co"># Since 2024-06-25, the classic CTGOV servers are no longer available. Package </span></span>
<span><span class="co"># ctrdata has translated the classic CTGOV query URL from this call of function </span></span>
<span><span class="co"># ctrLoadQueryIntoDb(queryterm = ...) into a query URL that works with the current </span></span>
<span><span class="co"># CTGOV2. This is printed below and is also part of the return value of this function,</span></span>
<span><span class="co"># ctrLoadQueryIntoDb(...)$url. This URL can be used with ctrdata functions. </span></span>
<span><span class="co"># Note that the fields and data schema of trials differ between CTGOV and CTGOV2. </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Replace this URL:</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># https://classic.clinicaltrials.gov/ct2/results?cond=neuroblastoma&amp;recrs=e&amp;age=0&amp;intr=Drug</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># with this URL:</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># https://clinicaltrials.gov/search?cond=neuroblastoma&amp;intr=Drug&amp;aggFilters=ages:child,status:com</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># * Found search query from CTGOV2: cond=neuroblastoma&amp;intr=Drug&amp;aggFilters=ages:child,status:com</span></span>
<span><span class="co"># * Checking trials using CTGOV REST API 2.0, found 222 trials</span></span>
<span><span class="co"># (1/3) Downloading in 1 batch(es) (max. 1000 trials each; estimate: 22 MB total)</span></span>
<span><span class="co"># Download status: 1 done; 0 in progress. Total size: 9.79 Mb (615%)... done!             </span></span>
<span><span class="co"># (2/3) Converting to NDJSON...</span></span>
<span><span class="co"># (3/3) Importing records into database...</span></span>
<span><span class="co"># JSON file #: 1 / 1                               </span></span>
<span><span class="co"># = Imported or updated 222 trial(s)</span></span>
<span><span class="co"># No history found in expected format.</span></span>
<span><span class="co"># Updated history ("meta-info" in "test")</span></span>
<span><span class="co"># $n</span></span>
<span><span class="co"># [1] 222</span></span></code></pre></div>
<p>With a file-base SQLite database, this takes about 10 seconds for
about 200 records.</p>
<p>Note that in this example, a warning message may be issued from
importing an NDJSON file with trial records. The warning arises from the
high level of complexity of some of the XML content of some of the trial
records. The issue can be resolved by increasing in the operating system
the stack size available to R, see: <a href="https://github.com/rfhb/ctrdata/issues/22" class="external-link uri">https://github.com/rfhb/ctrdata/issues/22</a></p>
</div>
<div class="section level2">
<h2 id="add-records-from-ctis-register-into-the-same-collection">Add records from CTIS register into the same collection<a class="anchor" aria-label="anchor" href="#add-records-from-ctis-register-into-the-same-collection"></a>
</h2>
<p>As of 29 June 2024, more than 4300 trials are publicly accessible in
CTIS, which has to be used since January 2023 for new clinical trials in
the European Union (EU). Queries in the CTIS search interface can be
automatically copied to the clipboard so that a user can paste them into
<code>queryterm</code>, see <a href="https://rfhb.github.io/ctrdata/#id_2-script-to-automatically-copy-users-query-from-web-browser">here</a>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve trials from another register:</span></span>
<span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  queryterm <span class="op">=</span> <span class="st">'searchCriteria={"containAll":"","containAny":"neonates","containNot":""}'</span>,</span>
<span>  register <span class="op">=</span> <span class="st">"CTIS"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># * Found search query from CTIS: searchCriteria={"containAll":"","containAny":"neonates","containNot":""}</span></span>
<span><span class="co"># * Checking trials in CTIS...</span></span>
<span><span class="co"># (1/4) Downloading trial list(s), found 7 trials</span></span>
<span><span class="co"># (2/4) Downloading and processing trial data... (estimate: 0.6 Mb)</span></span>
<span><span class="co"># Download status: 7 done; 0 in progress. Total size: 262.58 Kb (100%)... done!             </span></span>
<span><span class="co"># (3/4) Importing records into database...</span></span>
<span><span class="co"># (4/4) Updating with additional data: .           </span></span>
<span><span class="co"># = Imported 7, updated 7 record(s) on 7 trial(s)</span></span>
<span><span class="co"># Updated history ("meta-info" in "test")</span></span>
<span><span class="co"># $n</span></span>
<span><span class="co"># [1] 7</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="add-personal-annotations">Add personal annotations<a class="anchor" aria-label="anchor" href="#add-personal-annotations"></a>
</h2>
<p>When downloading trial information, the user can specify an
annotation to all records that are downloaded. By default, annotations
are accumulated if trial records are loaded again or updated;
alternatively, annotations can be replaced.</p>
<p>Annotations are useful for analyses, for example to specially
identify subsets of records in the database.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>  queryterm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"https://classic.clinicaltrials.gov/ct2/results?"</span>, </span>
<span>    <span class="st">"cond=neuroblastoma&amp;recrs=e&amp;age=0&amp;type=Intr&amp;cntry=DE"</span><span class="op">)</span>,</span>
<span>  annotation.text <span class="op">=</span> <span class="st">"site_DE "</span>,</span>
<span>  annotation.mode <span class="op">=</span> <span class="st">"append"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># * Appears specific for CTGOV Classic website</span></span>
<span><span class="co"># Since 2024-06-25, the classic CTGOV servers are no longer available. Package </span></span>
<span><span class="co"># ctrdata has translated the classic CTGOV query URL from this call of function </span></span>
<span><span class="co"># ctrLoadQueryIntoDb(queryterm = ...) into a query URL that works with the current </span></span>
<span><span class="co"># CTGOV2. This is printed below and is also part of the return value of this function,</span></span>
<span><span class="co"># ctrLoadQueryIntoDb(...)$url. This URL can be used with ctrdata functions. </span></span>
<span><span class="co"># Note that the fields and data schema of trials differ between CTGOV and CTGOV2. </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Replace this URL:</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># https://classic.clinicaltrials.gov/ct2/results?cond=neuroblastoma&amp;recrs=e&amp;age=0&amp;type=Intr&amp;cntry=DE</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># with this URL:</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># https://clinicaltrials.gov/search?cond=neuroblastoma&amp;country=Germany&amp;aggFilters=ages:child,studyType:int,status:com</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># * Found search query from CTGOV2:</span></span>
<span><span class="co">#   cond=neuroblastoma&amp;country=Germany&amp;aggFilters=ages:child,studyType:int,status:com</span></span>
<span><span class="co"># * Checking trials using CTGOV REST API 2.0, found 16 trials</span></span>
<span><span class="co"># (1/3) Downloading in 1 batch(es) (max. 1000 trials each; estimate: 1.6 MB total)</span></span>
<span><span class="co"># Download status: 1 done; 0 in progress. Total size: 487.83 Kb (492%)... done!             </span></span>
<span><span class="co"># (2/3) Converting to NDJSON...</span></span>
<span><span class="co"># (3/3) Importing records into database...</span></span>
<span><span class="co"># JSON file #: 1 / 1                               </span></span>
<span><span class="co"># = Imported or updated 16 trial(s)</span></span>
<span><span class="co"># = Annotated retrieved records (16 records)</span></span>
<span><span class="co"># Updated history ("meta-info" in "test")</span></span>
<span><span class="co"># $n</span></span>
<span><span class="co"># [1] 16</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="add-information-using-trial-identifiers">Add information using trial identifiers<a class="anchor" aria-label="anchor" href="#add-information-using-trial-identifiers"></a>
</h2>
<p>When identifiers of clinical trials of interest are already known,
this example shows how they can be processed to import the trial
information into a database collection. This involves constructing a
query that combines the identifiers and then iterating over the sets of
identifiers. Note to combine identifiers using “+OR+” into the
<code>queryterm</code>, and that <code>register</code> has to be
specified.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ids of trials of interest</span></span>
<span><span class="va">ctIds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"NCT00001209"</span>, <span class="st">"NCT00001436"</span>, <span class="st">"NCT00187109"</span>, <span class="st">"NCT01516567"</span>, <span class="st">"NCT01471782"</span>, <span class="st">"NCT03042429"</span>,</span>
<span>  <span class="st">"NCT00357084"</span>, <span class="st">"NCT00357500"</span>, <span class="st">"NCT00365755"</span>, <span class="st">"NCT00407433"</span>, <span class="st">"NCT00410657"</span>, <span class="st">"NCT00436657"</span>,</span>
<span>  <span class="st">"NCT00436852"</span>, <span class="st">"NCT00445965"</span>, <span class="st">"NCT00450307"</span>, <span class="st">"NCT00450827"</span>, <span class="st">"NCT00471679"</span>, <span class="st">"NCT00486564"</span>,</span>
<span>  <span class="st">"NCT00492167"</span>, <span class="st">"NCT00499616"</span>, <span class="st">"NCT00503724"</span>, <span class="st">"NCT00509353"</span>, <span class="st">"NCT00520936"</span>, <span class="st">"NCT00536601"</span>,</span>
<span>  <span class="st">"NCT00567567"</span>, <span class="st">"NCT00578864"</span>, <span class="st">"NCT00601003"</span>, <span class="st">"NCT00644696"</span>, <span class="st">"NCT00646230"</span>, <span class="st">"NCT00659984"</span>,</span>
<span>  <span class="st">"NCT00716976"</span>, <span class="st">"NCT00743496"</span>, <span class="st">"NCT00793845"</span>, <span class="st">"NCT00806182"</span>, <span class="st">"NCT00831844"</span>, <span class="st">"NCT00867568"</span>,</span>
<span>  <span class="st">"NCT00877110"</span>, <span class="st">"NCT00885326"</span>, <span class="st">"NCT00918320"</span>, <span class="st">"NCT00923351"</span>, <span class="st">"NCT00939770"</span>, <span class="st">"NCT00960739"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># split into sets of each 25 trial ids </span></span>
<span><span class="co"># (larger sets e.g. 50 may still work)</span></span>
<span><span class="va">idSets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">ctIds</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">ctIds</span><span class="op">)</span> <span class="op">/</span> <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># variable to collect import results</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co"># iterate over sets of trial ids</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">idSet</span> <span class="kw">in</span> <span class="va">idSets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># import</span></span>
<span>  <span class="va">setResult</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctrLoadQueryIntoDb.html">ctrLoadQueryIntoDb</a></span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="co"># for CTGOV2 use: </span></span>
<span>    queryterm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"term="</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">idSet</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># specify register that holds the information</span></span>
<span>    register <span class="op">=</span> <span class="st">"CTGOV2"</span>,</span>
<span>    </span>
<span>    con <span class="op">=</span> <span class="va">db</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># append results</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">setResult</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># inspect results </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"failed"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#    n failed</span></span>
<span><span class="co"># 1 25   NULL</span></span>
<span><span class="co"># 2 17   NULL</span></span></code></pre></div>
<p>Note that from <code>CTIS</code>, trial information <em>identified by
trial identifiers</em> can be retrieved only one-by-one, repeating
queries for each trial such as <a href="https://euclinicaltrials.eu/app/#/search?number=2023-503994-39-00" class="external-link uri">https://euclinicaltrials.eu/app/#/search?number=2023-503994-39-00</a>.</p>
</div>
<div class="section level2">
<h2 id="find-synonyms-of-active-substance-names">Find synonyms of active substance names<a class="anchor" aria-label="anchor" href="#find-synonyms-of-active-substance-names"></a>
</h2>
<p>Not all registers automatically expand search terms to include
alternative terms, such as codes and other names of active substances.
To obtain a character vector of synonyms for any active substance name,
use:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ctrFindActiveSubstanceSynonyms.html">ctrFindActiveSubstanceSynonyms</a></span><span class="op">(</span></span>
<span>  activesubstance <span class="op">=</span> <span class="st">"imatinib"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#  [1] "imatinib"                    "Carcemia"                    "Cemivil"                    </span></span>
<span><span class="co">#  [4] "CGP 57148"                   "CGP-57148B"                  "CGP57148B"                  </span></span>
<span><span class="co">#  [7] "Gleevac"                     "Gleevec"                     "Gleevec (Imatinib Mesylate)"</span></span>
<span><span class="co"># [10] "Glevec"                      "Glivec"                      "Imatinib"                   </span></span>
<span><span class="co"># [13] "Imatinib Mesylate"           "Imatinib-AFT"                "NSC #716051"                </span></span>
<span><span class="co"># [16] "NSC-716051"                  "QTI571"                      "ST1571"                     </span></span>
<span><span class="co"># [19] "STI 571"                     "STI-571"                     "STI571"                     </span></span>
<span><span class="co"># [22] "tyrosine kinase inhibitors"  "Ziatir"                      "Zoleta"  </span></span></code></pre></div>
<p>These names can then be used in queries in any register.</p>
</div>
<div class="section level2">
<h2 id="using-a-mongodb-database">Using a MongoDB database<a class="anchor" aria-label="anchor" href="#using-a-mongodb-database"></a>
</h2>
<p>This example works with a free service <a href="https://www.mongodb.com/cloud/atlas" class="external-link">here</a>. Note that the user
name and password need to be encoded. The format of the connection
string is documented at <a href="https://docs.mongodb.com/manual/reference/connection-string/" class="external-link uri">https://docs.mongodb.com/manual/reference/connection-string/</a>.</p>
<p>For recommended databases, see vignette <a href="https://rfhb.github.io/ctrdata/#databases-that-can-be-used-with-ctrdata">Install
R package ctrdata</a>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify base uri for remote MongoDB server,</span></span>
<span><span class="co">#  as part of the encoded connection string</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/nodbi/reference/src_mongo.html" class="external-link">src_mongo</a></span><span class="op">(</span></span>
<span>  <span class="co"># Note: this provides read-only access</span></span>
<span>  url <span class="op">=</span> <span class="st">"mongodb+srv://DWbJ7Wh:bdTHh5cS@cluster0-b9wpw.mongodb.net"</span>,</span>
<span>  db <span class="op">=</span> <span class="st">"dbperm"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"dbperm"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Since the above access is read-only,</span></span>
<span><span class="co"># just obtain fields of interest:</span></span>
<span><span class="fu"><a href="../reference/dbGetFieldsIntoDf.html">dbGetFieldsIntoDf</a></span><span class="op">(</span></span>
<span>  fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a2_eudract_number"</span>,</span>
<span>             <span class="st">"e71_human_pharmacology_phase_i"</span><span class="op">)</span>,</span>
<span>  con <span class="op">=</span> <span class="va">db</span><span class="op">)</span></span>
<span><span class="co">#                  _id a2_eudract_number e71_human_pharmacology_phase_i</span></span>
<span><span class="co"># 1 2010-024264-18-3RD    2010-024264-18                           TRUE</span></span>
<span><span class="co"># 2  2010-024264-18-AT    2010-024264-18                           TRUE</span></span>
<span><span class="co"># 3  2010-024264-18-DE    2010-024264-18                           TRUE</span></span>
<span><span class="co"># 4  2010-024264-18-GB    2010-024264-18                           TRUE</span></span>
<span><span class="co"># 5  2010-024264-18-IT    2010-024264-18                           TRUE</span></span>
<span><span class="co"># 6  2010-024264-18-NL    2010-024264-18                           TRUE</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ralf Herold.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
